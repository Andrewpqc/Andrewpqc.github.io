<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="All In">
<meta property="og:type" content="website">
<meta property="og:title" content="Andrew&#39;s Blog">
<meta property="og:url" content="http://andrewpqc.github.io/page/4/index.html">
<meta property="og:site_name" content="Andrew&#39;s Blog">
<meta property="og:description" content="All In">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Andrew&#39;s Blog">
<meta name="twitter:description" content="All In">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://andrewpqc.github.io/page/4/">





  <title>Andrew's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Andrew's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Stay hungry, Stay foolish.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/10/30/something-about-database/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/30/something-about-database/" itemprop="url">木犀后端分享——关系型数据库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-30T15:53:25+08:00">
                2017-10-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Database/" itemprop="url" rel="index">
                    <span itemprop="name">Database</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p><code>数据库(DataBase, DB）</code>：是存放数据的仓库，只不过这些数据存在一定的关联，并按一定的格式存放在计算机上。</p>
<p><code>数据库管理系统(DataBase Management System, DBMS)</code>:是管理数据库的系统，它按一定的数据模型组织数据。DBMS应提供如下功能：<br>（1）数据定义功能可定义数据库中的数据对象。<br>（2）数据操纵功能可对数据库表进行基本操作，如插入、删除、修改、查询。<br>（3）数据的完整性检查功能保证用户输入的数据应满足相应的约束条件。<br>（4）数据库的安全保护功能保证只有赋予权限的用户才能访问数据库中的数据。<br>（5）数据库的并发控制功能使多个应用程序可在同一时刻并发地访问数据库的数据。<br>（6）数据库系统的故障恢复功能使数据库运行出现故障时进行数据库恢复，以保证数据库可靠运行。<br>（7）在网络环境下访问数据库的功能。<br>（8）方便、有效地存取数据库信息的接口和工具。编程人员通过程序开发工具与数据库的接口编写数据库应用程序。<code>数据库管理员（DataBase　Adminitrator，DBA）</code>通过提供的工具对数据库进行管理。</p>
<p><code>数据库系统(Database System,DBS)</code>:数据、数据库、数据库管理系统与操作数据库的应用程序，加上支撑它们的硬件平台、软件平台和与数据库有关的人员一起构成了一个完整的数据库系统.</p>
<p><img src="/images/db.png" alt="数据库系统"></p>
<p>从上面的这些概念中，我们可以知道平时我们讲的SQL Server、Oracle、MySQL、DB2、SyBase等，本身并不是数据库，他们是数据库管理系统。我们通过这个数据库管理系统创建的那个可以存储表的东西才是数据库。数据库中存储这一个或多个表，表之间存在着特定的关系。一个表由行和列组成，每一列代表一个字段(Field),每一行则代表着一条具有某种特别意义的记录。</p>
<p><img src="/images/db2.jpg" alt="表的结构"></p>
<p>作为程序员，我们所要知道的就是要怎样使用数据库管理系统？怎样通过数据库管理系统去创建和删除数据库？怎样在数据库中创建和删除表，怎样在表中实现数据的增删改查？下面我就以mysql这一个关系型数据库管理系统为例来讲解这些操作。</p>
<h1 id="mysql客户端工具基本操作"><a href="#mysql客户端工具基本操作" class="headerlink" title="mysql客户端工具基本操作"></a>mysql客户端工具基本操作</h1><h2 id="连接并登录"><a href="#连接并登录" class="headerlink" title="连接并登录"></a>连接并登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u &lt;NAME&gt; -h &lt;HOSTNAME&gt; -P &lt;PORT&gt; -p</span><br><span class="line">$ mysql -u &lt;NAME&gt; -p</span><br><span class="line"><span class="comment">#不指明主机和端口，则默认访问本地的3306端口</span></span><br></pre></td></tr></table></figure>

<p>在终端中输入上述命令，接着输入密码即可连接并登录指定主机指定端口的mysql服务器。(注意密码不回显)</p>
<h2 id="编码的修改"><a href="#编码的修改" class="headerlink" title="编码的修改"></a>编码的修改</h2><p>在Mac或Linux上，需要编辑MySQL的配置文件，把数据库默认的编码全部改为UTF-8。MySQL的配置文件默认存放在/etc/my.cnf或者/etc/mysql/my.cnf：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set = utf8</span><br><span class="line">[mysqld]</span><br><span class="line">default-storage-engine = INNODB</span><br><span class="line">character-set-server = utf8</span><br><span class="line">collation-server = utf8_general_ci</span><br></pre></td></tr></table></figure>

<p><code>重启MySQL</code>后，可以通过MySQL的客户端命令行检查编码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor...</span><br><span class="line">...</span><br><span class="line">mysql&gt; show variables like <span class="string">'%char%'</span>;</span><br><span class="line">+--------------------------+--------------------------------------------------------+</span><br><span class="line">| Variable_name            | Value                                                  |</span><br><span class="line">+--------------------------+--------------------------------------------------------+</span><br><span class="line">| character_set_client     | utf8                                                   |</span><br><span class="line">| character_set_connection | utf8                                                   |</span><br><span class="line">| character_set_database   | utf8                                                   |</span><br><span class="line">| character_set_filesystem | binary                                                 |</span><br><span class="line">| character_set_results    | utf8                                                   |</span><br><span class="line">| character_set_server     | utf8                                                   |</span><br><span class="line">| character_set_system     | utf8                                                   |</span><br><span class="line">| character_sets_dir       | /usr/<span class="built_in">local</span>/mysql-5.1.65-osx10.6-x86_64/share/charsets/ |</span><br><span class="line">+--------------------------+--------------------------------------------------------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>看到utf8字样就表示编码设置正确。</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="查看当前所有的数据库："><a href="#查看当前所有的数据库：" class="headerlink" title="查看当前所有的数据库："></a>查看当前所有的数据库：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure>

<h3 id="切换数据库："><a href="#切换数据库：" class="headerlink" title="切换数据库："></a>切换数据库：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">use</span> &lt;DB <span class="keyword">NAME</span>&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="创建数据库："><a href="#创建数据库：" class="headerlink" title="创建数据库："></a>创建数据库：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> 数据库名;</span><br></pre></td></tr></table></figure>

<h3 id="建立数据表："><a href="#建立数据表：" class="headerlink" title="建立数据表："></a>建立数据表：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">USE</span> 库名;</span><br><span class="line">$ <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名 (字段名 <span class="built_in">VARCHAR</span>(<span class="number">20</span>), 字段名 <span class="built_in">CHAR</span>(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<h3 id="删除数据库："><a href="#删除数据库：" class="headerlink" title="删除数据库："></a>删除数据库：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">DROP</span> <span class="keyword">DATABASE</span> 库名;</span><br></pre></td></tr></table></figure>

<h3 id="删除数据表："><a href="#删除数据表：" class="headerlink" title="删除数据表："></a>删除数据表：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名;</span><br></pre></td></tr></table></figure>

<h3 id="查看当前数据库的所有的表："><a href="#查看当前数据库的所有的表：" class="headerlink" title="查看当前数据库的所有的表："></a>查看当前数据库的所有的表：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>

<h3 id="查看某一个表的结构："><a href="#查看某一个表的结构：" class="headerlink" title="查看某一个表的结构："></a>查看某一个表的结构：</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ desc &lt;Table name&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="查看某一张表的前10条数据："><a href="#查看某一张表的前10条数据：" class="headerlink" title="查看某一张表的前10条数据："></a>查看某一张表的前10条数据：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">select</span> * <span class="keyword">from</span> &lt;<span class="keyword">Table</span> <span class="keyword">name</span>&gt; <span class="keyword">limit</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>基本上上面的几条命令会是大家以后在mysql客户端中使用的最多的命令了。</p>
<h3 id="创建和管理用户"><a href="#创建和管理用户" class="headerlink" title="创建和管理用户"></a>创建和管理用户</h3><p>mysql支持数据库的多用户管理，并且可以对每个用户的权限进行管理。下面我们来看看怎样创建用户和管理用户的权限。</p>
<h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><p>命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'host'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'password'</span>;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>username：你将创建的用户名</li>
<li>host：指定该用户在哪个主机上可以登陆，如果是本地用户可用localhost，如果想让该用户可以从任意远程主机登陆，可以使用通配符%</li>
<li>password：该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器</li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'dog'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'pig'</span>@<span class="string">'192.168.1.101_'</span> IDENDIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'pig'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'pig'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">''</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'pig'</span>@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h4><p>命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'host'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">INSERT</span>,<span class="keyword">UPDATE</span>,<span class="keyword">DELETE</span>,<span class="keyword">CREATE</span>,<span class="keyword">DROP</span>,<span class="keyword">ALTER</span>  <span class="keyword">ON</span> 数据库名.* <span class="keyword">TO</span> 用户名@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'密码'</span>;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>privileges：用户的操作权限，如SELECT，INSERT，UPDATE等，如果要授予所的权限则使用ALL</li>
<li>databasename：数据库名</li>
<li>tablename：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用<em>表示，如</em>.*<br>例子：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span> <span class="keyword">ON</span> test.user <span class="keyword">TO</span> <span class="string">'pig'</span>@<span class="string">'%'</span>;</span><br><span class="line">$ <span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'pig'</span>@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>注意：<br>用以上命令授权的用户不能给其它用户授权，如果想让该用户可以授权，用以下命令:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'host'</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>;</span><br></pre></td></tr></table></figure>

<h4 id="设置和更改用户密码"><a href="#设置和更改用户密码" class="headerlink" title="设置和更改用户密码"></a>设置和更改用户密码</h4><p>命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">'username'</span>@<span class="string">'host'</span> = <span class="keyword">PASSWORD</span>(<span class="string">'newpassword'</span>);</span><br><span class="line">如果是当前登陆用户用:</span><br><span class="line">$ <span class="keyword">SET</span> <span class="keyword">PASSWORD</span> = <span class="keyword">PASSWORD</span>(<span class="string">"newpassword"</span>);</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">'pig'</span>@<span class="string">'%'</span> = <span class="keyword">PASSWORD</span>(<span class="string">"123456"</span>);</span><br></pre></td></tr></table></figure>

<h4 id="插销用户权限"><a href="#插销用户权限" class="headerlink" title="插销用户权限"></a>插销用户权限</h4><p>命令:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">REVOKE</span> privilege <span class="keyword">ON</span> databasename.tablename <span class="keyword">FROM</span> <span class="string">'username'</span>@<span class="string">'host'</span>;</span><br></pre></td></tr></table></figure>

<p>说明:<br>privilege, databasename, tablename：同授权部分</p>
<p>例子:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> *.* <span class="keyword">FROM</span> <span class="string">'pig'</span>@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure>

<p>注意：<br>假如你在给用户‘pig’@’%’授权的时候是这样的（或类似的）：GRANT SELECT ON test.user TO ‘pig’@’%’，则在使用REVOKE SELECT ON <em>.</em> FROM ‘pig’@’%’;命令并不能撤销该用户对test数据库中user表的SELECT 操作。相反，如果授权使用的是GRANT SELECT ON <em>.</em> TO ‘pig’@’%’;则REVOKE SELECT ON test.user FROM ‘pig’@’%’;命令也不能撤销该用户对test数据库中user表的Select权限。</p>
<h4 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'host'</span>;</span><br></pre></td></tr></table></figure>

<h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h1><p>SQL 是一门 ANSI 的标准计算机语言，用来访问和操作数据库系统。SQL 语句用于取回和更新数据库中的数据。SQL 可与数据库程序协同工作。虽然是一门标准的语言，不幸地是，存在着很多不同版本的 SQL 语言，但是为了与 ANSI 标准相兼容，它们必须以相似的方式共同地来支持一些主要的关键词（比如 SELECT、UPDATE、DELETE、INSERT、WHERE 等等）。</p>
<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p>语法：SELECT 列名称 FROM 表名称;<br>SELECT 语句用于从表中选取数据。结果被存储在一个结果表中（称为结果集）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LastName,FirstName <span class="keyword">FROM</span> Persons;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons;</span><br></pre></td></tr></table></figure>

<h2 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h2><p>语法：SELECT DISTINCT 列名称 FROM 表名称;<br>在表中，可能会包含重复值。这并不成问题，不过，有时您也许希望仅仅列出不同（distinct）的值。<br>关键词 DISTINCT 用于返回唯一不同的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> LastName <span class="keyword">FROM</span> Persons;</span><br></pre></td></tr></table></figure>

<h2 id="where"><a href="#where" class="headerlink" title="where"></a>where</h2><p>语法：SELECT 列名称 FROM 表名称 WHERE 列 运算符 值;<br>如需有条件地从表中选取数据，可将 WHERE 子句添加到 SELECT 语句。<br>下面的运算符可以在where子句中使用：</p>
<table>
<thead>
<tr>
<th align="center">操作符</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">=</td>
<td align="center">等于</td>
</tr>
<tr>
<td align="center">&lt;&gt;</td>
<td align="center">不等于</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center">大于</td>
</tr>
<tr>
<td align="center">&lt;</td>
<td align="center">小于</td>
</tr>
<tr>
<td align="center">&gt;=</td>
<td align="center">大于等于</td>
</tr>
<tr>
<td align="center">&lt;=</td>
<td align="center">小于等于</td>
</tr>
<tr>
<td align="center">BETWEEN</td>
<td align="center">在某个范围内</td>
</tr>
<tr>
<td align="center">LIKE</td>
<td align="center">搜索某种模式</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> City=<span class="string">'Beijing'</span>;</span><br><span class="line">请注意，我们在例子中的条件值周围使用的是单引号。</span><br><span class="line">SQL 使用单引号来环绕文本值（大部分数据库系统也接受双引号）。如果是数值，请不要使用引号。</span><br><span class="line">这是正确的：</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> FirstName=<span class="string">'Bush'</span>;</span><br><span class="line">这是错误的：</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> FirstName=Bush;</span><br><span class="line">这是正确的：</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> <span class="keyword">Year</span>&gt;<span class="number">1965</span>;</span><br><span class="line">这是错误的：</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> <span class="keyword">Year</span>&gt;<span class="string">'1965'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="and-amp-or"><a href="#and-amp-or" class="headerlink" title="and &amp; or"></a>and &amp; or</h2><p>语法：AND 和 OR 可在 WHERE 子语句中把两个或多个条件结合起来。如果第一个条件和第二个条件都成立，则 AND 运算符显示一条记录。如果第一个条件和第二个条件中只要有一个成立，则 OR 运算符显示一条记录。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> FirstName=<span class="string">'Thomas'</span> <span class="keyword">AND</span> LastName=<span class="string">'Carter'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> firstname=<span class="string">'Thomas'</span> <span class="keyword">OR</span> lastname=<span class="string">'Carter'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> (FirstName=<span class="string">'Thomas'</span> <span class="keyword">OR</span> FirstName=<span class="string">'William'</span>) <span class="keyword">AND</span> LastName=<span class="string">'Carter'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h2><p>语法：ORDER BY 语句用于根据指定的列对结果集进行排序。ORDER BY 语句默认按照升序对记录进行排序。如果您希望按照降序对记录进行排序，可以使用 DESC 关键字。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">以字母顺序显示公司名称：</span><br><span class="line"><span class="keyword">SELECT</span> Company, OrderNumber <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> Company;</span><br><span class="line">以字母顺序显示公司名称（Company），并以数字顺序显示顺序号（OrderNumber）：</span><br><span class="line"><span class="keyword">SELECT</span> Company, OrderNumber <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> Company, OrderNumber;</span><br><span class="line">以逆字母顺序显示公司名称：</span><br><span class="line"><span class="keyword">SELECT</span> Company, OrderNumber <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> Company <span class="keyword">DESC</span>;</span><br><span class="line">以逆字母顺序显示公司名称，并以数字顺序显示顺序号：</span><br><span class="line"><span class="keyword">SELECT</span> Company, OrderNumber <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> Company <span class="keyword">DESC</span>, OrderNumber <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>

<h2 id="insert-into"><a href="#insert-into" class="headerlink" title="insert into"></a>insert into</h2><p>语法：INSERT INTO 表名称 VALUES (值1, 值2,….);<br>我们也可以指定所要插入数据的列：INSERT INTO table_name (列1, 列2,…) VALUES (值1, 值2,….);</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Persons <span class="keyword">VALUES</span> (<span class="string">'Gates'</span>, <span class="string">'Bill'</span>, <span class="string">'Xuanwumen 10'</span>, <span class="string">'Beijing'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Persons (LastName, Address) <span class="keyword">VALUES</span> (<span class="string">'Wilson'</span>, <span class="string">'Champs-Elysees'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><p>语法：UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值;<br>Update 语句用于修改表中的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Person <span class="keyword">SET</span> FirstName = <span class="string">'Fred'</span> <span class="keyword">WHERE</span> LastName = <span class="string">'Wilson'</span> ;</span><br><span class="line"><span class="keyword">UPDATE</span> Person <span class="keyword">SET</span> Address = <span class="string">'Zhongshan 23'</span>, City = <span class="string">'Nanjing'</span> <span class="keyword">WHERE</span> LastName = <span class="string">'Wilson'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><p>DELETE 语句用于删除表中的行。<br>语法：DELETE FROM 表名称 WHERE 列名称 = 值;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Person <span class="keyword">WHERE</span> LastName = <span class="string">'Wilson'</span> ;</span><br><span class="line">可以在不删除表的情况下删除所有的行。这意味着表的结构、属性和索引都是完整的：</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line">或者：</span><br><span class="line"><span class="keyword">DELETE</span> * <span class="keyword">FROM</span> table_name</span><br></pre></td></tr></table></figure>

<h2 id="原生SQL在python代码中的使用"><a href="#原生SQL在python代码中的使用" class="headerlink" title="原生SQL在python代码中的使用"></a>原生SQL在python代码中的使用</h2><p>要想在你的python代码中操作mysql，那么据需要使用python链接mysql的驱动程序。MysqlDB是最常用的mysql驱动，但是至今没有支持python3.下表列出了python3中链接mysql的几个驱动程序：</p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">安装</th>
<th align="center">导入</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a href="https://dev.mysql.com/doc/connector-python/en/" target="_blank" rel="noopener">MYSQL Connector</a></td>
<td align="center">pip install mysql-connector-python</td>
<td align="center">mysql.connctor</td>
</tr>
<tr>
<td align="center"><a href="https://github.com/PyMySQL/PyMySQL" target="_blank" rel="noopener">PYMYSQL</a></td>
<td align="center">pip install pymysql</td>
<td align="center">pymysql</td>
</tr>
</tbody></table>
<p>下面以MySQL Connector为例讲解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"><span class="comment"># conn = mysql.connector.connect(user='root', password='password', database='mydb')</span></span><br><span class="line">conn = mysql.connector.connect(user=<span class="string">'root'</span>, password=<span class="string">'password'</span>,</span><br><span class="line">                               database=<span class="string">'mydb'</span>,host=<span class="string">"120.220.235.23"</span>,port=<span class="number">32777</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"><span class="comment"># 创建user表:</span></span><br><span class="line">cursor.execute(<span class="string">'create table user (id varchar(20) primary key, name varchar(20))'</span>)</span><br><span class="line"><span class="comment"># 插入一行记录，注意MySQL的占位符是%s:</span></span><br><span class="line">cursor.execute(<span class="string">'insert into user (id, name) values (%s, %s)'</span>, [<span class="string">'1'</span>, <span class="string">'Michael'</span>])</span><br><span class="line">print(cursor.rowcount)</span><br><span class="line"><span class="comment"># 输出　1</span></span><br><span class="line"><span class="comment"># 提交事务:</span></span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line"><span class="comment"># 运行查询:</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">cursor.execute(<span class="string">'select * from user where id = %s'</span>, (<span class="string">'1'</span>,))</span><br><span class="line">values = cursor.fetchall()</span><br><span class="line"><span class="comment"># 输出：[('1', 'Michael')]</span></span><br><span class="line"><span class="comment"># 关闭Cursor和Connection:</span></span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<h1 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h1><p>SQLAlchemy是Python编程语言下的一款ORM框架，该框架建立在数据库API之上，使用关系对象映射进行数据库操作，简言之便是：将对象转换成SQL，然后使用数据库API执行SQL并获取执行结果。这是分了三层，上层和下面两层。ORM是用类来封装的，SQLALCHEMY Core 是用函数封装的，是核心层，不是执行数据库语句，是把写成的类，翻译成sql语句。DBAPI执行SQL从而获取执行结果或将数据持久化进磁盘。</p>
<p><img src="/images/orm.jpeg" alt="ORM"></p>
<p>SQLAlchemy本身无法操作数据库，其必须依赖pymysql，mysql-connector等第三方插件.Dialect用于和数据库API进行交流，根据配置文件的不同调用不同的数据库API，从而实现对数据库的操作。SQLAlchemy为我们屏蔽了SQL语句的繁琐，统一了各种不同数据库的操作，极大的方便了数据库应用的开发。</p>
<h2 id="SQLAlchemy的基本使用"><a href="#SQLAlchemy的基本使用" class="headerlink" title="SQLAlchemy的基本使用"></a>SQLAlchemy的基本使用</h2><h3 id="连接配置"><a href="#连接配置" class="headerlink" title="连接配置"></a>连接配置</h3><p><code>dialect+driver://user:password@host:port/dbname</code><br>不同数据库和驱动条件下的连接配置：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MySQL-Python</span><br><span class="line">    mysql+mysqldb://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;</span><br><span class="line">pymysql</span><br><span class="line">    mysql+pymysql://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;/&lt;dbname&gt;[?&lt;options&gt;]</span><br><span class="line">MySQL-Connector</span><br><span class="line">    mysql+mysqlconnector://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;</span><br><span class="line">cx_Oracle</span><br><span class="line">    oracle+cx_oracle://user:pass@host:port/dbname[?key=value&amp;key=value...]</span><br></pre></td></tr></table></figure>

<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlalchemy</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String</span><br><span class="line"><span class="comment"># 创建实例，并连接test库，echo=True 显示SQL语句</span></span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123456@localhost/test"</span>,</span><br><span class="line">                                    encoding=<span class="string">'utf-8'</span>, echo=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#create_engine方法返回一个Engine实例，Engine实例只有直到触发数据库事件时才真正去连接数据库。#echo=True是回显命令，sqlalchemy与数据库通信的命令都将打印出来</span></span><br><span class="line">Base = declarative_base()  <span class="comment"># 生成orm基类</span></span><br><span class="line"><span class="comment">#declarative_base类维持了一个从类到表的关系，通常一个应用使用一个base实例，</span></span><br><span class="line"><span class="comment">#所有实体类都应该继承此类对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'users'</span>  <span class="comment"># 表名</span></span><br><span class="line">    __table_args__ = &#123;<span class="string">"mysql_charset"</span>: <span class="string">"utf8"</span>&#125;</span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>)<span class="comment">#主键，自增id</span></span><br><span class="line">    name = Column(String(<span class="number">32</span>))</span><br><span class="line">    password = Column(String(<span class="number">64</span>))</span><br><span class="line">Base.metadata.create_all(engine) <span class="comment">#创建表结构 （这里是父类调子类）</span></span><br><span class="line"><span class="comment">#Base.metadata返回sqlalchemy.schema.MetaData对象，它是所有Table对象的集合，</span></span><br><span class="line"><span class="comment">#调用create_all()该对象会触发CREATE TABLE语句，如果数据库还不存在这些表的话。</span></span><br></pre></td></tr></table></figure>

<p>除了上面的创建方法之外，还有一种创建方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Table, MetaData, Column, Integer, String</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> mapper</span><br><span class="line">metadata = MetaData()</span><br><span class="line">user = Table(<span class="string">'user'</span>, metadata,</span><br><span class="line">            Column(<span class="string">'id'</span>, Integer, primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>),</span><br><span class="line">            Column(<span class="string">'name'</span>, String(<span class="number">50</span>)),</span><br><span class="line">            Column(<span class="string">'fullname'</span>, String(<span class="number">50</span>)),</span><br><span class="line">            Column(<span class="string">'password'</span>, String(<span class="number">12</span>))</span><br><span class="line">        )</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, fullname, password)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.fullname = fullname</span><br><span class="line">        self.password = password</span><br><span class="line">mapper(User, user)  <span class="comment"># 类User 和 user关联起来</span></span><br><span class="line"><span class="comment"># the table metadata is created separately with the Table construct, </span></span><br><span class="line"><span class="comment"># then associated with the User class via the mapper() function</span></span><br><span class="line"><span class="comment"># 如果数据库里有，就不会创建了。</span></span><br></pre></td></tr></table></figure>

<p>在使用的时候建议使用第一种创建方式。</p>
<h3 id="Column构造函数常用参数"><a href="#Column构造函数常用参数" class="headerlink" title="Column构造函数常用参数"></a>Column构造函数常用参数</h3><table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">含义</th>
<th align="center">可选值</th>
<th align="center">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">autoincrement</td>
<td align="center">是否自增</td>
<td align="center">Ture,False</td>
<td align="center">False</td>
</tr>
<tr>
<td align="center">primary_key</td>
<td align="center">主键</td>
<td align="center">Ture,False</td>
<td align="center">False</td>
</tr>
<tr>
<td align="center">default</td>
<td align="center">指定默认值</td>
<td align="center">自定义值</td>
<td align="center">无</td>
</tr>
<tr>
<td align="center">index</td>
<td align="center">是否建索引</td>
<td align="center">True,False</td>
<td align="center">False</td>
</tr>
<tr>
<td align="center">nullable</td>
<td align="center">字段可否可空</td>
<td align="center">Ture,False</td>
<td align="center">False</td>
</tr>
</tbody></table>
<h3 id="插入一条数据"><a href="#插入一条数据" class="headerlink" title="插入一条数据"></a>插入一条数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Table, MetaData, Column, Integer, String</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> mapper, sessionmaker</span><br><span class="line"><span class="comment"># 创建实例，并连接test库</span></span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123456@localhost/test"</span>,</span><br><span class="line">                                    encoding=<span class="string">'utf-8'</span>, echo=<span class="literal">True</span>)</span><br><span class="line">metadata = MetaData()</span><br><span class="line">user = Table(<span class="string">'user'</span>, metadata,</span><br><span class="line">            Column(<span class="string">'id'</span>, Integer, primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>),</span><br><span class="line">            Column(<span class="string">'name'</span>, String(<span class="number">50</span>)),</span><br><span class="line">            Column(<span class="string">'password'</span>, String(<span class="number">12</span>))</span><br><span class="line">        )</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name,  password)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.password = password</span><br><span class="line"><span class="comment"># the table metadata is created separately with the Table construct, then associated with the User class via the mapper() function</span></span><br><span class="line">mapper(User, user)</span><br><span class="line"><span class="comment"># 创建与数据库的会话session class ,注意,这里返回给session的是个class,不是实例.</span></span><br><span class="line">Session_class = sessionmaker(bind=engine)  <span class="comment"># 实例和engine绑定</span></span><br><span class="line">Session = Session_class()  <span class="comment"># 生成session实例，相当于游标</span></span><br><span class="line"><span class="comment">#Session是真正与数据库通信的handler，你还可以把他理解一个容器，add就是往容器中添加对象</span></span><br><span class="line">user_obj = User(name=<span class="string">"fgf"</span>,password=<span class="string">"123456"</span>)  <span class="comment"># 生成你要创建的数据对象</span></span><br><span class="line">print(user_obj.name,user_obj.id)  <span class="comment"># 此时还没创建对象呢，不信你打印一下id发现还是None</span></span><br><span class="line">Session.add(user_obj)  <span class="comment"># 把要创建的数据对象添加到这个session里， 一会统一创建</span></span><br><span class="line"><span class="comment"># Session.add_all([user1,user2,use3]) #add_all()添加多个对象，效率高</span></span><br><span class="line">print(user_obj.name,user_obj.id) <span class="comment">#此时也依然还没创建，id仍然为None</span></span><br><span class="line">Session.commit() <span class="comment">#现此才统一提交，创建数据</span></span><br></pre></td></tr></table></figure>

<h3 id="对象状态"><a href="#对象状态" class="headerlink" title="对象状态"></a>对象状态</h3><p>对象实例有四种状态，分别是：</p>
<ul>
<li>Transient（瞬时的)：这个状态的对象还不在session中，也不会保存到数据库中，主键为None（不是绝对的，如果Persistent对象rollback后虽然主键id有值，但还是Transient状态的）。</li>
<li>Pending（挂起的）：调用session.add()后，Transient对象就会变成Pending，这个时候它还是不会保存到数据库中，只有等到触发了flush动作才会存在数据库，比如query操作就可以出发flush。同样这个时候的实例的主键一样为None</li>
<li>Persistent（持久的）：session中，数据库中都有对应的一条记录存在，主键有值了。</li>
<li>Detached（游离的）：数据库中有记录，但是session中不存在，对这个状态的对象进行操作时，不会触发任何SQL语句。</li>
</ul>
<h3 id="Session对象缓存清理"><a href="#Session对象缓存清理" class="headerlink" title="Session对象缓存清理"></a>Session对象缓存清理</h3><p>Session对象在commit()方法调用时,在执行查询时和显式调用session的flush方法时清理缓存，从而保证查询结果能反映对象的最新状态。</p>
<p>Session是真正与数据库通信的handler，你还可以把他理解一个容器，add就是往容器中添加对象<br>执行完add方法后，ed_user对象处于pending状态，不会触发INSERT语句，当然ed_uesr.id也为None，如果在add方后有查询(session.query)，那么会flush一下，把数据刷一遍，把所有的pending信息先flush再执行query。</p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_user = Session.query(User).filter_by(name=<span class="string">"fgf"</span>).first()  <span class="comment"># 查询</span></span><br><span class="line">print(my_user) <span class="comment">#输出 &lt;__main__.User object at 0x7f0a5a3dea20&gt;</span></span><br><span class="line">print(my_user.id,my_user.name,my_user.password)</span><br><span class="line"><span class="comment"># 输出 1 fgf 123456</span></span><br></pre></td></tr></table></figure>

<p>不过刚才显示的内存对象对址没办法分清返回的是什么数据的，除非打印具体字段看一下，如果想让它变的可读，只需在定义表的类下面加上这样的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"&lt;User(name='%s',  password='%s')&gt;"</span> % ( self.name, self.password)</span><br></pre></td></tr></table></figure>

<p>完整的查询代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Table, MetaData, Column, Integer, String</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> mapper, sessionmaker</span><br><span class="line"><span class="comment"># 创建实例，并连接test库</span></span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123456@localhost/test"</span>,</span><br><span class="line">                                    encoding=<span class="string">'utf-8'</span>, echo=<span class="literal">True</span>)</span><br><span class="line">metadata = MetaData()</span><br><span class="line">user = Table(<span class="string">'user'</span>, metadata,</span><br><span class="line">            Column(<span class="string">'id'</span>, Integer, primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>),</span><br><span class="line">            Column(<span class="string">'name'</span>, String(<span class="number">50</span>)),</span><br><span class="line">            Column(<span class="string">'password'</span>, String(<span class="number">12</span>))</span><br><span class="line">        )</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, id, password)</span>:</span></span><br><span class="line">        self.id = id</span><br><span class="line">        self.name = name</span><br><span class="line">        self.password = password</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;User(name='%s',  password='%s')&gt;"</span> % (self.name, self.password)</span><br><span class="line">mapper(User, user)</span><br><span class="line"><span class="comment"># 创建与数据库的会话session class ,注意,这里返回给session的是个class,不是实例</span></span><br><span class="line">Session_class = sessionmaker(bind=engine)</span><br><span class="line">Session = Session_class()  <span class="comment"># 生成session实例</span></span><br><span class="line">my_user = Session.query(User).filter_by(name=<span class="string">"fgf"</span>).first()  <span class="comment"># 查询第一个</span></span><br><span class="line"><span class="comment"># my_user = Session.query(User).filter_by().all()  # 查询所有</span></span><br><span class="line">print(my_user)</span><br><span class="line"><span class="comment"># print(my_user.id,my_user.name,my_user.password)</span></span><br><span class="line"><span class="comment"># Session.commit()  #查询不需要commit</span></span><br></pre></td></tr></table></figure>

<h3 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h3><p>filter_by与filter</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_user1 = Session.query(User).filter(User.id&gt;<span class="number">2</span>).all()</span><br><span class="line">my_user2 = Session.query(User).filter_by(id=<span class="number">27</span>).all()  <span class="comment"># filter_by相等用‘=’</span></span><br><span class="line">my_user3 = Session.query(User).filter(User.id==<span class="number">27</span>).all()  <span class="comment"># filter相等用‘==’</span></span><br><span class="line">objs = Session.query(User).filter(User.id&gt;<span class="number">0</span>).filter(User.id&lt;<span class="number">7</span>).all()</span><br><span class="line">print(my_user1,<span class="string">'\n'</span>,my_user2,<span class="string">'\n'</span>,my_user3,<span class="string">'\n'</span>,objs)</span><br></pre></td></tr></table></figure>

<p>建立在SQLAlchemy上的几种常见的SQL查询实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">几种常见sqlalchemy查询：</span><br><span class="line"><span class="comment">#简单查询    </span></span><br><span class="line">print(session.query(User).all())</span><br><span class="line">print(session.query(User.name, User.fullname).all())    </span><br><span class="line">print(session.query(User, User.name).all())        </span><br><span class="line"><span class="comment">#带条件查询    </span></span><br><span class="line">print(session.query(User).filter_by(name=<span class="string">'user1'</span>).all())    </span><br><span class="line">print(session.query(User).filter(User.name == <span class="string">"user"</span>).all())    </span><br><span class="line">print(session.query(User).filter(User.name.like(<span class="string">"user%"</span>)).all())      </span><br><span class="line"><span class="comment">#多条件查询  </span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> and_,or_  </span><br><span class="line">print(session.query(User).filter(and_(User.name.like(<span class="string">"user%"</span>), User.fullname.like(<span class="string">"first%"</span>))).all())    </span><br><span class="line">print(session.query(User).filter(or_(User.name.like(<span class="string">"user%"</span>), User.password != <span class="literal">None</span>)).all())        </span><br><span class="line"><span class="comment">#sql过滤    </span></span><br><span class="line">print(session.query(User).filter(<span class="string">"id&gt;:id"</span>).params(id=<span class="number">1</span>).all())        </span><br><span class="line"><span class="comment">#关联查询     </span></span><br><span class="line">print(session.query(User, Address).filter(User.id == Address.user_id).all())    </span><br><span class="line">print(session.query(User).join(User.addresses).all())    </span><br><span class="line">print(session.query(User).outerjoin(User.addresses).all())        </span><br><span class="line"><span class="comment">#聚合查询    </span></span><br><span class="line">print(session.query(User.name, func.count(<span class="string">'*'</span>).label(<span class="string">"user_count"</span>)).group_by(User.name).all())    </span><br><span class="line">print(session.query(User.name, func.sum(User.id).label(<span class="string">"user_id_sum"</span>)).group_by(User.name).all())        </span><br><span class="line"><span class="comment">#子查询    </span></span><br><span class="line">stmt = session.query(Address.user_id, func.count(<span class="string">'*'</span>).label(<span class="string">"address_count"</span>)).group_by(Address.user_id).subquery()    </span><br><span class="line">print(session.query(User, stmt.c.address_count).outerjoin((stmt, User.id == stmt.c.user_id)).order_by(User.id).all())     </span><br><span class="line">   </span><br><span class="line"><span class="comment">#exists    </span></span><br><span class="line">print(session.query(User).filter(exists().where(Address.user_id == User.id)))    </span><br><span class="line">print(session.query(User).filter(User.addresses.any()))</span><br><span class="line">限制返回字段查询</span><br><span class="line">person = session.query(Person.name, Person.created_at,Person.updated_at).filter_by(name=<span class="string">"zhongwei"</span>).order_by(Person.created_at).first()</span><br><span class="line">记录总数查询：</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> func</span><br><span class="line"><span class="comment"># count User records, without</span></span><br><span class="line"><span class="comment"># using a subquery.</span></span><br><span class="line">session.query(func.count(User.id))</span><br><span class="line"><span class="comment"># return count of user "id" grouped</span></span><br><span class="line"><span class="comment"># by "name"</span></span><br><span class="line">session.query(func.count(User.id)).\</span><br><span class="line">        group_by(User.name)</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> distinct</span><br><span class="line"><span class="comment"># count distinct "name" values</span></span><br><span class="line">session.query(func.count(distinct(User.name)))</span><br></pre></td></tr></table></figure>

<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_user = Session.query(User).filter_by(name=<span class="string">"fgf"</span>).first()</span><br><span class="line">my_user.name = <span class="string">"fenggf"</span>  <span class="comment"># 查询出来之后直接赋值修改</span></span><br><span class="line">my_user.passwork = <span class="string">"123qwe"</span></span><br><span class="line">Session.commit() <span class="comment">#注意提交</span></span><br></pre></td></tr></table></figure>

<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">query = Session.query(User).filter_by(name=<span class="string">"hhh"</span>).delete()</span><br><span class="line">Session.commit()</span><br></pre></td></tr></table></figure>

<h3 id="回滚"><a href="#回滚" class="headerlink" title="回滚"></a>回滚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">my_user = Session.query(User).filter_by(id=<span class="number">1</span>).first()</span><br><span class="line">my_user.name = <span class="string">"Jack"</span></span><br><span class="line">fake_user = User(name=<span class="string">'Rain'</span>, password=<span class="string">'12345'</span>)</span><br><span class="line">Session.add(fake_user)</span><br><span class="line">print(Session.query(User).filter(User.name.in_([<span class="string">'Jack'</span>,<span class="string">'rain'</span>])).all() )  <span class="comment">#这时看session里有你刚添加和修改的数据</span></span><br><span class="line">Session.rollback() <span class="comment">#此时你rollback一下</span></span><br><span class="line">print(Session.query(User).filter(User.name.in_([<span class="string">'Jack'</span>,<span class="string">'rain'</span>])).all() ) <span class="comment">#再查就发现刚才添加的数据没有了。</span></span><br><span class="line"><span class="comment"># Session</span></span><br><span class="line"><span class="comment"># Session.commit()</span></span><br></pre></td></tr></table></figure>

<h3 id="表与表之间的关系"><a href="#表与表之间的关系" class="headerlink" title="表与表之间的关系"></a>表与表之间的关系</h3><p>SQLAlchemy中的映射关系有四种,分别是一对一,一对多,多对一,多对多。</p>
<h3 id="一对多和多对一"><a href="#一对多和多对一" class="headerlink" title="一对多和多对一"></a>一对多和多对一</h3><p>因为外键(ForeignKey)始终定义在多的一方.如果relationship定义在多的一方,那就是多对一,一对多与多对一的区别在于其关联(relationship)的属性在多的一方还是一的一方，如果relationship定义在一的一方那就是一对多.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Enum,DATE,Integer, String,ForeignKey</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker,relationship</span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123456@localhost/test"</span>,</span><br><span class="line">                                    encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">Base = declarative_base()  <span class="comment"># 生成orm基类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stu2</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">"stu2"</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">32</span>),nullable=<span class="literal">False</span>)</span><br><span class="line">    register_date = Column(DATE,nullable=<span class="literal">False</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;%s name:%s&gt;"</span> % (self.id, self.name)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudyRecord</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">"study_record"</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>)</span><br><span class="line">    day = Column(Integer,nullable=<span class="literal">False</span>)</span><br><span class="line">    status = Column(String(<span class="number">32</span>),nullable=<span class="literal">False</span>)</span><br><span class="line">    stu_id = Column(Integer,ForeignKey(<span class="string">"stu2.id"</span>))  <span class="comment">#------外键关联------</span></span><br><span class="line">    <span class="comment">#这个nb，允许你在user表里通过backref字段反向查出所有它在stu2表里的关联项数据</span></span><br><span class="line">    stu2 = relationship(<span class="string">"Stu2"</span>, backref=<span class="string">"my_study_record"</span>)  <span class="comment"># 添加关系，反查（在内存里）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;%s day:%s status:%s&gt;"</span> % (self.stu2.name, self.day,self.status)</span><br><span class="line">Base.metadata.create_all(engine)  <span class="comment"># 创建表结构</span></span><br><span class="line">Session_class = sessionmaker(bind=engine)  <span class="comment"># 创建与数据库的会话session class ,注意,这里返回给session的是个class,不是实例</span></span><br><span class="line">session = Session_class()  <span class="comment"># 生成session实例 #cursor</span></span><br><span class="line">s1 = Stu2(name=<span class="string">"A"</span>,register_date=<span class="string">"2014-05-21"</span>)</span><br><span class="line">s2 = Stu2(name=<span class="string">"J"</span>,register_date=<span class="string">"2014-03-21"</span>)</span><br><span class="line">s3 = Stu2(name=<span class="string">"R"</span>,register_date=<span class="string">"2014-02-21"</span>)</span><br><span class="line">s4 = Stu2(name=<span class="string">"E"</span>,register_date=<span class="string">"2013-01-21"</span>)</span><br><span class="line">study_obj1 = StudyRecord(day=<span class="number">1</span>,status=<span class="string">"YES"</span>, stu_id=<span class="number">1</span>)</span><br><span class="line">study_obj2 = StudyRecord(day=<span class="number">2</span>,status=<span class="string">"NO"</span>, stu_id=<span class="number">1</span>)</span><br><span class="line">study_obj3 = StudyRecord(day=<span class="number">3</span>,status=<span class="string">"YES"</span>, stu_id=<span class="number">1</span>)</span><br><span class="line">study_obj4 = StudyRecord(day=<span class="number">1</span>,status=<span class="string">"YES"</span>, stu_id=<span class="number">2</span>)</span><br><span class="line">session.add_all([s1,s2,s3,s4,study_obj1,study_obj2,study_obj3,study_obj4])  <span class="comment"># 创建</span></span><br><span class="line">session.commit()</span><br><span class="line">stu_obj = session.query(Stu2).filter(Stu2.name==<span class="string">"a"</span>).first()  <span class="comment"># 查询</span></span><br><span class="line"><span class="comment"># 在stu2表，查到StudyRecord表的记录</span></span><br><span class="line">print(stu_obj.my_study_record)  <span class="comment"># 查询A一共上了几节课</span></span><br></pre></td></tr></table></figure>

<h3 id="多对多关系"><a href="#多对多关系" class="headerlink" title="多对多关系"></a>多对多关系</h3><p>多对多关系需要一个中间关联表,通过参数secondary来指定,这个中间关联表只需要创建即可，不需要操作它，SQLAlchemy自己会管理这张表。<br><img src="/images/m2m.jpg" alt="多对多"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">post_keywords = Table(<span class="string">'student_class'</span>,Base.metadata,</span><br><span class="line">        Column(<span class="string">'student_id'</span>,Integer,ForeignKey(<span class="string">'students.id'</span>)),</span><br><span class="line">        Column(<span class="string">'class_id'</span>,Integer,ForeignKey(<span class="string">'classes.id'</span>))</span><br><span class="line">)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'students'</span></span><br><span class="line">    id = Column(Integer,primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">20</span>))</span><br><span class="line">    age = Column(Integer)</span><br><span class="line">    keywords = relationship(<span class="string">'Class'</span>,secondary=student_class,backref=<span class="string">'students'</span>)</span><br><span class="line">    <span class="comment"># keywords = relationship('Class',secondary=student_class,backref=backref('students,lazy="dynamic"),lazy="dynamic")</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'classes'</span></span><br><span class="line">    id = Column(Integer,primary_key = <span class="literal">True</span>)</span><br><span class="line">    classname = Column(String(<span class="number">50</span>),nullable=<span class="literal">False</span>,unique=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Integer, ForeignKey, String, Column</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> relationship</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line">Base = declarative_base()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'customer'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">64</span>))</span><br><span class="line">    <span class="comment"># 账单地址和邮寄地址, 都关联同一个地址表</span></span><br><span class="line">    billing_address_id = Column(Integer, ForeignKey(<span class="string">"address.id"</span>))</span><br><span class="line">    shipping_address_id = Column(Integer, ForeignKey(<span class="string">"address.id"</span>))</span><br><span class="line">    billing_address = relationship(<span class="string">"Address"</span>, foreign_keys=[billing_address_id])</span><br><span class="line">    shipping_address = relationship(<span class="string">"Address"</span>, foreign_keys=[shipping_address_id])</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'address'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>)</span><br><span class="line">    street = Column(String(<span class="number">64</span>))</span><br><span class="line">    city = Column(String(<span class="number">64</span>))</span><br><span class="line">    state = Column(String(<span class="number">64</span>))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.street</span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123456@localhost/test"</span>,</span><br><span class="line">                                    encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">Base.metadata.create_all(engine)  <span class="comment"># 创建表结构</span></span><br></pre></td></tr></table></figure>

<h2 id="Flask-SQLAlchemy的使用"><a href="#Flask-SQLAlchemy的使用" class="headerlink" title="Flask-SQLAlchemy的使用"></a>Flask-SQLAlchemy的使用</h2><p>Flask-SQLAlchemy 在 SQLAlchemy 的基础上，提供了一些常用的工具，并预设了一些默认值，帮助你更轻松地完成常见任务。flask-sqlalchemy 用起来比直接用 sqlalchemy 方便、省事，不过有些高级一点的功能如果不了解 sqlalchemy 的话会用不好。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install flask-sqlalchemy</span><br></pre></td></tr></table></figure>

<h3 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">"SQLALCHEMY_DATABASE_URI"</span>]=<span class="string">"mysql+pymysql://root:pqc19960320@120.77.220.239:32777/mydb"</span></span><br><span class="line">app.config[<span class="string">"SQLALCHEMY_TRACK_MODIFICATIONS"</span>]=<span class="literal">True</span></span><br><span class="line">db=SQLAlchemy(app)</span><br></pre></td></tr></table></figure>

<p>db对象是SQLAlchemy类的实例，表示程序使用的数据库，同时还获得了Flask-SQLAlchemy提供的所有功能。</p>
<h3 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__=<span class="string">"roles"</span></span><br><span class="line">    id=db.Column(db.Integer,primary_key=<span class="literal">True</span>)</span><br><span class="line">    name=db.Column(db.String(<span class="number">30</span>),unique=<span class="literal">True</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;Role %s&gt;"</span> % self.name</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__=<span class="string">"users"</span></span><br><span class="line">    id=db.Column(db.Integer,primary_key=<span class="literal">True</span>)</span><br><span class="line">    username=db.Column(db.String(<span class="number">64</span>),unique=<span class="literal">True</span>,index=<span class="literal">True</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;User %s&gt;"</span> % self.username</span><br></pre></td></tr></table></figure>

<p><strong>tablename</strong>定义在数据库中使用的表名，如果没有定义<strong>tablename</strong>,Flask-SQLAlchemy会使用一个默认的名字，但是默认的表名没有遵循复数形式进行命名的约定。</p>
<p>常使用的列类型</p>
<table>
<thead>
<tr>
<th align="center">类型名称</th>
<th align="center">python类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Integer</td>
<td align="center">int</td>
<td align="center">常规整形，通常为32位</td>
</tr>
<tr>
<td align="center">SmallInteger</td>
<td align="center">int</td>
<td align="center">短整形，通常为16位</td>
</tr>
<tr>
<td align="center">BigInteger</td>
<td align="center">int或long</td>
<td align="center">精度不受限整形</td>
</tr>
<tr>
<td align="center">Float</td>
<td align="center">float</td>
<td align="center">浮点数</td>
</tr>
<tr>
<td align="center">Numeric</td>
<td align="center">decimal.Decimal</td>
<td align="center">定点数</td>
</tr>
<tr>
<td align="center">String</td>
<td align="center">str</td>
<td align="center">可变长度字符串</td>
</tr>
<tr>
<td align="center">Text</td>
<td align="center">str</td>
<td align="center">可变长度字符串，适合大量文本</td>
</tr>
<tr>
<td align="center">Unicode</td>
<td align="center">unicode</td>
<td align="center">可变长度Unicode字符串</td>
</tr>
<tr>
<td align="center">UnicodeText</td>
<td align="center">unicode</td>
<td align="center">可变长度Unicode字符串,对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td align="center">Boolean</td>
<td align="center">bool</td>
<td align="center">布尔型</td>
</tr>
<tr>
<td align="center">Date</td>
<td align="center">datetime.date</td>
<td align="center">日期类型</td>
</tr>
<tr>
<td align="center">Time</td>
<td align="center">datetime.time</td>
<td align="center">时间类型</td>
</tr>
<tr>
<td align="center">DataTime</td>
<td align="center">datetime.datatime</td>
<td align="center">日期和时间</td>
</tr>
<tr>
<td align="center">Interval</td>
<td align="center">datetime.timedelta</td>
<td align="center">时间间隔</td>
</tr>
<tr>
<td align="center">Enum</td>
<td align="center">str</td>
<td align="center">字符列表</td>
</tr>
<tr>
<td align="center">PickleType</td>
<td align="center">任意Python对象</td>
<td align="center">自动Pickle序列化</td>
</tr>
<tr>
<td align="center">LargeBinary</td>
<td align="center">str</td>
<td align="center">二进制</td>
</tr>
</tbody></table>
<p>常使用的列选项</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">含义</th>
<th align="center">可选值</th>
<th align="center">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">primary_key</td>
<td align="center">主键</td>
<td align="center">True,False</td>
<td align="center">False</td>
</tr>
<tr>
<td align="center">default</td>
<td align="center">指定默认值</td>
<td align="center">自定义值</td>
<td align="center">无</td>
</tr>
<tr>
<td align="center">index</td>
<td align="center">是否建索引</td>
<td align="center">True,False</td>
<td align="center">False</td>
</tr>
<tr>
<td align="center">nullable</td>
<td align="center">字段可否可空</td>
<td align="center">True,False</td>
<td align="center">False</td>
</tr>
<tr>
<td align="center">unique</td>
<td align="center">是否允许出现重复值</td>
<td align="center">True,False</td>
<td align="center">False</td>
</tr>
</tbody></table>
<h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><h4 id="一对多和多对一-1"><a href="#一对多和多对一-1" class="headerlink" title="一对多和多对一"></a>一对多和多对一</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__=<span class="string">"roles"</span></span><br><span class="line">    id=db.Column(db.Integer,primary_key=<span class="literal">True</span>)</span><br><span class="line">    name=db.Column(db.String(<span class="number">30</span>),unique=<span class="literal">True</span>)</span><br><span class="line">    users=db.relationship(<span class="string">"User"</span>,backref=<span class="string">"role"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;Role %s&gt;"</span> % self.name</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__=<span class="string">"users"</span></span><br><span class="line">    id=db.Column(db.Integer,primary_key=<span class="literal">True</span>)</span><br><span class="line">    username=db.Column(db.String(<span class="number">64</span>),unique=<span class="literal">True</span>,index=<span class="literal">True</span>)</span><br><span class="line">    role_id=(db.Integer,db.ForeignKey(<span class="string">"roles.id"</span>))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;User %s&gt;"</span> % self.username</span><br></pre></td></tr></table></figure>

<p>两张表之间的关系事实上是由ForeignKey建立起来的，relationship在两张表之间建立了一个虚拟关系，帮助我们更方便的操作这种关系。注意：在一对多或多对一的关系中，ForeignKey只会出现在多的一方，并且它所关联的一定是另一张表的primary_key。 relationship的一个必须参数是要建立虚拟关系的表所对应类的名字，如果这个类还没有定义，可以用一个字符串代替，它的其他更多可选参数见下图：</p>
<p><img src="/images/rela.png" alt="关系选项"></p>
<p><a href="http://blog.csdn.net/bestallen/article/details/52551579" target="_blank" rel="noopener">lazy选项</a></p>
<h4 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h4><h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建表</span></span><br><span class="line">db.create_all()</span><br><span class="line"><span class="comment">#删除表</span></span><br><span class="line">db.drop_all()</span><br></pre></td></tr></table></figure>

<h5 id="插入行"><a href="#插入行" class="headerlink" title="插入行"></a>插入行</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> Role,User</span><br><span class="line">admin_role=Role(name=<span class="string">"Admin"</span>)</span><br><span class="line">mod_role=Role(name=<span class="string">"Moderator"</span>)</span><br><span class="line">user_role=Role(name=<span class="string">"User"</span>)</span><br><span class="line">john=User(usename=<span class="string">"John"</span>,role=admin_role)</span><br><span class="line">susan=User(username=<span class="string">"Susan"</span>,role=mod_role)</span><br><span class="line">david=User(username=<span class="string">"David"</span>,role=user_role)</span><br></pre></td></tr></table></figure>

<p>注意这里创建Role和User实例时，都没有传id属性，这是因为primary_key是由Flask-SQLAlchemy管理的。relationship建立的虚拟字段role和users也是可以使用的,虽然他们不是真正的数据库列，但却是一对多关系的高级表示。此时这些对象的状态是暂时的，并没有写入数据库中，此时打印对象的id值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(admin_role.id)   <span class="comment">#-&gt;None</span></span><br><span class="line">print(john.id)   <span class="comment">#-&gt;None</span></span><br></pre></td></tr></table></figure>

<p>添加如会话：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">db.session.add(admin_role)</span><br><span class="line">db.session.add(mod_role)</span><br><span class="line">db.session.add(user_role)</span><br><span class="line">db.session.add(john)</span><br><span class="line">db.session.add(susan)</span><br><span class="line">db.session.add(david)</span><br><span class="line"><span class="comment">#或者一次性添加</span></span><br><span class="line">db.session.add_all([admin_role,mod_role,user_role,john,susan,davia])</span><br><span class="line"><span class="comment">#此时这些数据对象的状态变成挂起的了，依然没有写入到数据库中，我们打印对象的id，依然是None</span></span><br><span class="line">print(admin_role.id) <span class="comment">#-&gt;None</span></span><br><span class="line"><span class="comment">#直到我们commit()之后，这些数据对象才持久化到数据库中</span></span><br><span class="line">db.commit()</span><br><span class="line">print(admin_role.id) <span class="comment">#-&gt;1</span></span><br></pre></td></tr></table></figure>

<h5 id="修改行"><a href="#修改行" class="headerlink" title="修改行"></a>修改行</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin_role.name=<span class="string">"Administrator"</span></span><br><span class="line">db.session.add(admin_role)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<h5 id="删除行"><a href="#删除行" class="headerlink" title="删除行"></a>删除行</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.session.delete(mod_role)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<h5 id="查询行"><a href="#查询行" class="headerlink" title="查询行"></a>查询行</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Role.query.all()</span><br><span class="line">[&lt;Role <span class="string">"Administrator"</span>&gt;,&lt;Role <span class="string">"User"</span>&gt;]</span><br></pre></td></tr></table></figure>

<p>Flask-SQLAlchemy为每个模型都提供了一个query对象，模型名.query就可以拿到这个query对象，在query对象的后面可以加查询过滤器，查询过滤器返回的仍然是query对象，这意味着我们还可以继续在后面追加查询过滤器，从而精确的筛选出我们需要的数据。query对象建立好之后，Flask-SQLAlchemy并没有执行SQL查询，要想真正的得到数据，我们还必须要在query对象的后面执行查询执行函数。下面是常用的查询过滤器和查询执行函数：</p>
<table>
<thead>
<tr>
<th align="center">过滤器</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">filter()</td>
<td align="center">把过滤器添加到原查询上，返回一个新查询</td>
</tr>
<tr>
<td align="center">filter_by()</td>
<td align="center">把等值过滤器添加到原查询上，返回一个新查询</td>
</tr>
<tr>
<td align="center">limit()</td>
<td align="center">使用指定的值限制原查询返回的结果数量，返回一个新查询</td>
</tr>
<tr>
<td align="center">offset()</td>
<td align="center">偏移原查询返回的结果，返回一个新查询</td>
</tr>
<tr>
<td align="center">order_by()</td>
<td align="center">根据指定条件对原查询结果进行排序，返回一个新查询</td>
</tr>
<tr>
<td align="center">group_by()</td>
<td align="center">根据指定条件对原查询结果进行分组，返回一个新查询</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">查询执行方法</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">all()</td>
<td align="center">以列表形式返回查询的所有结果</td>
</tr>
<tr>
<td align="center">first()</td>
<td align="center">返回查询的第一个结果，如果没有结果，则返回None</td>
</tr>
<tr>
<td align="center">first_or_404()</td>
<td align="center">返回查询的第一个结果，如果没有结果，则终止请求，返回404错误响应</td>
</tr>
<tr>
<td align="center">get()</td>
<td align="center">返回指定主键对应的行，如果没有对应的行，则返回None</td>
</tr>
<tr>
<td align="center">get_or_404</td>
<td align="center">返回指定主键对应的行，如果没有找到指定的主键，则终止请求，返回404错误响应</td>
</tr>
<tr>
<td align="center">count()</td>
<td align="center">返回查询结果的数量</td>
</tr>
<tr>
<td align="center">paginate()</td>
<td align="center">返回一个Paginate对象，它包含指定范围内的结果</td>
</tr>
<tr>
<td align="center">下面我们看看relationship建立的虚拟字段role,users</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(admin_role.users)</span><br><span class="line"><span class="comment">#输出：[&lt;User John&gt;]</span></span><br></pre></td></tr></table></figure></td>
<td align="center"></td>
</tr>
</tbody></table>
<p>这里有一个小问题，我们用users虚拟字段的时候，默认我们就得到了当前角色的所有用户的列表，也就是得到了查询执行函数执行之后的结果，但是如果我们想要做更加精细的筛选呢？</p>
<p>事实上，我们更期待它返回的是一个query对象，而不是结果列表。这是可以做得到的。</p>
<h5 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h5><p><img src="/images/m2m2.png" alt="多对多"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">registrations=db.Table(<span class="string">"registrations"</span>,</span><br><span class="line">    db.Column(<span class="string">"student_id"</span>,db.Integer,db.ForeignKey(<span class="string">"students.id"</span>)),</span><br><span class="line">    db.Column(<span class="string">"class_id"</span>,db.Integer,db.ForeignKey(<span class="string">"classes.id"</span>))</span><br><span class="line">)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id=db.Column(db.Integer,primary_key=<span class="literal">True</span>)</span><br><span class="line">    name=db.Column(db.String(<span class="number">20</span>))</span><br><span class="line">    classes=db.relationship(<span class="string">"Class"</span>,</span><br><span class="line">                            secondary=registrations,</span><br><span class="line">                            backref=db.backref(<span class="string">"students"</span>,lazy=<span class="string">"dynamic"</span>),</span><br><span class="line">                            lazy=<span class="string">"dynamic"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id=db.Column(db.Integer,primary_key=<span class="literal">True</span>)</span><br><span class="line">    name=db.Column(db.String(<span class="number">20</span>))</span><br><span class="line">c=Class(name=<span class="string">"语文"</span>)</span><br><span class="line"><span class="comment">#学生s注册了课程c</span></span><br><span class="line">s.classes.append(c)</span><br><span class="line">db.session.add(s)</span><br><span class="line">s.classes.remove(c)</span><br><span class="line">db.session.add(s)</span><br><span class="line"><span class="comment">#学生s注册的所有课程</span></span><br><span class="line">s.classes.all()</span><br><span class="line"><span class="comment">#注册c的所有的学生</span></span><br><span class="line">c.students.all()</span><br></pre></td></tr></table></figure>

<h5 id="自引用"><a href="#自引用" class="headerlink" title="自引用"></a>自引用</h5><p><img src="/images/zyy.png" alt="自引用"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Follow</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__=<span class="string">"follows"</span></span><br><span class="line">    follower_id=db.Column(db.Integer,db.ForeignKey(<span class="string">"users.id"</span>),primary_key=<span class="literal">True</span>)</span><br><span class="line">    followed_id=db.Column(db.Integer,db.ForeignKey(<span class="string">"user.id"</span>),primary_key=<span class="literal">True</span>)</span><br><span class="line">    timestamp=db.Column(db.DateTime,default=datetime.utcnow)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__=<span class="string">"users"</span></span><br><span class="line">    username=db.Column(db.String(<span class="number">20</span>),index=<span class="literal">True</span>)</span><br><span class="line">    followed=db.relationship(<span class="string">"Follow"</span>,</span><br><span class="line">                            foreign_key=[Follow.follower_id],</span><br><span class="line">                            backref=db.backref(<span class="string">"follower"</span>,lazy=<span class="string">"joined"</span>),</span><br><span class="line">                            lazy=<span class="string">"dynamic"</span>,</span><br><span class="line">                            cascade=<span class="string">"all,delete-orphan"</span>)</span><br><span class="line">     followers=db.relationship(<span class="string">"Follow"</span>,</span><br><span class="line">                            foreign_key=[Follow.followed_id],</span><br><span class="line">                            backref=db.backref(<span class="string">"followed"</span>,lazy=<span class="string">"joined"</span>),</span><br><span class="line">                            lazy=<span class="string">"dynamic"</span>,</span><br><span class="line">                            cascade=<span class="string">"all,delete-orphan"</span>)</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>参考内容过多，在此不一一列出，默默感谢那些走在前面的大佬。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/10/29/chapter-two-of-fluent-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/29/chapter-two-of-fluent-python/" itemprop="url">Python内置的序列类型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-29T15:38:40+08:00">
                2017-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="内置序列类型概览"><a href="#内置序列类型概览" class="headerlink" title="内置序列类型概览"></a>内置序列类型概览</h1><p>按照可否存储不同数据类型来分，可以分为容序列和扁平序列。</p>
<ul>
<li>容器序列<br>list, tuple, collections.deque　这些序列类型可以容纳不同类型的数据。</li>
<li>扁平序列<br>str, bytes, bytearray, memoryview, array.array　这类序列只能容纳一种类型的数据</li>
</ul>
<p>按照是否可变可以分为可变序列和不可变序列。</p>
<ul>
<li>可变序列<br>list, bytesarray, array.array, collections.deque, memoryview</li>
<li>不可变序列<br>tuple, str, bytes</li>
</ul>
<h1 id="列表推导式和生成器表达式"><a href="#列表推导式和生成器表达式" class="headerlink" title="列表推导式和生成器表达式"></a>列表推导式和生成器表达式</h1><p>列表推导是构建列表的快捷方式。而生成器表达式则可以用来创建其他的任何序列。</p>
<h2 id="善于使用列表推导式"><a href="#善于使用列表推导式" class="headerlink" title="善于使用列表推导式"></a>善于使用列表推导式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line">a=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">b=[<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>]</span><br><span class="line">c=[(d,e) <span class="keyword">for</span> d,e <span class="keyword">in</span> zip(a,b)]</span><br><span class="line">print(c)</span><br><span class="line">g=[(i,j) <span class="keyword">for</span> i <span class="keyword">in</span> a <span class="keyword">for</span> j <span class="keyword">in</span> b]</span><br><span class="line">pprint(g)</span><br><span class="line"><span class="string">"""注意比较c,g两个列表推导式的区别"""</span></span><br><span class="line">h=[i+i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i % <span class="number">2</span>==<span class="number">0</span>]</span><br><span class="line">print(h)</span><br><span class="line"><span class="comment">#生成器表达式</span></span><br><span class="line"><span class="comment">#把列表推导式的中括号改为圆括号就得到了生成器表达式</span></span><br><span class="line">a=(i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>))</span><br><span class="line">print(a)</span><br><span class="line">print(a.__next__())</span><br><span class="line">print(a.__next__())</span><br><span class="line">print(a.__next__())</span><br><span class="line">print(a.__next__())</span><br><span class="line">print(a.__next__())</span><br><span class="line"><span class="comment">#当生成器表达式作为函数调用过程中的唯一</span></span><br><span class="line"><span class="comment">#参数的时候不需要再用圆括号括起来</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="number">1</span>, <span class="string">'a'</span>), (<span class="number">2</span>, <span class="string">'b'</span>), (<span class="number">3</span>, <span class="string">'c'</span>)]</span><br><span class="line">[(<span class="number">1</span>, <span class="string">'a'</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="string">'b'</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="number">2</span>, <span class="string">'a'</span>),</span><br><span class="line"> (<span class="number">2</span>, <span class="string">'b'</span>),</span><br><span class="line"> (<span class="number">2</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="number">3</span>, <span class="string">'a'</span>),</span><br><span class="line"> (<span class="number">3</span>, <span class="string">'b'</span>),</span><br><span class="line"> (<span class="number">3</span>, <span class="string">'c'</span>)]</span><br><span class="line"> [<span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">16</span>]</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at <span class="number">0x7f28a9f3fc50</span>&gt;</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="元组不仅仅是不可变列表"><a href="#元组不仅仅是不可变列表" class="headerlink" title="元组不仅仅是不可变列表"></a>元组不仅仅是不可变列表</h2><p>如果仅仅是把元组理解为不可变的列表，那其他的信息——他所含有的元素的总数和他们的位置似乎就变得可有可无了。但是这样并没有发挥元组本来所有的力量。元组的特点就是它所记录数据的数量和位置。</p>
<h2 id="元组拆包"><a href="#元组拆包" class="headerlink" title="元组拆包"></a>元组拆包</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#拆包</span></span><br><span class="line">a=(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">n1,n2,n3=a</span><br><span class="line">print(n1)</span><br><span class="line">print(n2)</span><br><span class="line">print(n3)</span><br><span class="line"><span class="comment">#用*处理剩下的元素</span></span><br><span class="line">b=(<span class="string">"aaa"</span>,<span class="string">"bbb"</span>,<span class="string">"ccc"</span>,<span class="string">"ddd"</span>)</span><br><span class="line">b1,b2,*rest=b</span><br><span class="line">print(b1)</span><br><span class="line">print(b2)</span><br><span class="line">print(rest)</span><br><span class="line"><span class="comment">#变量的值</span></span><br><span class="line">m=<span class="number">1</span></span><br><span class="line">n=<span class="number">2</span></span><br><span class="line">print(m,n)</span><br><span class="line">m,n=n,m</span><br><span class="line">print(m,n)</span><br><span class="line"><span class="comment">#用*运算符把一个可迭代对象拆开作为函数的参数</span></span><br><span class="line">c=(<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myadd</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line">print(myadd(*c))</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line">[&apos;ccc&apos;, &apos;ddd&apos;]</span><br><span class="line">1 2</span><br><span class="line">2 1</span><br><span class="line">11</span><br></pre></td></tr></table></figure>

<h2 id="具名元组"><a href="#具名元组" class="headerlink" title="具名元组"></a>具名元组</h2><p>collctions.namedtuple()是一个工厂函数，它可以用来构建一个带字段名的元组和一个有名字的类。</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">City=namedtuple(<span class="string">"City"</span>,[<span class="string">"name"</span>,<span class="string">"country"</span>,<span class="string">"population"</span>])</span><br><span class="line">Beijing=City(<span class="string">"Beijing"</span>,<span class="string">"China"</span>,<span class="number">100</span>)</span><br><span class="line">Tokyo=City(<span class="string">"Tokyo"</span>,<span class="string">"Japan"</span>,<span class="number">96</span>)</span><br><span class="line">print(Beijing.country)</span><br><span class="line">print(Tokyo.population)</span><br><span class="line">print(Tokyo[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">China</span><br><span class="line"><span class="number">96</span></span><br><span class="line">Japan</span><br></pre></td></tr></table></figure>

<p>创建一个具名元组需要两个参数，一个是类名，另一个是类的各个字段的名字。后者可以是由数个字符串组成的可迭代对象，或者是由空格分隔开的字段名组成的字符串。存放在对应字段里的数据要以一串参数的形式传入到构造函数中。可以通过字段名或者位置来获取一个字段的信息。</p>
<h3 id="具名元组的属性和方法"><a href="#具名元组的属性和方法" class="headerlink" title="具名元组的属性和方法"></a>具名元组的属性和方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(City._fields)<span class="comment">#获得所有的字段名</span></span><br><span class="line">cityMsg=(<span class="string">"Shanghai"</span>,<span class="string">"China"</span>,<span class="number">99</span>)</span><br><span class="line">shanghai=City._make(cityMsg)<span class="comment">#创建对象的一种方式，和City(*cityMsg)一样</span></span><br><span class="line">print(shanghai._asdict())</span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> shanghai._asdict().items():</span><br><span class="line">    print(key,<span class="string">":"</span>,value)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">'name'</span>, <span class="string">'country'</span>, <span class="string">'population'</span>)</span><br><span class="line">OrderedDict([(<span class="string">'name'</span>, <span class="string">'Shanghai'</span>), (<span class="string">'country'</span>, <span class="string">'China'</span>), (<span class="string">'population'</span>, <span class="number">99</span>)])</span><br><span class="line">name : Shanghai</span><br><span class="line">country : China</span><br><span class="line">population : <span class="number">99</span></span><br></pre></td></tr></table></figure>

<h2 id="序列排序"><a href="#序列排序" class="headerlink" title="序列排序"></a>序列排序</h2><p>在这里我们用list这一个序列来作为例子讲解python中序列的排序，其他的可排序序列和list是一致。这里主要讨论list.sort()和sorted()。前者是对列表就地排序，它会返回None,将list改变为有序的list.而后者则不会改变传入的list，只是复制了一个新的list,将新的list调整顺序之后返回。无论是list.sort()还是sorted()都有两个可选的关键字参数：key,reverse。他们分别决定排序的标准和升降序。</p>
<h2 id="用bisect来管理已排序的序列"><a href="#用bisect来管理已排序的序列" class="headerlink" title="用bisect来管理已排序的序列"></a>用bisect来管理已排序的序列</h2><p>bisect模块包含两个主要的函数，bisect和insort两个函数都是利用二分查找算法来在有序序列中查找或插入元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line">a=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">38</span>,<span class="number">85</span>]</span><br><span class="line">b=bisect.bisect(a,<span class="number">39</span>)</span><br><span class="line"><span class="comment">#返回39插入已升序排序序列a中后仍然满足升序规则的下标值</span></span><br><span class="line">a.insert(b,<span class="number">39</span>)</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment">#上面两步操作可以直接用下面的替代</span></span><br><span class="line">c=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">38</span>,<span class="number">85</span>]</span><br><span class="line">d=bisect.insort(c,<span class="number">39</span>)<span class="comment">#直接插入并且保持升序</span></span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 38, 39, 85]</span><br><span class="line">[1, 2, 38, 39, 85]</span><br></pre></td></tr></table></figure>

<h1 id="当列表不是首选时"><a href="#当列表不是首选时" class="headerlink" title="当列表不是首选时"></a>当列表不是首选时</h1><p>有时候因为列表实在太方便了，所以python程序员会过度使用它。但是，如果你只需要处理数字列表的话，数组可能是个更好的选择，下面我们就来探讨一下可以替换列表的数据结构。</p>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>数组(array)可以紧凑盛放基本的变量，如：字符，整数，浮点数。他是一个序列类型，在表现上和list非常想，但是它存储的数据类型受到了限制，它只能存储相同的基本类型的数据。所存储的数据的类型由array对象初始化时传入的typecode指定。以下的为所支持的typecode:</p>
<table>
<thead>
<tr>
<th align="center">Typecode</th>
<th align="center">C Type</th>
<th align="center">Python Type</th>
<th align="center">Minimum size in bytes</th>
</tr>
</thead>
<tbody><tr>
<td align="center">b</td>
<td align="center">signed char</td>
<td align="center">int</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">B</td>
<td align="center">unsigned char</td>
<td align="center">int</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">u</td>
<td align="center">Py_UNICODE</td>
<td align="center">Unicode character</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">h</td>
<td align="center">signed short</td>
<td align="center">int</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">H</td>
<td align="center">unsigned char</td>
<td align="center">int</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">i</td>
<td align="center">signed int</td>
<td align="center">int</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">I</td>
<td align="center">unsigned int</td>
<td align="center">int</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">l</td>
<td align="center">signed long</td>
<td align="center">int</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">L</td>
<td align="center">unsigned long</td>
<td align="center">int</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">q</td>
<td align="center">signed long  long</td>
<td align="center">int</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">Q</td>
<td align="center">unsigned long long</td>
<td align="center">int</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">f</td>
<td align="center">float</td>
<td align="center">float</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">d</td>
<td align="center">double</td>
<td align="center">float</td>
<td align="center">8</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random</span><br><span class="line">a1=array(<span class="string">'q'</span>,(i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>)))</span><br><span class="line"><span class="comment">#其基本上和list具备相同的行为</span></span><br><span class="line">print(a1.typecode)</span><br><span class="line">print(a1[<span class="number">2</span>])</span><br><span class="line">print(a1.count(<span class="number">55</span>))</span><br><span class="line">print(a1.pop())</span><br><span class="line">a3=array(<span class="string">'d'</span>,(random() <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>**<span class="number">3</span>)))</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"float.bin"</span>,<span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    a3.tofile(f)</span><br><span class="line">a2=array(<span class="string">"d"</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"float.bin"</span>,<span class="string">"rb"</span>) <span class="keyword">as</span> f2:</span><br><span class="line">    a2.fromfile(f2,<span class="number">10</span>**<span class="number">3</span>)</span><br><span class="line">print(a2[<span class="number">3</span>])</span><br></pre></td></tr></table></figure>

<h2 id="内存视图"><a href="#内存视图" class="headerlink" title="内存视图"></a>内存视图</h2><p>memoryview是一个内置类，他能让用户在不复制内容的情况下操作同一个数组的不同切片，在数据结构之间共享内存。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line">a=array(<span class="string">'h'</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">print(a)</span><br><span class="line">m1=memoryview(a)</span><br><span class="line">print(len((m1)))</span><br><span class="line">m1[<span class="number">0</span>]=<span class="number">15</span></span><br><span class="line">print(m1)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">array(&apos;h&apos;, [1, 2, 3])</span><br><span class="line">3</span><br><span class="line">&lt;memory at 0x7f7d2df4dc48&gt;</span><br><span class="line">array(&apos;h&apos;, [15, 2, 3])</span><br></pre></td></tr></table></figure>

<h2 id="双向队列和其他形式的队列"><a href="#双向队列和其他形式的队列" class="headerlink" title="双向队列和其他形式的队列"></a>双向队列和其他形式的队列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">dq=deque(range(<span class="number">10</span>),maxlen=<span class="number">10</span>)</span><br><span class="line">print(dq)</span><br><span class="line">dq.rotate(<span class="number">3</span>)</span><br><span class="line">print(dq)</span><br><span class="line">dq.rotate(<span class="number">-3</span>)</span><br><span class="line">print(dq)</span><br><span class="line">dq.append(<span class="number">100</span>)</span><br><span class="line">print(dq)</span><br><span class="line">dq.appendleft(<span class="number">-100</span>)</span><br><span class="line">print(dq)</span><br><span class="line">dq.extend([<span class="number">111</span>,<span class="number">222</span>,<span class="number">333</span>])</span><br><span class="line">print(dq)</span><br><span class="line">dq.extendleft([<span class="number">-111</span>,<span class="number">-222</span>,<span class="number">-333</span>])</span><br><span class="line">print(dq)</span><br><span class="line">print(dq.pop())</span><br><span class="line">print(dq)</span><br><span class="line">print(dq.popleft())</span><br><span class="line">print(dq)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">deque([0, 1, 2, 3, 4, 5, 6, 7, 8, 9], maxlen=10)</span><br><span class="line">deque([7, 8, 9, 0, 1, 2, 3, 4, 5, 6], maxlen=10)</span><br><span class="line">deque([0, 1, 2, 3, 4, 5, 6, 7, 8, 9], maxlen=10)</span><br><span class="line">deque([1, 2, 3, 4, 5, 6, 7, 8, 9, 100], maxlen=10)</span><br><span class="line">deque([-100, 1, 2, 3, 4, 5, 6, 7, 8, 9], maxlen=10)</span><br><span class="line">deque([3, 4, 5, 6, 7, 8, 9, 111, 222, 333], maxlen=10)</span><br><span class="line">deque([-333, -222, -111, 3, 4, 5, 6, 7, 8, 9], maxlen=10)</span><br><span class="line">9</span><br><span class="line">deque([-333, -222, -111, 3, 4, 5, 6, 7, 8], maxlen=10)</span><br><span class="line">-333</span><br><span class="line">deque([-222, -111, 3, 4, 5, 6, 7, 8], maxlen=10)</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/10/28/chapter-one-of-fluent-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/28/chapter-one-of-fluent-python/" itemprop="url">Python数据模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-28T15:27:13+08:00">
                2017-10-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在读一本python的书Fluent Python,收获很多。如果你是一个有一定python编程经验,并且想让自己的代码变的更加pythonic,那么这本书就非常适合你。就我个人而言，看了这本书前面的几章，感觉自己以前写的东西都不是python,之前自己对python的理解太过于肤浅了。这本书打开了我重新认识python的大门。</p>
<p><img src="/images/fp.jpg" alt="fluent python"><br>书中在深入介绍许多重要的主题时还穿插着介绍了许多我自己编程时很少用到的但是又非常有用的tips，全书行文逻辑比较复杂，感觉自己无法把每一部分的内容都理清，所以干脆就按照原书中的章节和知识点记录并介绍。下面就开始第一章的内容。</p>
<h1 id="一摞python风格的纸牌"><a href="#一摞python风格的纸牌" class="headerlink" title="一摞python风格的纸牌"></a>一摞python风格的纸牌</h1><p>第一章里作者就以一摞python风格的纸牌这个例子向我们展示了python语言的强大和优美。其中涉及到python的命名元组，列表推导，<code>__len__</code>,<code>__getitem__</code>两个特殊方法等知识点。</p>
<p>下面话不多说，直接拿出代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="comment">#创建了一个命名元祖Card</span></span><br><span class="line">Card=collections.namedtuple(<span class="string">"Card"</span>,[<span class="string">"value"</span>,<span class="string">"style"</span>])</span><br><span class="line"><span class="comment">#创建了一个纸牌类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrenchDeck</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment">#准备纸牌的牌面值和花色，使用了列表推导和字符串分割</span></span><br><span class="line">    values=[str(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,<span class="number">11</span>)]+list(<span class="string">"JQKA"</span>)</span><br><span class="line">    styles=<span class="string">"spades diamonds clubs hearts"</span>.split()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._cards=[Card(value,style) <span class="keyword">for</span> value <span class="keyword">in</span> self.values</span><br><span class="line">                     <span class="keyword">for</span> style <span class="keyword">in</span> self.styles]</span><br><span class="line">    <span class="comment">#实现__len__魔术方法，使得我们的FrenchDeck的对象支持len()求元素个数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._cards)</span><br><span class="line">    <span class="comment">#实现了__getitem__魔术方法，使得我们的FrenchDeck的对象支持切片</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, position)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._cards[position]</span><br></pre></td></tr></table></figure>

<p>经过上面的简单定义，我们就得到了一个功能非常强大的类，下面我们就可以使用这个类了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">T=FrenchDeck()</span><br><span class="line"><span class="comment">#源于__len__方法</span></span><br><span class="line">length=len(T)</span><br><span class="line">print(length)</span><br><span class="line"><span class="comment">#源于__getitem__方法</span></span><br><span class="line">print(T[<span class="number">2</span>])</span><br><span class="line">print(T[<span class="number">1</span>:<span class="number">5</span>])</span><br><span class="line">print(T[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>])</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line">a=choice(T)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Card(value=<span class="string">'2'</span>, style=<span class="string">'clubs'</span>)</span><br><span class="line">[Card(value=<span class="string">'2'</span>, style=<span class="string">'diamonds'</span>), Card(value=<span class="string">'2'</span>, style=<span class="string">'clubs'</span>), Card(value=<span class="string">'2'</span>,style=<span class="string">'hearts'</span>), Card(value=<span class="string">'3'</span>, style=<span class="string">'spades'</span>)]</span><br><span class="line">[Card(value=<span class="string">'2'</span>, style=<span class="string">'diamonds'</span>), Card(value=<span class="string">'2'</span>, style=<span class="string">'hearts'</span>)]</span><br><span class="line">Card(value=<span class="string">'10'</span>, style=<span class="string">'clubs'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="命名元组"><a href="#命名元组" class="headerlink" title="命名元组"></a>命名元组</h2><p>我们可以使用collections.namedtuple(命名元组)来构建一个简单的类，这个简单的类可以用来构建只有少数属性而没有方法的对象。比如上面的Card=collections.namedtuple(“Card”,[“value”,”style”])语句就是创建了一个只有vaule,style两个属性的类Card.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="comment">#比如下面就是构建了HH类，他有a,b两个属性</span></span><br><span class="line">HH=collections.namedtuple(<span class="string">"HH"</span>,[<span class="string">'a'</span>,<span class="string">'b'</span>])</span><br><span class="line"><span class="comment">#实例化H1这个对象</span></span><br><span class="line">H1=HH(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">print(H1.a+H1.b)<span class="comment">#输出３</span></span><br></pre></td></tr></table></figure>

<p>现在就可以简单的将命名元组理解为只有属性没有方法的类，虽然在绝大多数的时候我们也是这样做的。关于命名元组的更多介绍将在介绍元组时讲到。</p>
<h2 id="len和getitem"><a href="#len和getitem" class="headerlink" title="len和getitem"></a><strong>len</strong>和<strong>getitem</strong></h2><p>在这个例子中第二个重要的知识点就是<code>__len__</code>和<code>__getitem__</code>两个魔术方法的使用，使用了<code>__len__</code>就让我们的对象直接支持内置的len()方法求元素的个数。而<code>__getitem__</code>直接就让我们的对象支持了和列表等可迭代对象同等的切片操作，并且让我们的对象直接成为可迭代对象。关于特殊方法的介绍是本书的重点，后面会介绍许多这样的方法。</p>
<h1 id="如何使用特殊方法"><a href="#如何使用特殊方法" class="headerlink" title="如何使用特殊方法"></a>如何使用特殊方法</h1><p>首先要明确的是，特殊方法的实现是为了被python解释器调用，你自己并不需要调用他们，也就是说没有<code>object.__len__()</code>这种写法，而应该写成<code>len(object)</code>。如果object是你自己定义的类的对象，那么<code>len(object)</code>执行时，python解释器就会自己去调用由你实现的<code>__len__()</code>方法。对于python的内置类型来说，比如list,str等，Cpython会抄个近路，<code>__len__()</code>会直接读取底层结构体中存储用来表示当前元素个数的变量的值并且返回，这就比逐个计数快许多。</p>
<h2 id="模拟数值类型"><a href="#模拟数值类型" class="headerlink" title="模拟数值类型"></a>模拟数值类型</h2><p>下面我们通过一个特殊方法实现一个二维向量类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> hypot</span><br><span class="line"><span class="comment">#hypot(x,y)返回x**2+y**2的和开平方</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,x=<span class="number">0</span>,y=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.x=x</span><br><span class="line">        self.y=y</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="string">"""支持加法"""</span></span><br><span class="line">        <span class="keyword">return</span> Vector(self.x+other.x,self.y+other.y)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="string">"""支持乘法"""</span></span><br><span class="line">        <span class="keyword">return</span> Vector(self.x*other,self.y*other)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""支持求绝对值(求模)"""</span></span><br><span class="line">        <span class="keyword">return</span> hypot(self.x,self.y)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Vector Object Vector(%s,%s)"</span>%(self.x,self.y)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""长度是否为０"""</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))</span><br></pre></td></tr></table></figure>

<p>下面我们就可以使用这个Vector类了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">v1=Vector(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">v2=Vector(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">v3=v1+v2</span><br><span class="line">print(v3)</span><br><span class="line">v4=v1*<span class="number">3</span></span><br><span class="line">print(v4)</span><br><span class="line">print(abs(v1))</span><br><span class="line">v5=Vector()</span><br><span class="line">print(bool(v1))</span><br><span class="line">print(bool(v5))</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vector Object Vector(<span class="number">3</span>,<span class="number">5</span>)</span><br><span class="line">Vector Object Vector(<span class="number">3</span>,<span class="number">6</span>)</span><br><span class="line"><span class="number">2.23606797749979</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="字符串的表示形式"><a href="#字符串的表示形式" class="headerlink" title="字符串的表示形式"></a>字符串的表示形式</h2><p>python中有两个内置函数repr()和str()两者都可以把一个对象用字符串的形式表达出来以便于辨认。当然，str()还有着类型转换的作用。对于自定义类的对象来说，他们两个分别依赖于<strong>repr</strong>(),<strong>str</strong>()两个特殊方法。交互式控制台和调试程序用repr函数来获得对象的字符串表示形式。而在程序中使用str(object)函数或者print(object)的时候会调用<strong>str</strong>().如果你只想实现两个特殊方法中的一个，<strong>repr</strong>()是个更好的选择，因为一个对象没有<strong>str</strong>()函数的时候，而python又需要调用它的时候，解释器会用<strong>repr</strong>()作为替代。</p>
<h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><p>在Vector的例子中，我们通过<strong>add</strong>()和<strong>mul</strong>()为Vector类带来了+和*这两个运算符。需要注意的是，这两个方法的返回值都是新创建的向量对象，被操作的对象本身并没有发生变化，在程序中只是读取了他们的值而已。</p>
<h2 id="自定义的布尔值"><a href="#自定义的布尔值" class="headerlink" title="自定义的布尔值"></a>自定义的布尔值</h2><p>尽管python里有bool类型，但是实际上任何的对象都可以用于需要布尔值的上下文中。为了判断一个值x是真是假，python会调用bool(x),这个函数只能返回True或者False.</p>
<p>默认情况下，我们自己定义的类的实例总被认为是真，除非这个类对<strong>bool</strong>()或者<strong>len</strong>()函数有自己的实现。bool(x)的背后是调用x.<strong>bool</strong>()的结果，如果不存在这个方法，那么bool(x)会尝试调用x.<strong>len</strong>()如果返回0,则bool(x)会返回False,否则返回True.</p>
<h1 id="python之禅-The-Zen-of-Python"><a href="#python之禅-The-Zen-of-Python" class="headerlink" title="python之禅(The Zen of Python)"></a>python之禅(The Zen of Python)</h1><p>在python交互式控制台中输入import this即可看到。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">The Zen of Python, by Tim Peters</span><br><span class="line">Beautiful is better than ugly.</span><br><span class="line">Explicit is better than implicit.</span><br><span class="line">Simple is better than complex.</span><br><span class="line">Complex is better than complicated.</span><br><span class="line">Flat is better than nested.</span><br><span class="line">Sparse is better than dense.</span><br><span class="line">Readability counts.</span><br><span class="line">Special cases aren&apos;t special enough to break the rules.</span><br><span class="line">Although practicality beats purity.</span><br><span class="line">Errors should never pass silently.</span><br><span class="line">Unless explicitly silenced.</span><br><span class="line">In the face of ambiguity, refuse the temptation to guess.</span><br><span class="line">There should be one-- and preferably only one --obvious way to do it.</span><br><span class="line">Although that way may not be obvious at first unless you&apos;re Dutch.</span><br><span class="line">Now is better than never.</span><br><span class="line">Although never is often better than *right* now.</span><br><span class="line">If the implementation is hard to explain, it&apos;s a bad idea.</span><br><span class="line">If the implementation is easy to explain, it may be a good idea.</span><br><span class="line">Namespaces are one honking great idea -- let&apos;s do more of those!</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/10/24/something-about-c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/something-about-c/" itemprop="url">C++总结1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T08:35:14+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index">
                    <span itemprop="name">C/C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>上学期的时候自学过c++,之后就一直在搞其他的高级语言.这学期选了一个面向对象程序设计的课，讲的是c++。但是我发现自己把c++的语法快忘干净了。所以这几天又在看c++的书了。感觉第二次看比第一次看要简单很多。许多东西扫一扫基本上也就知道是怎么回事了。但是温故而知新，我又发现了很多新的知识点和一些以前没遇到过的坑。这些坑绝大部分是来源于开发环境的变化（以前是在windows上的ide中开发的，而现在却是在linux上用一个简单的文本编辑器编辑的)。以下的点全部基于g++编译器和Ｕｂｕｎｔｕ操作系统，其他的编译器或操作系统可能情况不同。</p>
<h1 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h1><h2 id="类的相互引用"><a href="#类的相互引用" class="headerlink" title="类的相互引用"></a>类的相互引用</h2><p>有时，我们在定义多个类的时候可能会遇到两个类的相互引用的情况，比如下面：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">	<span class="function">B <span class="title">func</span><span class="params">(...)</span></span>;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">	B obj;</span><br><span class="line">	...</span><br><span class="line">&#125;;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">B</span>&#123;</span></span><br><span class="line"> 	<span class="keyword">public</span>:</span><br><span class="line">	<span class="function">A <span class="title">func</span><span class="params">(...)</span></span>;</span><br><span class="line">	...</span><br><span class="line"> 	<span class="keyword">private</span>:</span><br><span class="line"> 	A obj;</span><br><span class="line">	...</span><br><span class="line"> &#125;；</span><br></pre></td></tr></table></figure>

<p>这就出现了这样的尴尬局面：当把A放在B前面的时候，A中引用的B还没有定义，反之亦然。这时我们可以在两个类的定义之前先声明两个类就可以解决这个问题了，向下面这样：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先申明两个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">	<span class="function">B <span class="title">func</span><span class="params">(...)</span></span>;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">	B obj;</span><br><span class="line">	...</span><br><span class="line">&#125;;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">B</span>&#123;</span></span><br><span class="line"> 	<span class="keyword">public</span>:</span><br><span class="line">	<span class="function">A <span class="title">func</span><span class="params">(...)</span></span>;</span><br><span class="line">	...</span><br><span class="line"> 	<span class="keyword">private</span>:</span><br><span class="line"> 	A obj;</span><br><span class="line">	...</span><br><span class="line"> &#125;；</span><br></pre></td></tr></table></figure>

<h2 id="定义类时引用自身"><a href="#定义类时引用自身" class="headerlink" title="定义类时引用自身"></a>定义类时引用自身</h2><p>还有时我们可能会在一个类的定义的时候使用了这个类，比如下面这样：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(A&amp; )</span></span>;</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">	A obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这在g++这个编译器中会报错，显示A没有定义，这个时候的解决办法其实和上面的是一样的，我们可以在前面加上类的声明：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明类A</span></span><br><span class="line">calss A;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(A&amp; )</span></span>;</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">	A obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="类定义后面要加分号"><a href="#类定义后面要加分号" class="headerlink" title="类定义后面要加分号"></a>类定义后面要加分号</h2><p>这个问题也不是什么大问题，但是以前这个问题一直是ide帮我解决的，现在没有ide了，就写一下提醒自己吧！</p>
<h1 id="多文件编译与链接"><a href="#多文件编译与链接" class="headerlink" title="多文件编译与链接"></a>多文件编译与链接</h1><p>以前有ide，要想检验自己写的对不对，只需要点个按钮就行了，完全不用自己去管多文件之间的依赖关系，编译链接这些东西的，因为ide已经帮你做好了。但是在linux上则不同。现在这些工作都需要自己完成。</p>
<h2 id="关于gcc和g"><a href="#关于gcc和g" class="headerlink" title="关于gcc和g++"></a>关于gcc和g++</h2><p>在正式了解多文件编译与链接之前，先了解一下gcc和g++.</p>
<blockquote>
<p>gcc 最开始的时候是 GNU C Compiler, 如你所知，就是一个c编译器。但是后来因为这个项目里边集成了更多其他不同语言的编译器，GCC就代表 the GNU Compiler Collection，所以表示一堆编译器的合集。 g++则是GCC的c++编译器。现在你在编译代码时调用的gcc，已经不是当初那个c语言编译器了，更确切的说他是一个驱动程序，根据代码的后缀名来判断调用c编译器还是c++编译器 (g++)。比如你的代码后缀是*.c，他会调用c编译器还有linker去链接c的library。如果你的代码后缀是cpp, 他会调用g++编译器，当然librarycall也是&gt;c++版本的。当然我说了这么多你可能感到有些混乱，没关系，你就把gcc当成c语言编译器，g++当成c++语言编译器用就是了。</p>
</blockquote>
<p>出处：<a href="https://www.zhihu.com/question/20940822/answer/16667772" target="_blank" rel="noopener">https://www.zhihu.com/question/20940822/answer/16667772</a></p>
<h2 id="几个g-命令"><a href="#几个g-命令" class="headerlink" title="几个g++命令"></a>几个g++命令</h2><p>假设我们有一个test.cpp源文件，我们要把他编译链接成test.exe文件，这会经历下面这些步骤：<br>１.预处理[预处理器]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -E test.cpp &gt; test.i</span><br></pre></td></tr></table></figure>

<p>功能：输出预处理后的文件，linux下以.i为后缀名。只激活预处理,这个不生成文件,你需要把它重定向到一个输出文件里 。这一步主要做了这些事情：宏的替换，还有注释的消除，还有找到相关的库文件。用编辑器打开test.i会发现有很多很多代码，你只需要看最后部分就会发现，预处理做了宏的替换，还有注释的消除，可以理解为无关代码的清除。</p>
<p>2.将预处理后的文件不转换成汇编语言,生成以.s结尾的文件[编译器]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -S test.cpp</span><br></pre></td></tr></table></figure>

<p>功能:会生成test.s文件，.s文件表示是汇编文件，用编辑器打开就都是汇编指令。</p>
<p>3.由汇编指令变为目标代码(机器代码)生成.o的文件[汇编器as]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -c test.cpp</span><br></pre></td></tr></table></figure>

<p>功能：.o是GCC生成的目标文件，除非你是做编译器和连接器调试开发的，否则打开这种.o没有任何意义。二进制机器码一般人也读不了。</p>
<p>4.连接目标代码,生成可执行程序[链接器ld]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ test.o -L F:\vs2008\VC\include\iostream</span><br></pre></td></tr></table></figure>

<p>功能：将.o文件与所需的库文件链接整合形成.exe文件，这就是可执行文件。-L 表示链接，这里我后面写的是绝对路径，相对各人电脑不同</p>
<p>在上面各个步骤中你可以用-o命令输出你自己想要的各种名字。比如最后一个命令，用下面的输出test.exe<br>你可以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ Test.o -o Test.exe -L F:\vs2008\VC\include\iostream</span><br></pre></td></tr></table></figure>

<p>上面的四个步骤其实可以合并成一条命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ test.cpp</span><br></pre></td></tr></table></figure>

<p>这一条命令包含了上面的四个步骤，在ubuntu16.4上会默认生成名为a.out的可执行文件，这样我们就可以通过./a.out来执行这个可执行文件了。<br>我们也可以指定生成的可执行文件的文件名，通过-o选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -o test.exe test.cpp</span><br></pre></td></tr></table></figure>

<h2 id="为什么用多文件"><a href="#为什么用多文件" class="headerlink" title="为什么用多文件"></a>为什么用多文件</h2><p>在实际的开发中，为了便于团队的协作和保持代码的可维护性，加强代码的可重用性，以及通过设计抽象数据类型来加强封装，使的将不同功能的模块放在不同的文件中是一种最好的选择。程序的实现往往是通过一个一个组件来实现的，而程序的组件往往是通过一个或几个封装好的类来实现的，为了符合抽象数据类型(ADT)的设计原则,组件的设计者通常都是将类的接口文件(类的声明)，类的实现文件(类的具体功能的实现)分开来写，而使用这个组件的应用程序又是放在另外的一个文件中。这样来看在一个文件中就有了３中类型的文件：接口文件，实现文件，应用程序文件。他们彼此之间通过相互include来建立联系。这样一来，在一个项目中，文件与文件之间就有了非常复杂的依赖关系。所以在编译时先编译谁后编译谁就成了一个问题。</p>
<h2 id="用makefile解决问题"><a href="#用makefile解决问题" class="headerlink" title="用makefile解决问题"></a>用makefile解决问题</h2><p>make+makefile可以非常方便的控制这种程序的编译链接问题。<br>先来看下面的一个小项目：<br>projectName:<br>student.h<br>student.cpp<br>main.cpp<br>这是一个小小的项目，student.h(接口文件)中定义了一个学生类，代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//防止重复定义</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> STUDENT_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STUDENT_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//这里先声明一下，因为在这个类的定义中使用了这个类本身</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>;</span></span><br><span class="line"><span class="comment">//定义这个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Student(<span class="built_in">string</span> name,<span class="keyword">int</span> age,<span class="keyword">int</span> score);</span><br><span class="line">    Student();</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="built_in">string</span> name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">int</span> score)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="title">is_score_equal</span><span class="params">(Student t1,Student t2)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">int</span> score;</span><br><span class="line">&#125;;<span class="comment">//注意类的定义的末尾需要有分号</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">student.cpp(实现文件)中实现了这个类的功能，代码如下：</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"student.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">Student::Student(<span class="built_in">string</span> name,<span class="keyword">int</span> age,<span class="keyword">int</span> score):name(name),age(age),score(score)&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"初始化成功"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line">Student::Student():name(<span class="string">"none"</span>),age(<span class="number">18</span>),score(<span class="number">60</span>)&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"初始化成功"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">string</span> Student::getName()&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> Student::setName(<span class="built_in">string</span> _name)&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*这里传入的变量名称最好不要与私有变量名相同,如传入name,然后</span></span><br><span class="line"><span class="comment">*赋值写为name=name,这在g++中会报错，下面其他的也一样</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    name=_name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> Student::getAge()&#123;</span><br><span class="line">    <span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> Student::setAge(<span class="keyword">int</span> _age)&#123;</span><br><span class="line">    age=_age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> Student::getScore()&#123;</span><br><span class="line">    <span class="keyword">return</span> score;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> Student::setScore(<span class="keyword">int</span> _score)&#123;</span><br><span class="line">    </span><br><span class="line">    score=_score;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_score_equal</span><span class="params">(Student t1,Student t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t1.score==t2.score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main.cpp(应用程序文件)使用了这个类：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"student.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="function">Student <span class="title">s1</span><span class="params">(<span class="string">"小明"</span>,<span class="number">20</span>,<span class="number">96</span>)</span></span>;</span><br><span class="line">    Student s2;</span><br><span class="line">    s2.setScore(<span class="number">96</span>);</span><br><span class="line">    s2.setAge(<span class="number">55</span>);</span><br><span class="line">    <span class="keyword">bool</span> b=is_score_equal(s1,s2);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;s2.getAge()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;b&lt;&lt;<span class="string">" "</span>&lt;&lt;s1.getScore()&lt;&lt;<span class="string">" "</span>&lt;&lt;s2.getScore()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我要把这个项目编译出来，那么我需要一个名为makefile的文件来指定文件的依赖关系和编译链接逻辑，下面先拿出makefile:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">main.exe:main.o student.o </span></span><br><span class="line">	g++ -o main.exe student.o main.o</span><br><span class="line"><span class="section">student.o:student.cpp student.h</span></span><br><span class="line">	g++ -c student.cpp</span><br><span class="line"><span class="section">main.o:main.cpp</span></span><br><span class="line">	g++ -c main.cpp</span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm main.exe main.o student.o</span><br></pre></td></tr></table></figure>

<p>把这个makefile文件放在项目根目录，这时只有我们在根目录执行make命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br></pre></td></tr></table></figure>

<p>执行完后就可以在项目目录中看到main.o,student.o两个目标文件，和main.exe这个可执行文件，这个main.exe就是我们最终需要的那个文件了。这时我们再执行./main.exe就可以执行我们的程序了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./main.exe</span><br></pre></td></tr></table></figure>

<p>同时，如果我们想要清除中间生成的目标文件和最终的可执行文件，从而进行重新编译链接，我们可以使用下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make clean</span><br></pre></td></tr></table></figure>

<h2 id="makefile的语法"><a href="#makefile的语法" class="headerlink" title="makefile的语法"></a>makefile的语法</h2><p>更多关于makefile的内容请参考<a href="http://wiki.ubuntu.org.cn/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile:MakeFile%E4%BB%8B%E7%BB%8D#makefile.E7.9A.84.E8.A7.84.E5.88.99" target="_blank" rel="noopener">这里</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/10/10/Eight-Queens/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/10/Eight-Queens/" itemprop="url">递归和非递归解决八皇后问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-10T13:22:55+08:00">
                2017-10-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h1><p>八皇后问题是一个以国际象棋为背景的问题：如何能够在8×8的国际象棋棋盘上放置八个皇后，使得任何一个皇后都无法直接吃掉其他的皇后？为了达到此目的，任两个皇后都不能处于同一条横行、纵行或斜线上。八皇后问题可以推广为更一般的n皇后摆放问题：这时棋盘的大小变为n×n，而皇后个数也变成n。当且仅当n = 1或n ≥ 4时问题有解.<br><img src="/images/%E5%85%AB%E7%9A%87%E5%90%8E.png" alt="八皇后示意图"></p>
<p>八皇后问题最早是由国际象棋棋手马克斯·贝瑟尔（Max Bezzel）于1848年提出。第一个解在1850年由弗朗兹·诺克（Franz Nauck）给出。并且将其推广为更一般的n皇后摆放问题。诺克也是首先将问题推广到更一般的n皇后摆放问题的人之一。</p>
<h1 id="递归实现求解八皇后-N皇后"><a href="#递归实现求解八皇后-N皇后" class="headerlink" title="递归实现求解八皇后(N皇后)"></a>递归实现求解八皇后(N皇后)</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 12</span></span><br><span class="line"><span class="keyword">int</span> a[MAX]=&#123;<span class="number">0</span>&#125;;<span class="comment">//下标表示行，对应的值表示列</span></span><br><span class="line"><span class="keyword">int</span> sum=<span class="number">0</span>;<span class="comment">//解的总数</span></span><br><span class="line"><span class="comment">//打印摆放好的棋盘</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">int</span> *a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;MAX<span class="number">-1</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;MAX<span class="number">-1</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i]==j)&#123;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="string">"Q "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="string">"* "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//现在假设第n行以前的都放好了，现在检查第n+1是否可以放置皇后</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]==a[n]||<span class="built_in">abs</span>(a[i]-a[n])==(n-i))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;MAX;i++)&#123;</span><br><span class="line">        a[n]=i;</span><br><span class="line">        <span class="keyword">if</span>(check(n))&#123;</span><br><span class="line">            <span class="keyword">if</span>(n==MAX<span class="number">-1</span>)&#123;</span><br><span class="line">                <span class="comment">//说明此时全部摆放完成，下面打印排放的结果</span></span><br><span class="line">                show(a);</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                sum+=<span class="number">1</span>;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;sum&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                put(n+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    put(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"sum:"</span>&lt;&lt;sum&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="非递归实现求解八皇后-N皇后"><a href="#非递归实现求解八皇后-N皇后" class="headerlink" title="非递归实现求解八皇后(N皇后)"></a>非递归实现求解八皇后(N皇后)</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 8</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INIT -1</span></span><br><span class="line"><span class="keyword">int</span> q[MAX]=&#123;INIT&#125;;</span><br><span class="line"><span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> row,<span class="keyword">int</span> col)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;MAX;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(q[i]==col||<span class="built_in">abs</span>(q[i]-col)==<span class="built_in">abs</span>(row-i))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">int</span> * a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;MAX<span class="number">-1</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;MAX<span class="number">-1</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i]==j)&#123;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="string">"Q "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="string">"* "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;MAX)&#123;</span><br><span class="line">        <span class="keyword">while</span>(j&lt;MAX)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;check(i,j)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">if</span>(check(i,j))&#123;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="string">"ok"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                q[i]=j;</span><br><span class="line">                j=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                ++j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这个第i行都没有地方放，这时就需要回溯，就说明上面</span></span><br><span class="line">        <span class="comment">//有的行放错了位置</span></span><br><span class="line">        <span class="keyword">if</span>(q[i]==INIT)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                i--;</span><br><span class="line">                j=q[i]+<span class="number">1</span>;</span><br><span class="line">                q[i]=INIT;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//说明此时已经排好一组了</span></span><br><span class="line">        <span class="keyword">if</span>(i==MAX<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;sum+<span class="number">1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            show(q);</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            sum+=<span class="number">1</span>;</span><br><span class="line">            j=q[i]+<span class="number">1</span>;</span><br><span class="line">            q[i]=INIT;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"sum:"</span>&lt;&lt;sum&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/09/28/Linked-List/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/28/Linked-List/" itemprop="url">单链表</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-28T13:09:24+08:00">
                2017-09-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这一篇博客总结一下单链表常见方法的实现。相比于动态数组，对于单链表来说，它存储的元素并不要求在内存上连续，元素与元素之间通过指针串联起来。这样有许多好处，比如在单链表中间位置插入和删除元素的效率非常高，同时，它也有不足之处，它无法像动态数组那样可以通过下标直接访问。</p>
<p>链表实现的关键在于指针。一个节点除了保存着数据本身，还保存着指向下一个节点的指针。这样我们就可以通过一个节点找到下一个节点。从而将所有数据连接起来。<br><img src="/images/%E5%8D%95%E9%93%BE%E8%A1%A8.png" alt="单链表示意图"><br>如上图所示，首先有一个头结点，该节点的数据域并不存放有效数据，指针域指向下一个节点。而最后的一个节点的指针域指向NULL。下面我来总结一下单链表的常见操作。</p>
<h1 id="面向过程实现单链表操作"><a href="#面向过程实现单链表操作" class="headerlink" title="面向过程实现单链表操作"></a>面向过程实现单链表操作</h1><h2 id="定义结构体"><a href="#定义结构体" class="headerlink" title="定义结构体"></a>定义结构体</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">next</span>;</span>    </span><br><span class="line">&#125;Node,*NodePtr;</span><br></pre></td></tr></table></figure>

<p>结构体中存储着int类型的数据，和指向自身类型的指针。</p>
<h2 id="初始化链表"><a href="#初始化链表" class="headerlink" title="初始化链表"></a>初始化链表</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">NodePtr <span class="title">createList</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    NodePtr headPtr=<span class="keyword">new</span> Node;</span><br><span class="line">    <span class="keyword">if</span>(headPtr==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"分配内存失败"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    headPtr-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> headPtr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里分配头节点的内存空间，并且将头结点中的指针赋值为NULL,防止其指向了不明的变量。由于头结点不存放实际的数据，所以并没有对data赋值。最后返回指向头结点的指针(即头指针)。</p>
<h2 id="计算长度"><a href="#计算长度" class="headerlink" title="计算长度"></a>计算长度</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">listSize</span><span class="params">(NodePtr phead)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//跳过头结点</span></span><br><span class="line">    phead=phead-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(phead!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        i+=<span class="number">1</span>;</span><br><span class="line">        phead=phead-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里计算的是链表中有效节点的个数，由于头结点并不包含有效数据，所以直接跳过了头节点(phead=phead-&gt;next),while循环的条件为phead!=NULL,这是因为我们在设计链表的时候总是会将最后一个节点中的指针指向NULL,所以当phead==NULL时，链表也就循环完了。</p>
<h2 id="打印链表"><a href="#打印链表" class="headerlink" title="打印链表"></a>打印链表</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printList</span><span class="params">(NodePtr phead)</span></span>&#123;</span><br><span class="line">    phead=phead-&gt;next;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"打印所有节点："</span>;</span><br><span class="line">    <span class="keyword">while</span>(phead!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;phead-&gt;data&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">        phead=phead-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里与上方求链表的长度是一致的。</p>
<h2 id="增加数据"><a href="#增加数据" class="headerlink" title="增加数据"></a>增加数据</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addNode</span><span class="params">(NodePtr phead)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"输入你要增加的节点数："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;a;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;a;i++)&#123;</span><br><span class="line">        NodePtr ptemp=<span class="keyword">new</span> Node;</span><br><span class="line">        <span class="keyword">if</span>(ptemp==<span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"分配内存失败"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ptemp-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"输入第"</span>&lt;&lt;i+<span class="number">1</span>&lt;&lt;<span class="string">"个节点的数据值"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;ptemp-&gt;data;</span><br><span class="line">        phead-&gt;next=ptemp;</span><br><span class="line">        phead=phead-&gt;next;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里以循环的方式增加链表的节点个数。通过收集控制台的输入来决定增加的数据的个数和具体的数据。每一个节点的增加都要经历如下的步骤：</p>
<ul>
<li>分配内存空间</li>
<li>赋值，数据域赋对应值，指针域赋值为NULL</li>
<li>链接，将新节点链接到链表的尾端</li>
</ul>
<p>下面的是一个节点加入到链表尾端的示意图:<br><img src="/images/%E9%93%BE%E8%A1%A8%E5%B0%BE%E9%83%A8%E6%8F%92%E5%85%A5.png" alt="尾端添加节点示意图"></p>
<h2 id="在头部插入节点"><a href="#在头部插入节点" class="headerlink" title="在头部插入节点"></a>在头部插入节点</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertAtHead</span><span class="params">(NodePtr phead)</span></span>&#123;</span><br><span class="line">    NodePtr ptemp=<span class="keyword">new</span> Node;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"输入在头部插入的数据值"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;ptemp-&gt;data;</span><br><span class="line">    ptemp-&gt;next=phead-&gt;next;</span><br><span class="line">    phead-&gt;next=ptemp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E5%A4%B4%E9%83%A8%E6%8F%92%E5%85%A5.png" alt="头部插入节点示意图"></p>
<h2 id="尾部插入"><a href="#尾部插入" class="headerlink" title="尾部插入"></a>尾部插入</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertAtTail</span><span class="params">(NodePtr phead)</span></span>&#123;</span><br><span class="line">    <span class="comment">//先创建需要插入的节点</span></span><br><span class="line">    NodePtr pinsert=<span class="keyword">new</span> Node;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"输入在尾部插入的数据"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;pinsert-&gt;data;</span><br><span class="line">    pinsert-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">    NodePtr ptemp=phead;</span><br><span class="line">    phead=phead-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(phead!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        phead=phead-&gt;next;</span><br><span class="line">        ptemp=ptemp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    ptemp-&gt;next=pinsert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="匹配并删除第一个匹配节点"><a href="#匹配并删除第一个匹配节点" class="headerlink" title="匹配并删除第一个匹配节点"></a>匹配并删除第一个匹配节点</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteOneNode</span><span class="params">(NodePtr phead,<span class="keyword">int</span> _data)</span></span>&#123;</span><br><span class="line">    NodePtr ptemp;</span><br><span class="line">    ptemp=phead;</span><br><span class="line">    phead=phead-&gt;next;</span><br><span class="line">    <span class="comment">//空链表的情况</span></span><br><span class="line">    <span class="keyword">if</span>(phead==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"链表为空！"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(phead!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="comment">//找到了</span></span><br><span class="line">        <span class="keyword">if</span>(phead-&gt;data==_data)&#123;</span><br><span class="line">            ptemp-&gt;next=phead-&gt;next;</span><br><span class="line">            <span class="keyword">delete</span> phead;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//没找到</span></span><br><span class="line">        phead=phead-&gt;next;</span><br><span class="line">        ptemp=ptemp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们需要一前一后的指针来分别指向一前一后两个节点。前面的指针负责寻找目标节点，当找到了目标节点之后就将目标节点后一个节点的指针域指向目标节点的下一个节点，这样目标节点也就不再属于该链表了。同时释放目标节点的内存。跳出循环，这样也就删除了匹配的第一个节点。</p>
<h2 id="匹配并删除所有匹配节点"><a href="#匹配并删除所有匹配节点" class="headerlink" title="匹配并删除所有匹配节点"></a>匹配并删除所有匹配节点</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteAllNode</span><span class="params">(NodePtr phead,<span class="keyword">int</span> _data)</span></span>&#123;</span><br><span class="line">    NodePtr ptemp;</span><br><span class="line">    ptemp=phead;</span><br><span class="line">    phead=phead-&gt;next;</span><br><span class="line">    <span class="comment">//空链表的情况</span></span><br><span class="line">    <span class="keyword">if</span>(phead==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"链表为空！"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(phead!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(phead-&gt;data==_data)&#123;</span><br><span class="line">            ptemp-&gt;next=phead-&gt;next;</span><br><span class="line">            <span class="keyword">delete</span> phead;</span><br><span class="line">            phead=ptemp-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        phead=phead-&gt;next;</span><br><span class="line">        ptemp=ptemp-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">``` </span><br><span class="line">这里与上面的删除第一个匹配的节点的情况差不多，只不过在删除了一个节点之后还需要保持phead和ptemp的这种一前一后的关系，让他继续去删除所有匹配的节点。这里大家可能会有点奇怪，明明phead已经被释放了，为什么还可以将ptemp-&gt;next赋给phead呢？其实这里需要注意的是<span class="keyword">delete</span> phead只是释放了phead所指向的那一块内存，并没有释放phead变量本身。</span><br><span class="line"></span><br><span class="line">## 销毁整个链表</span><br><span class="line">``` c++</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">destoryList</span><span class="params">(NodePtr phead)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(phead-&gt;next!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        destoryList(phead-&gt;next);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> phead; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里使用递归的方式释放了整个链表。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//创建头结点</span></span><br><span class="line">    NodePtr phead=createList();</span><br><span class="line">    <span class="comment">//测试增加节点</span></span><br><span class="line">    addNode(phead);</span><br><span class="line">    printList(phead);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"节点数量："</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;listSize(phead)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// //测试从尾部插入一个节点</span></span><br><span class="line">    insertAtTail(phead);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"从尾部插入节点后："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    printList(phead);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"节点数量："</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;listSize(phead)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    insertAtHead(phead);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"从头插入节点后："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    printList(phead);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"节点数量："</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;listSize(phead)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//测试删除第一个匹配的节点</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入你要删除的元素的值(只删除第一个匹配的值)："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;a;</span><br><span class="line">    deleteOneNode(phead,a);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"删除第一个"</span>&lt;&lt;a&lt;&lt;<span class="string">"后："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    printList(phead);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"节点数量："</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;listSize(phead)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//测试删除所有匹配的节点</span></span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入你要删除的元素的值(将删除所有匹配的值)："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;b;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;b;</span><br><span class="line">    deleteAllNode(phead,b);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"删除所有的"</span>&lt;&lt;b&lt;&lt;<span class="string">"后："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    printList(phead);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"节点数量："</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;listSize(phead)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    destoryList(head);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">输入你要增加的节点数：</span><br><span class="line"><span class="number">10</span></span><br><span class="line">输入第<span class="number">1</span>个节点的数据值</span><br><span class="line"><span class="number">1</span></span><br><span class="line">输入第<span class="number">2</span>个节点的数据值</span><br><span class="line"><span class="number">2</span></span><br><span class="line">输入第<span class="number">3</span>个节点的数据值</span><br><span class="line"><span class="number">5</span></span><br><span class="line">输入第<span class="number">4</span>个节点的数据值</span><br><span class="line"><span class="number">3</span></span><br><span class="line">输入第<span class="number">5</span>个节点的数据值</span><br><span class="line"><span class="number">2</span></span><br><span class="line">输入第<span class="number">6</span>个节点的数据值</span><br><span class="line"><span class="number">1</span></span><br><span class="line">输入第<span class="number">7</span>个节点的数据值</span><br><span class="line"><span class="number">4</span></span><br><span class="line">输入第<span class="number">8</span>个节点的数据值</span><br><span class="line"><span class="number">5</span></span><br><span class="line">输入第<span class="number">9</span>个节点的数据值</span><br><span class="line"><span class="number">6</span></span><br><span class="line">输入第<span class="number">10</span>个节点的数据值</span><br><span class="line"><span class="number">8</span></span><br><span class="line">打印所有节点：<span class="number">1</span> <span class="number">2</span> <span class="number">5</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> </span><br><span class="line">节点数量：<span class="number">10</span></span><br><span class="line">输入在尾部插入的数据</span><br><span class="line"><span class="number">100</span></span><br><span class="line">从尾部插入节点后：</span><br><span class="line">打印所有节点：<span class="number">1</span> <span class="number">2</span> <span class="number">5</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">100</span> </span><br><span class="line">节点数量：<span class="number">11</span></span><br><span class="line">输入在头部插入的数据值</span><br><span class="line"><span class="number">-1</span></span><br><span class="line">从头插入节点后：</span><br><span class="line">打印所有节点：<span class="number">-1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">5</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">100</span> </span><br><span class="line">节点数量：<span class="number">12</span></span><br><span class="line">请输入你要删除的元素的值(只删除第一个匹配的值)：</span><br><span class="line"><span class="number">2</span></span><br><span class="line">删除第一个<span class="number">2</span>后：</span><br><span class="line">打印所有节点：<span class="number">-1</span> <span class="number">1</span> <span class="number">5</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">100</span> </span><br><span class="line">节点数量：<span class="number">11</span></span><br><span class="line">请输入你要删除的元素的值(将删除所有匹配的值)：</span><br><span class="line"><span class="number">1</span></span><br><span class="line">删除所有的<span class="number">1</span>后：</span><br><span class="line">打印所有节点：<span class="number">-1</span> <span class="number">5</span> <span class="number">3</span> <span class="number">2</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">100</span> </span><br><span class="line">节点数量：<span class="number">9</span></span><br></pre></td></tr></table></figure>

<h1 id="面向对象实现单链表操作"><a href="#面向对象实现单链表操作" class="headerlink" title="面向对象实现单链表操作"></a>面向对象实现单链表操作</h1><p>我同样的用面向对象的思想实现了一遍这样的操作.</p>
<h2 id="LinkedList-h"><a href="#LinkedList-h" class="headerlink" title="LinkedList.h"></a>LinkedList.h</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LINKEDLIST_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LINKEDLIST_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> ElementType;</span><br><span class="line"><span class="keyword">namespace</span> mylinkedlist</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">    ElementType data;</span><br><span class="line">&#125; Node, *NodePtr;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>;</span></span><br><span class="line"><span class="comment">//定义这个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//构造函数</span></span><br><span class="line">    LinkedList();</span><br><span class="line">    <span class="comment">//获取链表长度</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//打印链表</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//尾部增加节点</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">append</span><span class="params">(ElementType e)</span></span>;</span><br><span class="line">    <span class="comment">//头部插入节点</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_head</span><span class="params">(ElementType e)</span></span>;</span><br><span class="line">    <span class="comment">//释放整个链表</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//匹配并删除第一个匹配的节点</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteFirst</span><span class="params">(ElementType e)</span></span>;</span><br><span class="line">    <span class="comment">//匹配并删除所有的匹配的节点</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">(ElementType e)</span></span>;</span><br><span class="line">    <span class="comment">//反序</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//排序,默认从小到大排序</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">char</span> rule = <span class="string">'&lt;'</span>)</span></span>;</span><br><span class="line">    <span class="comment">//在指定位置插入指定节点</span></span><br><span class="line">    <span class="comment">//在第pos个节点之后插入数据域为e的节点</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> pos, ElementType e)</span></span>;</span><br><span class="line">    <span class="comment">//将两个已经按相同规则排序的链表合并并且按指定规则排序</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(LinkedList &amp;, <span class="keyword">char</span> originalrule, <span class="keyword">char</span> rule = <span class="string">'&lt;'</span>)</span></span>;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    NodePtr head;</span><br><span class="line">    NodePtr tail;</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h2 id="LinkedList-cpp"><a href="#LinkedList-cpp" class="headerlink" title="LinkedList.cpp"></a>LinkedList.cpp</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"LinkedList.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> mylinkedlist</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//LinkedList构造函数</span></span><br><span class="line">LinkedList::LinkedList()</span><br><span class="line">&#123;</span><br><span class="line">    head = <span class="keyword">new</span> Node;</span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>; <span class="comment">//保护指针，防止指向不明变量</span></span><br><span class="line">    tail = head;</span><br><span class="line">    count = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取链表长度</span></span><br><span class="line"><span class="keyword">int</span> LinkedList::size()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//尾部插入节点</span></span><br><span class="line"><span class="keyword">void</span> LinkedList::append(ElementType e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//开辟内存</span></span><br><span class="line">    NodePtr ptemp = <span class="keyword">new</span> Node;</span><br><span class="line">    <span class="keyword">if</span> (ptemp == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"分配内存失败！"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//填充节点</span></span><br><span class="line">    ptemp-&gt;data = e;</span><br><span class="line">    ptemp-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">//连接</span></span><br><span class="line">    tail-&gt;next = ptemp;</span><br><span class="line">    tail = ptemp;</span><br><span class="line">    <span class="comment">//更新count</span></span><br><span class="line">    count++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//头部插入</span></span><br><span class="line"><span class="keyword">void</span> LinkedList::push_head(ElementType e)</span><br><span class="line">&#123;</span><br><span class="line">    NodePtr ptemp = <span class="keyword">new</span> Node;</span><br><span class="line">    <span class="keyword">if</span> (ptemp == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"分配内存失败！"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ptemp-&gt;data = e;</span><br><span class="line">    ptemp-&gt;next = head-&gt;next;</span><br><span class="line">    head-&gt;next = ptemp;</span><br><span class="line">    count++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//打印链表</span></span><br><span class="line"><span class="keyword">void</span> LinkedList::print()</span><br><span class="line">&#123;</span><br><span class="line">    NodePtr phead = head;</span><br><span class="line">    phead = phead-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (phead != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; phead-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        phead = phead-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//匹配并删除第一个匹配的节点</span></span><br><span class="line"><span class="keyword">void</span> LinkedList::deleteFirst(ElementType e)</span><br><span class="line">&#123;</span><br><span class="line">    NodePtr phead, ptemp;</span><br><span class="line">    phead = head;</span><br><span class="line">    ptemp = phead;</span><br><span class="line">    phead = phead-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (phead != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (phead-&gt;data == e)</span><br><span class="line">        &#123;</span><br><span class="line">            ptemp-&gt;next = phead-&gt;next;</span><br><span class="line">            <span class="keyword">delete</span> phead;</span><br><span class="line">            count--;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        phead = phead-&gt;next;</span><br><span class="line">        ptemp = ptemp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//匹配并删除所有匹配的节点</span></span><br><span class="line"><span class="keyword">void</span> LinkedList::deleteAll(ElementType e)</span><br><span class="line">&#123;</span><br><span class="line">    NodePtr phead, ptemp;</span><br><span class="line">    phead = head;</span><br><span class="line">    ptemp = phead;</span><br><span class="line">    phead = phead-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (phead != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (phead-&gt;data == e)</span><br><span class="line">        &#123;</span><br><span class="line">            ptemp-&gt;next = phead-&gt;next;</span><br><span class="line">            <span class="keyword">delete</span> phead;</span><br><span class="line">            count--;</span><br><span class="line">            phead = ptemp-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            phead = phead-&gt;next;</span><br><span class="line">            ptemp = ptemp-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//反序</span></span><br><span class="line"><span class="keyword">void</span> LinkedList::reverse()</span><br><span class="line">&#123;</span><br><span class="line">    NodePtr p, q,r;</span><br><span class="line">    NodePtr h=<span class="keyword">new</span> Node;</span><br><span class="line">    p = <span class="literal">NULL</span>;</span><br><span class="line">    q = head-&gt;next;</span><br><span class="line">    <span class="keyword">delete</span> head;</span><br><span class="line">    <span class="comment">// head = NULL; //旧的头指针是新的尾指针，next需要指向NULL</span></span><br><span class="line">    <span class="keyword">while</span> (q)</span><br><span class="line">    &#123;</span><br><span class="line">        r = q-&gt;next; <span class="comment">//先保留下一个step要处理的指针</span></span><br><span class="line">        q-&gt;next = p; <span class="comment">//然后p q交替工作进行反向</span></span><br><span class="line">        p = q;</span><br><span class="line">        q = r;</span><br><span class="line">    &#125;</span><br><span class="line">    h-&gt;next=p;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// tail = head;</span></span><br><span class="line">    head = h; <span class="comment">// 最后q必然指向NULL，所以返回了p作为新的头指针</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//排序</span></span><br><span class="line"><span class="keyword">void</span> LinkedList::sort(<span class="keyword">char</span> rule)</span><br><span class="line">&#123;</span><br><span class="line">    NodePtr phead, ptemp;</span><br><span class="line">    <span class="keyword">if</span> (rule == <span class="string">'&lt;'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (phead = head-&gt;next; phead != <span class="literal">NULL</span>; phead = phead-&gt;next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (ptemp = phead-&gt;next; ptemp != <span class="literal">NULL</span>; ptemp = ptemp-&gt;next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (phead-&gt;data &gt; ptemp-&gt;data)</span><br><span class="line">                &#123;</span><br><span class="line">                    ElementType temp = phead-&gt;data;</span><br><span class="line">                    phead-&gt;data = ptemp-&gt;data;</span><br><span class="line">                    ptemp-&gt;data = temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (rule == <span class="string">'&gt;'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (phead = head-&gt;next; phead != <span class="literal">NULL</span>; phead = phead-&gt;next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (ptemp = phead-&gt;next; ptemp != <span class="literal">NULL</span>; ptemp = ptemp-&gt;next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (phead-&gt;data &lt; ptemp-&gt;data)</span><br><span class="line">                &#123;</span><br><span class="line">                    ElementType temp = phead-&gt;data;</span><br><span class="line">                    phead-&gt;data = ptemp-&gt;data;</span><br><span class="line">                    ptemp-&gt;data = temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"请正确指明排序规则,'&lt;'或'&gt;'!"</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在第pos个节点之后插入数据域为e的节点</span></span><br><span class="line"><span class="keyword">void</span> LinkedList::insert(<span class="keyword">int</span> pos, ElementType e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//首先要找到第pos个节点</span></span><br><span class="line">    NodePtr ptemp = head;</span><br><span class="line">    ptemp = ptemp-&gt;next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pos - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ptemp = ptemp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    NodePtr ptemp1 = <span class="keyword">new</span> Node;</span><br><span class="line">    ptemp1-&gt;data = e;</span><br><span class="line">    ptemp1-&gt;next = ptemp-&gt;next;</span><br><span class="line">    ptemp-&gt;next = ptemp1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"LinkedList.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> mylinkedlist;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    LinkedList l1=LinkedList();</span><br><span class="line">    l1.append(<span class="number">1</span>);</span><br><span class="line">    l1.append(<span class="number">1</span>);</span><br><span class="line">    l1.append(<span class="number">3</span>);</span><br><span class="line">    l1.append(<span class="number">2</span>);</span><br><span class="line">    l1.append(<span class="number">2</span>);</span><br><span class="line">    l1.append(<span class="number">5</span>);</span><br><span class="line">    l1.append(<span class="number">12</span>);</span><br><span class="line">    l1.append(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// l1.insert(2,100);</span></span><br><span class="line">    l1.print();</span><br><span class="line">    l1.reverse();</span><br><span class="line">    l1.print();</span><br><span class="line">    l1.reverse();</span><br><span class="line">    l1.print();</span><br><span class="line">    l1.sort(<span class="string">'&lt;'</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;l1.size()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    l1.print();</span><br><span class="line">    l1.reverse();</span><br><span class="line">    l1.print();</span><br><span class="line">    l1.deleteFirst(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;l1.size()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    l1.print();</span><br><span class="line">    l1.deleteAll(<span class="number">2</span>);</span><br><span class="line">   </span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;l1.size()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    l1.print();</span><br><span class="line">    l1.sort(<span class="string">'&lt;'</span>);</span><br><span class="line">    l1.print();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="makefile"><a href="#makefile" class="headerlink" title="makefile"></a>makefile</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">main.exe:LinkedList.o main.o</span></span><br><span class="line">	g++ -o main.exe LinkedList.o main.o</span><br><span class="line"><span class="section">LinkedList.o:LinkedList.cpp LinkedList.h</span></span><br><span class="line">	g++ -c LinkedList.cpp LinkedList.h</span><br><span class="line"><span class="section">main.o:main.cpp</span></span><br><span class="line">	g++ -c main.cpp</span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm main.exe main.o LinkedList.o LinkedList.h.gch</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/09/26/Dynamic-Array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/26/Dynamic-Array/" itemprop="url">动态数组</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-26T12:59:58+08:00">
                2017-09-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在学数据结构，涉及到动态数组。我自己总结了一下，把与动态数组有关的基本操作用c和c++分别写了一遍。下面把总结的成果记录一下。</p>
<p>动态数组之所以称之为动态，关键就在于其可以在程序运行过程中自动增加分配的内存大小。要实现这一点的关键又在于下面两点：</p>
<ul>
<li>实时记录数组的元素个数和分配的内存的大小</li>
<li>realloc()函数重新分配内存</li>
</ul>
<p>数组中的数据是连续存放的，可以随机访问。在数组尾部增加删除元素效率很高，但是在中间插入和删除元素则效率低下。</p>
<h1 id="C语言动态数组操作"><a href="#C语言动态数组操作" class="headerlink" title="C语言动态数组操作"></a>C语言动态数组操作</h1><p>要实现实时记录数组的元素个数和分配的内存的大小可以使用下面的一个结构体：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> ElementType;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DynamicArray</span>&#123;</span></span><br><span class="line">    ElementType* elems;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">int</span> capacity;</span><br><span class="line">&#125; *DynamicArrayPtr;</span><br></pre></td></tr></table></figure>

<p>elems是数据所在地址块的首地址。size和capacity分别是所存储数据的个数和当前分配的容量，他们的值必须与当前数组的状况相对应。</p>
<h2 id="初始化数组"><a href="#初始化数组" class="headerlink" title="初始化数组"></a>初始化数组</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(DynamicArrayPtr DAP)</span></span>&#123;</span><br><span class="line">    DAP-&gt;elems=(ElementType*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ElementType)*<span class="number">100</span>);</span><br><span class="line">    DAP-&gt;size=<span class="number">0</span>;</span><br><span class="line">    DAP-&gt;capacity=<span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化的过程中我们为数据存储区域分配了初始的可以容纳100个元素的内存空间，所以当前的容量为100。此时数组中还没有数据，所以大小为0.</p>
<h2 id="打印动态数组"><a href="#打印动态数组" class="headerlink" title="打印动态数组"></a>打印动态数组</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(DynamicArrayPtr DAP)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DAP-&gt;size; i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d  "</span>, DAP-&gt;elems[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="内存重新分配"><a href="#内存重新分配" class="headerlink" title="内存重新分配"></a>内存重新分配</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dealOverflow</span><span class="params">(DynamicArrayPtr DAP)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (DAP-&gt;size &gt;= DAP-&gt;capacity) &#123;</span><br><span class="line">        ElementType* newbase = (ElementType*)<span class="built_in">realloc</span>(DAP-&gt;elems, (<span class="number">50</span> + DAP-&gt;size)*<span class="keyword">sizeof</span>(ElementType));</span><br><span class="line">        <span class="keyword">if</span>(newbase==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"重新分配内存失败！"</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        DAP-&gt;elems=newbase;</span><br><span class="line">		DAP-&gt;capacity += DELTA_CAPACITY;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内存重新分配的条件就是当前数组中的元素个数大于或等于当前分配的容量时.重新分配使用的函数是realloc(),在原来的容量的基础之上新分配了可以容纳20个元素的空间,分配完成之后需要将记录当前容量大小的变量更新一下。这个函数主要进行的是容量是否够用的检测，如果不够用则增加容量。在每增加一个元素之前就应该调用一次该函数。</p>
<h2 id="尾部追加元素"><a href="#尾部追加元素" class="headerlink" title="尾部追加元素"></a>尾部追加元素</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">append</span><span class="params">(DynamicArrayPtr DAP,ElementType e)</span></span>&#123;</span><br><span class="line">    dealOverflow(DAP);</span><br><span class="line">    DAP-&gt;elems[DAP-&gt;size]=e;</span><br><span class="line">    DAP-&gt;size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>向尾部追加元素效率是比较高的。在追加之前首先要检测容量够不够用，追加之后要更新记录数组大小的变量的值。</p>
<h2 id="插入元素"><a href="#插入元素" class="headerlink" title="插入元素"></a>插入元素</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(DynamicArrayPtr DAP,<span class="keyword">int</span> pos,ElementType e)</span></span>&#123;</span><br><span class="line">    <span class="comment">//若容量不够则重新分配内存</span></span><br><span class="line">    dealOverflow(DAP);</span><br><span class="line">    <span class="comment">//下标超界的处理</span></span><br><span class="line">    <span class="keyword">if</span>(pos&gt;DAP-&gt;size||pos&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="comment">//移动元素</span></span><br><span class="line">    <span class="keyword">for</span>(i=DAP-&gt;size;i&gt;pos;i--)&#123;</span><br><span class="line">        DAP-&gt;elems[i]=DAP-&gt;elems[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//插入元素</span></span><br><span class="line">    DAP-&gt;elems[i]=e;</span><br><span class="line">    <span class="comment">//更新sie</span></span><br><span class="line">    DAP-&gt;size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>插入元素效率较低，在所插入位置的元素之后的所有元素都必须向后移动一个位置。</p>
<h2 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myremove</span><span class="params">(DynamicArrayPtr DAP,<span class="keyword">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="comment">//下标超界的处理</span></span><br><span class="line">    <span class="keyword">if</span>(pos&gt;=DAP-&gt;size||pos&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//删除数据</span></span><br><span class="line">     <span class="keyword">int</span> i;</span><br><span class="line">     <span class="keyword">for</span>(i=pos;i&lt;DAP-&gt;size;i++)&#123;</span><br><span class="line">         DAP-&gt;elems[i]=DAP-&gt;elems[i+<span class="number">1</span>];</span><br><span class="line">     &#125;</span><br><span class="line">     更新size</span><br><span class="line">     DAP-&gt;size--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="元素排序"><a href="#元素排序" class="headerlink" title="元素排序"></a>元素排序</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sort</span><span class="params">(DynamicArrayPtr DAP,<span class="keyword">char</span> rule=<span class="string">'&lt;'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(rule==<span class="string">'&lt;'</span>)&#123;<span class="comment">//从小到大排序</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;DAP-&gt;size;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;DAP-&gt;size;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(DAP-&gt;elems[i]&gt;DAP-&gt;elems[j])&#123;</span><br><span class="line">                        <span class="keyword">int</span> temp=DAP-&gt;elems[i];</span><br><span class="line">                        DAP-&gt;elems[i]=DAP-&gt;elems[j];</span><br><span class="line">                        DAP-&gt;elems[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(rule==<span class="string">'&gt;'</span>)&#123;<span class="comment">//从大到小排序</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;DAP-&gt;size;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;DAP-&gt;size;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(DAP-&gt;elems[i]&lt;DAP-&gt;elems[j])&#123;</span><br><span class="line">                        <span class="keyword">int</span> temp=DAP-&gt;elems[i];</span><br><span class="line">                        DAP-&gt;elems[i]=DAP-&gt;elems[j];</span><br><span class="line">                        DAP-&gt;elems[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="comment">//rule参数输入错误</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"请输入正确的排序规则('&lt;' or '&gt;')!!!"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面使用冒泡法则对元素进行排序，rule参数指定排序规则，默认按照从小到大排序。</p>
<h2 id="合并两个数组并排序"><a href="#合并两个数组并排序" class="headerlink" title="合并两个数组并排序"></a>合并两个数组并排序</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeAndsort</span><span class="params">(DynamicArrayPtr DAP1,DynamicArrayPtr DAP2,<span class="keyword">char</span> rule=<span class="string">'&lt;'</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;DAP2-&gt;size;i++)&#123;</span><br><span class="line">        append(DAP1,DAP2-&gt;elems[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//排序</span></span><br><span class="line">    sort(DAP1,rule);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="两个有序数组合并排序"><a href="#两个有序数组合并排序" class="headerlink" title="两个有序数组合并排序"></a>两个有序数组合并排序</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 功能:对两个已经按照相同规则排好序的动态数组合并并按照指定规则排序排序，</span></span><br><span class="line"><span class="comment"> * 根据原始规则与指定的规则的不同有四种排列组合</span></span><br><span class="line"><span class="comment"> * ＠para:DA１，DA2是两个原始的已有序的动态数组</span></span><br><span class="line"><span class="comment"> * ＠para:DA3是最终生成的结果动态数组</span></span><br><span class="line"><span class="comment"> * ＠para:originrule是原始的已排序的动态数组的排序规则('&lt;' or '&gt;')</span></span><br><span class="line"><span class="comment"> * ＠para:rule是合并后的的动态数组的排序规则('&lt;' or '&gt;')</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeAndsort_for_sorted</span><span class="params">(DynamicArrayPtr DA1,DynamicArrayPtr DA2,DynamicArrayPtr DA3,<span class="keyword">char</span> originrule,<span class="keyword">char</span> rule=<span class="string">'&lt;'</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(originrule==<span class="string">'&lt;'</span>&amp;&amp;rule==<span class="string">'&lt;'</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(i!=DA1-&gt;size&amp;&amp;j!=DA2-&gt;size)&#123;</span><br><span class="line">                <span class="keyword">if</span>(DA1-&gt;elems[i]&lt;DA2-&gt;elems[j])&#123;</span><br><span class="line">                    append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(DA1-&gt;elems[i]==DA2-&gt;elems[j]) &#123;</span><br><span class="line">                    <span class="comment">//防止循环的最后一个相同的时候漏掉一个</span></span><br><span class="line">                    append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">                    i++;</span><br><span class="line">                    append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">                    j++;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">                    j++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(DA1-&gt;size==i)&#123;</span><br><span class="line">                <span class="keyword">while</span>(j&lt;DA2-&gt;size)&#123;</span><br><span class="line">                   append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">                    j++;</span><br><span class="line">                &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(DA2-&gt;size==j)&#123;</span><br><span class="line">                <span class="keyword">while</span>(i&lt;DA1-&gt;size)&#123;</span><br><span class="line">                   append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(originrule==<span class="string">'&gt;'</span>&amp;&amp;rule==<span class="string">'&gt;'</span>)&#123;</span><br><span class="line">       <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">while</span>(i!=DA1-&gt;size&amp;&amp;j!=DA2-&gt;size)&#123;</span><br><span class="line">           <span class="keyword">if</span>(DA1-&gt;elems[i]&lt;DA2-&gt;elems[j])&#123;</span><br><span class="line">               append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j++;</span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(DA1-&gt;elems[i]==DA2-&gt;elems[j]) &#123;</span><br><span class="line">               <span class="comment">//防止循环的最后一个相同的时候漏掉一个</span></span><br><span class="line">               append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i++;</span><br><span class="line">               append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j++;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i++;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(DA1-&gt;size==i)&#123;</span><br><span class="line">           <span class="keyword">while</span>(j&lt;DA2-&gt;size)&#123;</span><br><span class="line">              append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j++;</span><br><span class="line">           &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span>(DA2-&gt;size==j)&#123;</span><br><span class="line">           <span class="keyword">while</span>(i&lt;DA1-&gt;size)&#123;</span><br><span class="line">              append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i++;</span><br><span class="line">           &#125;</span><br><span class="line">           &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(originrule==<span class="string">'&lt;'</span>&amp;&amp;rule==<span class="string">'&gt;'</span>)&#123;</span><br><span class="line">       <span class="keyword">int</span> i=DA1-&gt;size<span class="number">-1</span>,j=DA2-&gt;size<span class="number">-1</span>;</span><br><span class="line">       <span class="keyword">while</span>(i!=<span class="number">-1</span>&amp;&amp;j!=<span class="number">-1</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(DA1-&gt;elems[i]&lt;DA2-&gt;elems[j])&#123;</span><br><span class="line">               append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j--;</span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(DA1-&gt;elems[i]==DA2-&gt;elems[j]) &#123;</span><br><span class="line">               <span class="comment">//防止循环的最后一个相同的时候漏掉一个</span></span><br><span class="line">               append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i--;</span><br><span class="line">               append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j--;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i--;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(<span class="number">-1</span>==i)&#123;</span><br><span class="line">           <span class="keyword">while</span>(j!=<span class="number">-1</span>)&#123;</span><br><span class="line">              append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j--;</span><br><span class="line">           &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">-1</span>==j)&#123;</span><br><span class="line">           <span class="keyword">while</span>(i!=<span class="number">-1</span>)&#123;</span><br><span class="line">              append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i--;</span><br><span class="line">           &#125;</span><br><span class="line">           &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(originrule==<span class="string">'&gt;'</span>&amp;&amp;rule==<span class="string">'&lt;'</span>)&#123;</span><br><span class="line">       <span class="keyword">int</span> i=DA1-&gt;size<span class="number">-1</span>,j=DA2-&gt;size<span class="number">-1</span>;</span><br><span class="line">       <span class="keyword">while</span>(i!=<span class="number">-1</span>&amp;&amp;j!=<span class="number">-1</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(DA1-&gt;elems[i]&lt;DA2-&gt;elems[j])&#123;</span><br><span class="line">               append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i--;</span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(DA1-&gt;elems[i]==DA2-&gt;elems[j]) &#123;</span><br><span class="line">               <span class="comment">//防止循环的最后一个相同的时候漏掉一个</span></span><br><span class="line">               append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i--;</span><br><span class="line">               append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j--;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j--;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(<span class="number">-1</span>==i)&#123;</span><br><span class="line">           <span class="keyword">while</span>(j!=<span class="number">-1</span>)&#123;</span><br><span class="line">              append(DA3,DA2-&gt;elems[j]);</span><br><span class="line">               j--;</span><br><span class="line">           &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">-1</span>==j)&#123;</span><br><span class="line">           <span class="keyword">while</span>(i!=<span class="number">-1</span>)&#123;</span><br><span class="line">              append(DA3,DA1-&gt;elems[i]);</span><br><span class="line">               i--;</span><br><span class="line">           &#125;</span><br><span class="line">           &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"原始规则或指定的规则不正确"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"># C++版动态数组</span><br><span class="line">我用c++把上面的c的内容封装了一下，下面的是全部的内容。</span><br><span class="line"></span><br><span class="line">## DynamicArray.h的内容</span><br><span class="line">``` c++</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口文件</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DYNAMICARRAY_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DYNAMICARRAY_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INIT_CAPACITY 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DELTA_CAPACITY 100</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> ElementType;</span><br><span class="line"><span class="keyword">namespace</span> mydynamicarray&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DynamicArray</span>;</span></span><br><span class="line">    <span class="comment">//定义这个类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DynamicArray</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">//构造函数</span></span><br><span class="line">        DynamicArray();</span><br><span class="line">        <span class="comment">//获取长度</span></span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="comment">//获取容量</span></span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">getCapacity</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="comment">//最大值的索引</span></span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="comment">//最小值的索引</span></span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="comment">//打印输出</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="comment">//在末尾追加数据</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">append</span><span class="params">(ElementType e)</span></span>;</span><br><span class="line">        <span class="comment">//在指定下标的前面插入指定的数据</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> pos,ElementType e)</span></span>;</span><br><span class="line">        <span class="comment">//移除指定下标的数据</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> pos)</span></span>;</span><br><span class="line">        <span class="comment">//销毁</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">todestroy</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="comment">//按照指定规则排序，默认从小到大</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">sort</span><span class="params">(charneirong rule=<span class="string">'&lt;'</span>)</span></span>;</span><br><span class="line">        <span class="comment">//合并两个动态数组，并且按照规则排序</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">mergeAndsort</span><span class="params">(DynamicArray&amp;,<span class="keyword">char</span> rule)</span></span>;</span><br><span class="line">        <span class="comment">//对两个已经具有相同顺序的动态数组进行合并并且排序</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">mergeAndsort_for_sorted</span><span class="params">(DynamicArray&amp;,DynamicArray&amp;,<span class="keyword">char</span> originrule,<span class="keyword">char</span> rule=<span class="string">'&lt;'</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">dealOverflow</span><span class="params">()</span></span>;<span class="comment">//重新分配内存</span></span><br><span class="line">        ElementType* elems;</span><br><span class="line">        <span class="keyword">int</span> size;</span><br><span class="line">        <span class="keyword">int</span> capacity;</span><br><span class="line">    &#125;;<span class="comment">//注意类的定义的末尾需要有分号</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h2 id="DynamicArray-cpp的内容"><a href="#DynamicArray-cpp的内容" class="headerlink" title="DynamicArray.cpp的内容"></a>DynamicArray.cpp的内容</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现文件</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DynamicArray.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">namespace</span> mydynamicarray&#123;</span><br><span class="line">    <span class="comment">//构造函数</span></span><br><span class="line">    DynamicArray::DynamicArray()&#123;</span><br><span class="line">        elems=<span class="keyword">new</span> ElementType[INIT_CAPACITY];</span><br><span class="line">        size=<span class="number">0</span>;</span><br><span class="line">        capacity=INIT_CAPACITY;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//获取长度</span></span><br><span class="line">    <span class="keyword">int</span> DynamicArray::getSize()&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取容量</span></span><br><span class="line">    <span class="keyword">int</span> DynamicArray::getCapacity()&#123;</span><br><span class="line">        <span class="keyword">return</span> capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//最大值</span></span><br><span class="line">    <span class="keyword">int</span> DynamicArray::max()&#123;</span><br><span class="line">        <span class="keyword">int</span> result=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size<span class="number">-1</span>;i++)&#123;</span><br><span class="line">            result=(elems[i]&gt;elems[i+<span class="number">1</span>])?i:i+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//最小值</span></span><br><span class="line">    <span class="keyword">int</span> DynamicArray::min()&#123;</span><br><span class="line">        <span class="keyword">int</span> result=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size<span class="number">-1</span>;i++)&#123;</span><br><span class="line">            result=(elems[i]&lt;elems[i+<span class="number">1</span>])?i:i+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//打印</span></span><br><span class="line">    <span class="keyword">void</span> DynamicArray::print()&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;elems[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//处理重新分配问题</span></span><br><span class="line">    <span class="keyword">void</span> DynamicArray::dealOverflow()&#123;</span><br><span class="line">        <span class="keyword">if</span>(size&gt;=capacity)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            ElementType* newbase=(ElementType*)<span class="built_in">realloc</span>(elems,size+DELTA_CAPACITY);</span><br><span class="line">            <span class="keyword">if</span>(newbase==<span class="literal">NULL</span>)&#123;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="string">"重新分配内存失败！"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            elems=newbase;</span><br><span class="line">            capacity+=DELTA_CAPACITY;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//尾部追加</span></span><br><span class="line">    <span class="keyword">void</span> DynamicArray::append(ElementType e)&#123;</span><br><span class="line">        dealOverflow();</span><br><span class="line">        elems[size]=e;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//在指定下表位置插入</span></span><br><span class="line">    <span class="keyword">void</span> DynamicArray::insert(<span class="keyword">int</span> pos,ElementType e)&#123;</span><br><span class="line">        dealOverflow();</span><br><span class="line">        <span class="keyword">if</span>(pos&lt;<span class="number">0</span>||pos&gt;size)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"指定的位置不合法！"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">for</span>(i=size;i&gt;pos;i--)&#123;</span><br><span class="line">            elems[i]=elems[i<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        elems[i]=e;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除指定下表的元素</span></span><br><span class="line">    <span class="keyword">void</span> DynamicArray::remove(<span class="keyword">int</span> pos)&#123;</span><br><span class="line">        <span class="keyword">if</span>(pos&lt;<span class="number">0</span>||pos&gt;size)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"指定的位置不合法！"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">for</span>(i=pos;i&lt;size;i++)&#123;</span><br><span class="line">            elems[i]=elems[i+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//销毁</span></span><br><span class="line">    <span class="keyword">void</span> DynamicArray::todestroy()&#123;</span><br><span class="line">        <span class="keyword">delete</span> [] elems;</span><br><span class="line">        size=<span class="number">0</span>;</span><br><span class="line">        capacity=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> DynamicArray::sort(<span class="keyword">char</span> rule)&#123;</span><br><span class="line">        <span class="keyword">if</span>(rule==<span class="string">'&lt;'</span>)&#123;<span class="comment">//从小到大排序</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;size;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(elems[i]&gt;elems[j])&#123;</span><br><span class="line">                        <span class="keyword">int</span> temp=elems[i];</span><br><span class="line">                        elems[i]=elems[j];</span><br><span class="line">                        elems[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(rule==<span class="string">'&gt;'</span>)&#123;<span class="comment">//从大到小排序</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;size;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(elems[i]&lt;elems[j])&#123;</span><br><span class="line">                        <span class="keyword">int</span> temp=elems[i];</span><br><span class="line">                        elems[i]=elems[j];</span><br><span class="line">                        elems[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="comment">//rule参数输入错误</span></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入正确的排序规则('&lt;' or '&gt;')!!!"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> DynamicArray::mergeAndsort(DynamicArray&amp; dyArray,<span class="keyword">char</span> rule=<span class="string">'&lt;'</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dyArray.size;i++)&#123;</span><br><span class="line">            append(dyArray.elems[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//销毁DA2,注意不能够两次释放，如果这里释放了，那么在其他的地方</span></span><br><span class="line">        <span class="comment">//不能再次释放</span></span><br><span class="line">        <span class="comment">// dyArray.todestroy();</span></span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">        sort(rule);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//对两个已经有序的动态数组进行合并排序</span></span><br><span class="line">    <span class="keyword">void</span> DynamicArray::mergeAndsort_for_sorted(DynamicArray&amp; DA2,DynamicArray&amp; DA3,<span class="keyword">char</span> originrule,<span class="keyword">char</span> rule)&#123;</span><br><span class="line">        <span class="keyword">if</span>(originrule==<span class="string">'&lt;'</span>&amp;&amp;rule==<span class="string">'&lt;'</span>)&#123;</span><br><span class="line">                <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span>(i!=size&amp;&amp;j!=DA2.size)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(elems[i]&lt;DA2.elems[j])&#123;</span><br><span class="line">                        DA3.append(elems[i]);</span><br><span class="line">                        i++;</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(elems[i]==DA2.elems[j]) &#123;</span><br><span class="line">                        <span class="comment">//防止循环的最后一个相同的时候漏掉一个</span></span><br><span class="line">                        DA3.append(elems[i]);</span><br><span class="line">                        i++;</span><br><span class="line">                        DA3.append(DA2.elems[j]);</span><br><span class="line">                        j++;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        DA3.append(DA2.elems[j]);</span><br><span class="line">                        j++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(size==i)&#123;</span><br><span class="line">                    <span class="keyword">while</span>(j&lt;DA2.size)&#123;</span><br><span class="line">                       DA3.append(DA2.elems[j]);</span><br><span class="line">                        j++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(DA2.size==j)&#123;</span><br><span class="line">                    <span class="keyword">while</span>(i&lt;size)&#123;</span><br><span class="line">                       DA3.append(elems[i]);</span><br><span class="line">                        i++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(originrule==<span class="string">'&gt;'</span>&amp;&amp;rule==<span class="string">'&gt;'</span>)&#123;</span><br><span class="line">           <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">           <span class="keyword">while</span>(i!=size&amp;&amp;j!=DA2.size)&#123;</span><br><span class="line">               <span class="keyword">if</span>(elems[i]&lt;DA2.elems[j])&#123;</span><br><span class="line">                   DA3.append(DA2.elems[j]);</span><br><span class="line">                   j++;</span><br><span class="line">               &#125;<span class="keyword">else</span> <span class="keyword">if</span>(elems[i]==DA2.elems[j]) &#123;</span><br><span class="line">                   <span class="comment">//防止循环的最后一个相同的时候漏掉一个</span></span><br><span class="line">                   DA3.append(elems[i]);</span><br><span class="line">                   i++;</span><br><span class="line">                   DA3.append(DA2.elems[j]);</span><br><span class="line">                   j++;</span><br><span class="line">               &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                   DA3.append(elems[i]);</span><br><span class="line">                   i++;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(size==i)&#123;</span><br><span class="line">               <span class="keyword">while</span>(j&lt;DA2.size)&#123;</span><br><span class="line">                  DA3.append(DA2.elems[j]);</span><br><span class="line">                   j++;</span><br><span class="line">               &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(DA2.size==j)&#123;</span><br><span class="line">               <span class="keyword">while</span>(i&lt;size)&#123;</span><br><span class="line">                  DA3.append(elems[i]);</span><br><span class="line">                   i++;</span><br><span class="line">               &#125;</span><br><span class="line">               &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(originrule==<span class="string">'&lt;'</span>&amp;&amp;rule==<span class="string">'&gt;'</span>)&#123;</span><br><span class="line">           <span class="keyword">int</span> i=size<span class="number">-1</span>,j=DA2.size<span class="number">-1</span>;</span><br><span class="line">           <span class="keyword">while</span>(i!=<span class="number">-1</span>&amp;&amp;j!=<span class="number">-1</span>)&#123;</span><br><span class="line">               <span class="keyword">if</span>(elems[i]&lt;DA2.elems[j])&#123;</span><br><span class="line">                   DA3.append(DA2.elems[j]);</span><br><span class="line">                   j--;</span><br><span class="line">               &#125;<span class="keyword">else</span> <span class="keyword">if</span>(elems[i]==DA2.elems[j]) &#123;</span><br><span class="line">                   <span class="comment">//防止循环的最后一个相同的时候漏掉一个</span></span><br><span class="line">                   DA3.append(elems[i]);</span><br><span class="line">                   i--;</span><br><span class="line">                   DA3.append(DA2.elems[j]);</span><br><span class="line">                   j--;</span><br><span class="line">               &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                   DA3.append(elems[i]);</span><br><span class="line">                   i--;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(<span class="number">-1</span>==i)&#123;</span><br><span class="line">               <span class="keyword">while</span>(j!=<span class="number">-1</span>)&#123;</span><br><span class="line">                  DA3.append(DA2.elems[j]);</span><br><span class="line">                   j--;</span><br><span class="line">               &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">-1</span>==j)&#123;</span><br><span class="line">               <span class="keyword">while</span>(i!=<span class="number">-1</span>)&#123;</span><br><span class="line">                  DA3.append(elems[i]);</span><br><span class="line">                   i--;</span><br><span class="line">               &#125;</span><br><span class="line">               &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(originrule==<span class="string">'&gt;'</span>&amp;&amp;rule==<span class="string">'&lt;'</span>)&#123;</span><br><span class="line">           <span class="keyword">int</span> i=size<span class="number">-1</span>,j=DA2.size<span class="number">-1</span>;</span><br><span class="line">           <span class="keyword">while</span>(i!=<span class="number">-1</span>&amp;&amp;j!=<span class="number">-1</span>)&#123;</span><br><span class="line">               <span class="keyword">if</span>(elems[i]&lt;DA2.elems[j])&#123;</span><br><span class="line">                   DA3.append(elems[i]);</span><br><span class="line">                   i--;</span><br><span class="line">               &#125;<span class="keyword">else</span> <span class="keyword">if</span>(elems[i]==DA2.elems[j]) &#123;</span><br><span class="line">                   <span class="comment">//防止循环的最后一个相同的时候漏掉一个</span></span><br><span class="line">                   DA3.append(elems[i]);</span><br><span class="line">                   i--;</span><br><span class="line">                   DA3.append(DA2.elems[j]);</span><br><span class="line">                   j--;</span><br><span class="line">               &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                   DA3.append(DA2.elems[j]);</span><br><span class="line">                   j--;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(<span class="number">-1</span>==i)&#123;</span><br><span class="line">               <span class="keyword">while</span>(j!=<span class="number">-1</span>)&#123;</span><br><span class="line">                  DA3.append(DA2.elems[j]);</span><br><span class="line">                   j--;</span><br><span class="line">               &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">-1</span>==j)&#123;</span><br><span class="line">               <span class="keyword">while</span>(i!=<span class="number">-1</span>)&#123;</span><br><span class="line">                  DA3.append(elems[i]);</span><br><span class="line">                   i--;</span><br><span class="line">               &#125;</span><br><span class="line">               &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"原始规则或指定的规则不正确"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="main-cpp-测试-的内容"><a href="#main-cpp-测试-的内容" class="headerlink" title="main.cpp(测试)的内容"></a>main.cpp(测试)的内容</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试文件</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DynamicArray.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> mydynamicarray;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   DynamicArray array1=DynamicArray();</span><br><span class="line">   array1.append(<span class="number">1</span>);</span><br><span class="line">   array1.append(<span class="number">3</span>);</span><br><span class="line">   array1.append(<span class="number">2</span>);</span><br><span class="line">   array1.print();</span><br><span class="line">   array1.insert(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">   array1.insert(<span class="number">2</span>,<span class="number">200</span>);</span><br><span class="line">   array1.print();</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">       array1.append(i);</span><br><span class="line">   &#125;</span><br><span class="line">   array1.print();</span><br><span class="line">   array1.sort(<span class="string">'&gt;'</span>);</span><br><span class="line">   array1.print();</span><br><span class="line">   array1.sort();</span><br><span class="line">   array1.print();</span><br><span class="line">   DynamicArray array2=DynamicArray();</span><br><span class="line">   array2.append(<span class="number">1000</span>);</span><br><span class="line">   array2.append(<span class="number">3000</span>);</span><br><span class="line">   array2.append(<span class="number">2000</span>);</span><br><span class="line">   array2.append(<span class="number">250</span>);</span><br><span class="line">   array2.append(<span class="number">9000</span>);</span><br><span class="line">   array2.sort();</span><br><span class="line">   <span class="built_in">cout</span>&lt;&lt;array2.getSize()&lt;&lt;<span class="string">"||||||||||||"</span>&lt;&lt;array2.getCapacity()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">   array2.print();</span><br><span class="line">   array1.mergeAndsort(array2,<span class="string">'&lt;'</span>);</span><br><span class="line">   array1.print();</span><br><span class="line">   DynamicArray array3=DynamicArray();</span><br><span class="line">   array1.mergeAndsort_for_sorted(array2,array3,<span class="string">'&lt;'</span>);</span><br><span class="line">   array3.print();</span><br><span class="line">   <span class="built_in">cout</span>&lt;&lt;array3.max()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">   <span class="built_in">cout</span>&lt;&lt;array3.min()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">   array1.todestroy();</span><br><span class="line">   array2.todestroy();</span><br><span class="line">   array3.todestroy();</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="makefile"><a href="#makefile" class="headerlink" title="makefile"></a>makefile</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">main.exe:DynamicArray.o main.o</span><br><span class="line">    g++ -o main.exe DynamicArray.o main.o</span><br><span class="line">DynamicArray.o:DynamicArray.cpp DynamicArray.h</span><br><span class="line">    g++ -c DynamicArray.cpp DynamicArray.h</span><br><span class="line">main.o:main.cpp</span><br><span class="line">    g++ -c main.cpp</span><br><span class="line">clean:</span><br><span class="line">    rm main.exe main.o DynamicArray.o DynamicArray.h.gch</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/09/26/Vector-in-STL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/26/Vector-in-STL/" itemprop="url">Vector in STL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-26T09:03:39+08:00">
                2017-09-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index">
                    <span itemprop="name">C/C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在c++的标准模板库中有许多模板容器，他们封装了底层的数据结构，并且可以用来装几乎所有的已有数据类型以及用户自定义的数据类型。vector(向量)就是其中一个非常好用的序列式的容器。vector是最简单的序列容器，支持元素的随机访问，当然有时候显得效率低一些。</p>
<h1 id="vector类基础"><a href="#vector类基础" class="headerlink" title="vector类基础"></a>vector类基础</h1><h2 id="vector对象定义"><a href="#vector对象定义" class="headerlink" title="vector对象定义"></a>vector对象定义</h2><p>vector对象定义之前需要使用std命名空间和vector这一个头文件。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; myIntVec;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; myStrVec;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面就是定义了两个vector对象，一个是用来装int类型的数据，一个是用来装string类型的数据。</p>
<h2 id="vector类对象初始化"><a href="#vector类对象初始化" class="headerlink" title="vector类对象初始化"></a>vector类对象初始化</h2><p>vector对象的常用的初始化方法有以下几种：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;T&gt; v1          <span class="comment">//v1是一个空vector，它潜在的元素是T类型的，执行默认初始化</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v2(v1)       <span class="comment">//v2中包含有v1所有元素的副本</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v2 = v1       <span class="comment">//等价于v2(v1)，v2中包含有v1所有元素的副本</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v3(n, val)      <span class="comment">//v3包含了n个重复的元素，每个元素的值都是val</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v4(n)          <span class="comment">//v4包含了n个重复地执行了值初始化的对象</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v5&#123;a,b,c...&#125;　<span class="comment">//v5包含了初始值个数的元素，每个元素被赋予相应的初始值</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v5=&#123;a,b,c...&#125;　<span class="comment">//等价于v5&#123;a,b,c...&#125;</span></span><br></pre></td></tr></table></figure>

<p>vector对象在没有初始化之前不能够用赋值符号对其进行赋值，但是可以用push_back()成员函数对其赋值例如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; myIntVec;</span><br><span class="line">myIntVec[<span class="number">0</span>]=<span class="number">0</span>;  <span class="comment">//错误</span></span><br><span class="line">myIntVec.push_back(<span class="number">1</span>); <span class="comment">//正确</span></span><br></pre></td></tr></table></figure>

<h2 id="容器的大小和容量"><a href="#容器的大小和容量" class="headerlink" title="容器的大小和容量"></a>容器的大小和容量</h2><p>vector类定义了size()和capacity()两个函数来实现对当前容器元素的个数统计和对容器当前分配的内存数量的统计，同时也提供了reserve()和resize()两个成员函数来预先设置容器的大小和修改容器的大小。</p>
<h2 id="vector类的成员函数"><a href="#vector类的成员函数" class="headerlink" title="vector类的成员函数"></a>vector类的成员函数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; myvec;</span><br><span class="line">myvec.push_back(<span class="number">1</span>);　<span class="comment">//向向量中推进去一个数</span></span><br><span class="line">myvec.pop_back();　　<span class="comment">//弹出（删除）向量末尾的元素</span></span><br><span class="line">myvec.empty() <span class="comment">//判断向量是否为空</span></span><br><span class="line">myvec.front()  <span class="comment">//获得向量中的第一个元素</span></span><br><span class="line">myvec.back()  <span class="comment">//获得向量中的最后一个元素</span></span><br><span class="line">myvec.clear() <span class="comment">//将容器清空</span></span><br><span class="line">myvec.at()   <span class="comment">//访问指定的下标的元素</span></span><br></pre></td></tr></table></figure>

<h2 id="遍历vector容器"><a href="#遍历vector容器" class="headerlink" title="遍历vector容器"></a>遍历vector容器</h2><p>遍历vector容器可以使用迭代器方式，也可以通过使用at()成员函数和循环语句实现：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//迭代器加for循环来遍历vector对象</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">for_iter</span><span class="params">(<span class="built_in">vector</span>&lt;TYPE&gt;&amp; myvec)</span></span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;TYPE&gt;::iterator iter;</span><br><span class="line">	<span class="keyword">for</span>(iter=myvec.begin();iter!=myvec.end();iter++)&#123;</span><br><span class="line">	temp=*iter;</span><br><span class="line">	<span class="comment">//do somnthing with temp here...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//for循环加size()和at()成员函数来遍历</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">for_at_size</span><span class="params">(<span class="built_in">vector</span>&lt;TYPE&gt;&amp; myvec)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;myvec.size();i++)&#123;</span><br><span class="line">	temp=myvec.at(i);</span><br><span class="line">	<span class="comment">//do something with temp here...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用count-if算法和for-each算法操作vector对象"><a href="#使用count-if算法和for-each算法操作vector对象" class="headerlink" title="使用count_if算法和for_each算法操作vector对象"></a>使用<code>count_if</code>算法和<code>for_each</code>算法操作vector对象</h2><p><code>for_each</code>和<code>count_if</code>算法在algorithm头文件中</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span>&amp; x)</span></span>&#123;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;x&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">if_bigger_than_3</span><span class="params">(<span class="keyword">int</span>&amp; x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x&gt;<span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">void</span>)&#123;</span><br><span class="line">	<span class="comment">//定义并初始化含有是个元素的vector对象</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; myvec=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>&#125;;</span><br><span class="line">	<span class="comment">//for_each算法将指定区间的元素的引用逐一传递到print函数中</span></span><br><span class="line">	<span class="comment">//被print函数中的形参x接收并执行</span></span><br><span class="line">	for_each(myvec.begin(),myvec.end(),print);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//count_if算法将指定区间的元素的引用逐一传递到if_bigger_than_3函数中</span></span><br><span class="line">	<span class="comment">//返回值为if_bigger_than_3中返回true的次数</span></span><br><span class="line">	<span class="keyword">auto</span> count=count_if(myvec.begin(),myvec.end(),if_bigger_than_3);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;count&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="vector高级主题"><a href="#vector高级主题" class="headerlink" title="vector高级主题"></a>vector高级主题</h1><h2 id="元素访问方法"><a href="#元素访问方法" class="headerlink" title="元素访问方法"></a>元素访问方法</h2><p>可以直接访问vector对象的操作方法主要包括以下４中：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;MyType&gt; myvector;</span><br><span class="line">myvector[index];</span><br><span class="line">myvector.at(index);</span><br><span class="line">myvector.front();</span><br><span class="line">myvector.back();</span><br></pre></td></tr></table></figure>

<p>myvector[index]和myvector.at(index)两种访问方式返回的都是对象的引用类型，所以既可以取其中的元素，也可以对其赋值。前提是下标值必须有效。front()和back()分别返回第一个元素和最后一个元素。</p>
<h2 id="迭代器相关函数"><a href="#迭代器相关函数" class="headerlink" title="迭代器相关函数"></a>迭代器相关函数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; myvect=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line"><span class="comment">//返回值类型均为迭代器类型，分别指向第一个元素和最后一个元素的下一个元素</span></span><br><span class="line">myvect.begin();</span><br><span class="line">myvect.end();</span><br><span class="line"><span class="comment">//返回值类型均为逆向迭代器类型，分别指向逆向迭代的第一个元素和逆向迭代的最后一个元素的下一个元素</span></span><br><span class="line">myvect.rbegin();</span><br><span class="line">myvect.rend();</span><br></pre></td></tr></table></figure>

<h2 id="元素查找和搜索"><a href="#元素查找和搜索" class="headerlink" title="元素查找和搜索"></a>元素查找和搜索</h2><p>STL通用算法find()和find_if()</p>
<h2 id="容器中元素的排序"><a href="#容器中元素的排序" class="headerlink" title="容器中元素的排序"></a>容器中元素的排序</h2><p>sort算法：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> score;</span><br><span class="line">	<span class="built_in">string</span> name;</span><br><span class="line">&#125;Student;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort_by_score</span><span class="params">(Student&amp; s1,Student&amp; s2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> s1.score&gt;s2.score;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(Student &amp; s)</span></span>&#123;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;s.name&lt;&lt;<span class="string">":"</span>&lt;&lt;s.score&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="built_in">vector</span>&lt;Student&gt; myvec=&#123;&#123;<span class="number">25</span>,<span class="string">"mary"</span>&#125;,&#123;<span class="number">35</span>,<span class="string">"jack"</span>&#125;,&#123;<span class="number">10</span>,<span class="string">"Lily"</span>&#125;&#125;;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;<span class="string">"排序前："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	for_each(myvec.begin(),myvec.end(),print);</span><br><span class="line">	sort(myvec.begin(),myvec.end(),sort_by_score);</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;<span class="string">"排序后："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	for_each(myvec.begin(),myvec.end(),print);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面程序的输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">排序前：</span><br><span class="line">mary:25</span><br><span class="line">jack:35</span><br><span class="line">Lily:10</span><br><span class="line">排序后：</span><br><span class="line">jack:35</span><br><span class="line">mary:25</span><br><span class="line">Lily:10</span><br></pre></td></tr></table></figure>

<h2 id="插入元素"><a href="#插入元素" class="headerlink" title="插入元素"></a>插入元素</h2><p>push_back()可以在vector对象的末尾插入元素，insert()函数可以在vector的任意位置插入元素。下面看演示：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span>&amp; x)</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;x&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;myIntvec=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">    for_each(myIntvec.begin(),myIntvec.end(),print);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//在开始位置前面插入０</span></span><br><span class="line">    myIntvec.insert(myIntvec.begin(),<span class="number">0</span>);</span><br><span class="line">    for_each(myIntvec.begin(),myIntvec.end(),print);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//在末尾位置前面插入０</span></span><br><span class="line">     myIntvec.insert(myIntvec.end(),<span class="number">0</span>);</span><br><span class="line">     for_each(myIntvec.begin(),myIntvec.end(),print);</span><br><span class="line">     <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//创建一个新向量</span></span><br><span class="line">     <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;myIntvec2;</span><br><span class="line">     <span class="comment">//用push_back()依次向末尾添加数据</span></span><br><span class="line">     myIntvec2.push_back(<span class="number">6</span>);</span><br><span class="line">     myIntvec2.push_back(<span class="number">5</span>);</span><br><span class="line">     myIntvec2.push_back(<span class="number">2</span>);</span><br><span class="line">     for_each(myIntvec2.begin(),myIntvec2.end(),print);</span><br><span class="line">     <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//用pop_back()依次从末尾移除数据</span></span><br><span class="line">     myIntvec2.pop_back();</span><br><span class="line">     for_each(myIntvec2.begin(),myIntvec2.end(),print);</span><br><span class="line">     <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//将myIntvec2中的全部元素插入到myIntvec的开始元素的前面</span></span><br><span class="line">     myIntvec.insert(myIntvec.begin(),myIntvec2.begin(),myIntvec2.end());</span><br><span class="line">     for_each(myIntvec.begin(),myIntvec.end(),print);</span><br><span class="line">     <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//插入多个相同的值,这里是在myIntvec的开始元素的前面插入两个５</span></span><br><span class="line">     myIntvec.insert(myIntvec.begin(),<span class="number">2</span>,<span class="number">5</span>);</span><br><span class="line">     for_each(myIntvec.begin(),myIntvec.end(),print);</span><br><span class="line">     <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 2 3 4 5 6 7</span><br><span class="line">0 1 2 3 4 5 6 7</span><br><span class="line">0 1 2 3 4 5 6 7 0</span><br><span class="line">6 5 2</span><br><span class="line">6 5</span><br><span class="line">6 5 0 1 2 3 4 5 6 7 0</span><br><span class="line">5 5 6 5 0 1 2 3 4 5 6 7 0</span><br></pre></td></tr></table></figure>

<h2 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h2><p>在vector删除元素可以使用３个成员函数：pop_back(),erase(),和clear().还可以使用算法库的算法remove()来实现。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span>&amp; x)</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;x&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;myIntvec=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">    for_each(myIntvec.begin(),myIntvec.end(),print);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    myIntVec.erase(myIntVec.begin());</span><br><span class="line">    for_each(myIntvec.begin(),myIntvec.end(),print);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    myIntVec.clear();</span><br><span class="line">    for_each(myIntvec.begin(),myIntvec.end(),print);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 2 3 4 5 6 7</span><br><span class="line">2 3 4 5 6 7</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/09/25/Build-your-own-images/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/25/Build-your-own-images/" itemprop="url">构建镜像</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-25T12:46:20+08:00">
                2017-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>构建docker镜像可以让我们保存对容器的修改并且可以再次使用，提供了自定义镜像的能力，使我们可以以软件的形式打包并分发服务及其运行环境.</p>
<h1 id="通过容器构建镜像"><a href="#通过容器构建镜像" class="headerlink" title="通过容器构建镜像"></a>通过容器构建镜像</h1><p>可以通过docker的commit子命令基于一个容器创建一个新的镜像。</p>
<h2 id="commit命令"><a href="#commit命令" class="headerlink" title="commit命令"></a>commit命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure>

<h2 id="指令说明"><a href="#指令说明" class="headerlink" title="指令说明"></a>指令说明</h2><table>
<thead>
<tr>
<th align="center">OPTIONS</th>
<th align="center">USAGES</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-a,–author</td>
<td align="center">指定镜像的作者的信息(通常是作者的名字以及联系方式)</td>
</tr>
<tr>
<td align="center">-m,–message</td>
<td align="center">记录信息，一般记录改变的信息</td>
</tr>
<tr>
<td align="center">-p,–pause</td>
<td align="center">是否停止容器</td>
</tr>
<tr>
<td align="center">-c,–change</td>
<td align="center">使用dockerfile的指令来配置生成的镜像</td>
</tr>
</tbody></table>
<p>-c,–change选项是通过Dockerfile指令配置即将生成的镜像，支持的dockerfile指令有：CMD|ENTRYPOINT|ENV|EXPOSE|LABEL|ONBUILD|USER|VOLUME|WORKDIR</p>
<h2 id="官网上的例子"><a href="#官网上的例子" class="headerlink" title="官网上的例子"></a>官网上的例子</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS              NAMES</span><br><span class="line">c3f279d17e0a        ubuntu:12.04        /bin/bash           7 days ago          Up 25 hours                            desperate_dubinsky</span><br><span class="line">197387f1b436        ubuntu:12.04        /bin/bash           7 days ago          Up 25 hours                            focused_hamilton</span><br><span class="line">$ docker commit c3f279d17e0a  svendowideit/testimage:version3</span><br><span class="line">f5283438590d</span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY                        TAG                 ID                  CREATED             SIZE</span><br><span class="line">svendowideit/testimage            version3            f5283438590d        16 seconds ago      335.7 MB</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID       IMAGE               COMMAND             CREATED             STATUS              PORTS              NAMES</span><br><span class="line">c3f279d17e0a        ubuntu:12.04        /bin/bash           7 days ago          Up 25 hours                            desperate_dubinsky</span><br><span class="line">197387f1b436        ubuntu:12.04        /bin/bash           7 days ago          Up 25 hours                            focused_hamilton</span><br><span class="line">$ docker inspect -f <span class="string">"&#123;&#123; .Config.Env &#125;&#125;"</span> c3f279d17e0a</span><br><span class="line">[HOME=/ PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin]</span><br><span class="line">$ docker commit --change <span class="string">"ENV DEBUG true"</span> c3f279d17e0a  svendowideit/testimage:version3</span><br><span class="line">f5283438590d</span><br><span class="line">$ docker inspect -f <span class="string">"&#123;&#123; .Config.Env &#125;&#125;"</span> f5283438590d</span><br><span class="line">[HOME=/ PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin DEBUG=<span class="literal">true</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS              NAMES</span><br><span class="line">c3f279d17e0a        ubuntu:12.04        /bin/bash           7 days ago          Up 25 hours                            desperate_dubinsky</span><br><span class="line">197387f1b436        ubuntu:12.04        /bin/bash           7 days ago          Up 25 hours                            focused_hamilton</span><br><span class="line">$ docker commit --change=<span class="string">'CMD ["apachectl", "-DFOREGROUND"]'</span> -c <span class="string">"EXPOSE 80"</span> c3f279d17e0a  svendowideit/testimage:version4</span><br><span class="line">f5283438590d</span><br><span class="line">$ docker run -d svendowideit/testimage:version4</span><br><span class="line">89373736e2e7f00bc149bd783073ac43d0507da250e999f3f1036e0db60817c0</span><br><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                 CREATED             STATUS              PORTS              NAMES</span><br><span class="line">89373736e2e7        testimage:version4  <span class="string">"apachectl -DFOREGROU"</span>  3 seconds ago       Up 2 seconds        80/tcp             distracted_fermat</span><br><span class="line">c3f279d17e0a        ubuntu:12.04        /bin/bash               7 days ago          Up 25 hours                            desperate_dubinsky</span><br><span class="line">197387f1b436        ubuntu:12.04        /bin/bash               7 days ago          Up 25 hours                            focused_hamilton</span><br></pre></td></tr></table></figure>

<p>事实上，官方不建议通过commit方式来创建新的镜像，这种创建方式是不透明的，你对新镜像做的操作无法记录下来，官方推荐的方式是使用 dockerfile创建镜像。</p>
<h1 id="通过Dockerfile文件构建镜像"><a href="#通过Dockerfile文件构建镜像" class="headerlink" title="通过Dockerfile文件构建镜像"></a>通过Dockerfile文件构建镜像</h1><h2 id="整体感受"><a href="#整体感受" class="headerlink" title="整体感受"></a>整体感受</h2><p>Dockerfile是包含了一系列命令的文本文件。就像下面这样：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#First Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> Ubuntu:<span class="number">14.04</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> penname  hfsjhdss@outlook.com </span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get install –y nginx</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>下面我们在桌面创建一个文件夹Test，在里面创建一个名为Dockerfile的文件，文件中的内容就是上面的例子中的内容。<br>然后使用$ docker build命令来开启镜像的创建：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build –t=<span class="string">"myfirstdockerfileimage"</span> .</span><br></pre></td></tr></table></figure>

<p>上面这条命令的意思是根据当前目录中的Dockerfile文件创建一个名为myfirstdockerfileimage的新镜像。当命令执行完毕之后，我们就可以使用docker images命令查看到我们新创建的镜像了。注意这条命令的最后一个选项是一个点，表示的是当前目录。下面我就详细的介绍一下Dockerfile文件各个指令的使用，以及docker的build子命令的使用和注意事项。</p>
<h2 id="Dockerfile主要指令"><a href="#Dockerfile主要指令" class="headerlink" title="Dockerfile主要指令"></a>Dockerfile主要指令</h2><p>Dockerfile支持两种指令格式：注释和指令。注释是以#开头，后面是注释信息。指令是大写的指令名开头，后面是指令的参数。下面我们来看一下Dockerfile中的各个指令。</p>
<h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h3><p>通过FROM指令指定基础镜像。该镜像名必须是一个已经存在于本地的镜像。FROM必须是Dockerfile中第一条非注释指令，后续指令都是基于这个基础镜像执行。在Docker Hub上有非常多的高质量的官方镜像， 有可以直接拿来使用的服务类的镜像，如 nginx、redis、mongo、mysql、httpd、php、tomcat 等； 也有一些方便开发、构建、运行各种语言应用的镜像，如 node、openjdk、python、ruby、golang 等。 可以在其中寻找一个最符合我们最终目标的镜像为基础镜像进行定制。 如果没有找到对应服务的镜像，官方镜像中还提供了一些更为基础的操作系统镜像，如 ubuntu、debian、centos、fedora、alpine 等，这些操作系统的软件库为我们提供了更广阔的扩展空间。除了选择现有镜像为基础镜像外，Docker 还存在一个特殊的镜像，名为 scratch。这个镜像是虚拟的概念，并不实际存在，它表示一个空白的镜像。如果你以 scratch 为基础镜像的话，意味着你不以任何镜像为基础，接下来所写的指令将作为镜像第一层开始存在。不以任何系统为基础，直接将可执行文件复制进镜像的做法并不罕见，比如 swarm、coreos/etcd。对于 Linux 下静态编译的程序来说，并不需要有操作系统提供运行时支持，所需的一切库都已经在可执行文件里了，因此直接 FROM scratch 会让镜像体积更加小巧。使用 Go 语言 开发的应用很多会使用这种方式来制作镜像，这也是为什么有人认为 Go 是特别适合容器微服务架构的语言的原因之一。</p>
<h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><p>RUN 指令是用来执行命令行命令的。由于命令行的强大能力，RUN 指令在定制镜像时是最常用的指令之一。其格式有两种：</p>
<p>shell 格式：RUN &lt;命令&gt;，就像直接在命令行中输入的命令一样。刚才写的 Dockrfile 中的 RUN 指令就是这种格式。<br>exec 格式：RUN [“可执行文件”, “参数1”, “参数2”]，这更像是函数调用中的格式。<br>既然 RUN 就像Shell脚本一样可以执行命令，那么我们是否就可以像Shell脚本一样把每个命令对应一个RUN呢？比如这样：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:jessie</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get install -y gcc libc6-dev make</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> wget -O redis.tar.gz <span class="string">"http://download.redis.io/releases/redis-3.2.5.tar.gz"</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /usr/src/redis</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> make -C /usr/src/redis</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> make -C /usr/src/redis install</span></span><br></pre></td></tr></table></figure>

<p>之前说过，Dockerfile 中每一个指令都会建立一层，RUN 也不例外。每一个 RUN 的行为，就和刚才我们手工建立镜像的过程一样：新建立一层，在其上执行这些命令，执行结束后，commit 这一层的修改，构成新的镜像。而上面的这种写法，创建了 7 层镜像。这是完全没有意义的，而且很多运行时不需要的东西，都被装进了镜像里，比如编译环境、更新的软件包等等。结果就是产生非常臃肿、非常多层的镜像，不仅仅增加了构建部署的时间，也很容易出错。 这是很多初学 Docker 的人常犯的一个错误。</p>
<p>Union FS 是有最大层数限制的，比如 AUFS，曾经是最大不得超过 42 层，现在是不得超过 127 层。<br>上面的 Dockerfile 正确的写法应该是这样：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:jessie</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> buildDeps=<span class="string">'gcc libc6-dev make'</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get install -y <span class="variable">$buildDeps</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -O redis.tar.gz <span class="string">"http://download.redis.io/releases/redis-3.2.5.tar.gz"</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mkdir -p /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; make -C /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; make -C /usr/src/redis install \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm redis.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -r /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get purge -y --auto-remove <span class="variable">$buildDeps</span></span></span><br></pre></td></tr></table></figure>

<p>首先，之前所有的命令只有一个目的，就是编译、安装 redis 可执行文件。因此没有必要建立很多层，这只是一层的事情。因此，这里没有使用很多个 RUN 对一一对应不同的命令，而是仅仅使用一个 RUN 指令，并使用 &amp;&amp; 将各个所需命令串联起来。将之前的 7 层，简化为了 1 层。在撰写 Dockerfile 的时候，要经常提醒自己，这并不是在写 Shell 脚本，而是在定义每一层该如何构建。并且，这里为了格式化还进行了换行。Dockerfile 支持 Shell 类的行尾添加 \ 的命令换行方式，以及行首 # 进行注释的格式。良好的格式，比如换行、缩进、注释等，会让维护、排障更为容易，这是一个比较好的习惯。此外，还可以看到这一组命令的最后添加了清理工作的命令，删除了为了编译构建所需要的软件，清理了所有下载、展开的文件，并且还清理了 apt 缓存文件。这是很重要的一步，我们之前说过，镜像是多层存储，每一层的东西并不会在下一层被删除，会一直跟随着镜像。因此镜像构建时，一定要确保每一层只添加真正需要添加的东西，任何无关的东西都应该清理掉。很多人初学 Docker 制作出了很臃肿的镜像的原因之一，就是忘记了每一层构建的最后一定要清理掉无关文件。</p>
<h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><p>指定运行该镜像的容器使用的端口，可以一个expose后面跟多个端口，也可以使用多个expose:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">EXPOSE 80 8080</span><br></pre></td></tr></table></figure>

<h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CMD[“executable”,”param1”,”param2”] (<span class="built_in">exec</span>模式)</span><br><span class="line">CMD <span class="built_in">command</span> param1 param2 (shell模式)</span><br><span class="line">CMD [“param1”,”param2”] (作为ENTRYPOINT指令的默认参数)</span><br></pre></td></tr></table></figure>

<p>RUN指令指定的命令是在镜像构建时运行的，而CMD指定的命令是在容器运行时运行的，并且，如果我们在使用run来启动镜像对应的容器的时候，如果指定了容器启动运行的命令的话，CMD指令指定的命令将会被重写覆盖，而不会被执行，也就是说CMD指令是指定容器运行的默认行为．注意每个Dockerfile只能有一条CMD指令，如果指定了多条，则只有最后一条执行。</p>
<h3 id="ENTERYPOINT"><a href="#ENTERYPOINT" class="headerlink" title="ENTERYPOINT"></a>ENTERYPOINT</h3><p>同CMD指令一样，ENTRYPOINT指令也有exec和shell两种模式。在功能上，二者也很相似，两者的区别就是，ENTRYPOINT指令所指定的命令不会被docker run命令中指定的启动命令所覆盖，如果要覆盖，就需要在docker run命令中指定entrypoint选项，即:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run –entrypoint……..</span><br></pre></td></tr></table></figure>

<h3 id="LABLE"><a href="#LABLE" class="headerlink" title="LABLE"></a>LABLE</h3><p>LABLE标签用来指定生成镜像的元数据标签信息，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LABLE version=<span class="string">"1.0"</span> description=<span class="string">"this is a short description"</span></span><br></pre></td></tr></table></figure>

<p>注意以前的表示作者信息的MAINTAINER指令已经被废弃，官方建议使用LABLE代替。</p>
<h3 id="COPY-ADD"><a href="#COPY-ADD" class="headerlink" title="COPY/ADD"></a>COPY/ADD</h3><p>ADD和COPY都是将文件和目录复制到使用dockerfile构建的镜像中，他们都支持两种参数，来源地址和目标地址。文件和目录的来源可以是本地地址，也可以是远程url。如果是本地地址，必须是构建目录中的相对地址，对于远程的，对于远程的url，docker并不推荐使用，更建议使用curl和wget之类的命令来获取文件。而目标路径需要指定镜像中的绝对路径。<br>这两个指令的区别：<br>ADD包含类似tar的解压功能，在一些安装tar软件包时会有所帮助。如果单纯复制文件，docker推荐使用COPY.。<br>例如：COPY inde.html /usr/share/nginx/html/ 把宿主机中与dockerfile同级目录下的index.html复制到镜像的/usr/share/nginx/html/下</p>
<h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><p>用来向基于镜像创建的容器添加卷，一个卷是可以存在一个或多个容器的特定目录，这个目录可以绕过联合文件系统，并提供如共享数据，对数据持久化的功能.</p>
<h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><p>用来从镜像创建一个新容器时，在容器内部设置工作目录，ENTRYPOINT和CMD指定的命令都会在这个目录下执行。我们也可以使用这个指令在构建中为后续的指令指定工作目录，需要注意的是：WORKDIR一般使用绝对路径，如果使用相对路径，那么工作路径会一直传递下去，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">WORKDIR /a</span><br><span class="line">WORKDIR b</span><br><span class="line">WORKDIR c</span><br><span class="line">RUN <span class="built_in">pwd</span></span><br></pre></td></tr></table></figure>

<p>结果为 /a/b/c</p>
<h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><p>这个指令用于设置环境变量，环境变量的指令可以作用于构建过程中，在运行过程中同样有效。</p>
<h3 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h3><p>用于指定镜像被什么样的用户去运行</p>
<h3 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h3><p>可以为构建出来镜像添加触发器，当该镜像被其他镜像作为基础镜像时就会执行，及插入触发器中的指令</p>
<h2 id="基于Dockerfile构建镜像"><a href="#基于Dockerfile构建镜像" class="headerlink" title="基于Dockerfile构建镜像"></a>基于Dockerfile构建镜像</h2><p>编写完成Dockerfile之后，可以通过docker build命令来创建镜像，该命令基本的格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build [OPTIONS] 上下文路径</span><br></pre></td></tr></table></figure>

<h3 id="常用选项："><a href="#常用选项：" class="headerlink" title="常用选项："></a>常用选项：</h3><table>
<thead>
<tr>
<th align="center">OPTIONS</th>
<th align="center">USAGES</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-t</td>
<td align="center">指定最终生成的镜像的名称</td>
</tr>
<tr>
<td align="center">-f</td>
<td align="center">如果使用非上下文路径下的Dockerfile，那么需要-f选项指定其路径</td>
</tr>
<tr>
<td align="center">该命令会读取上下文路径下包括其子目录中的Dockerfile（或者是-f指定位置的Dockerfile）,并且将上下文路径下的内容发送给Docker服务端，由服务端来创建镜像。服务端会依据Dockerfile中的指令，从基础镜像开始运行一个容器,执行一条指令，对容器做出修改,执行类似于docker commit的操作，提交一个新的镜像层,再居于刚才提交的镜像运行一个新容器,执行Dockerfile中的下一条指令，直至所有的指令执行完毕。在根据Dockerfile构建镜像的过程中，会生成中间层镜像及其对应的容器，在这一过程中docker会自动删除生成的容器，而没有删除中间层镜像。这其实给了我们调试的能力，我们可以通过运行中间层镜像，来调试。</td>
<td align="center"></td>
</tr>
</tbody></table>
<h3 id="上下文-Context-是什么鬼？"><a href="#上下文-Context-是什么鬼？" class="headerlink" title="上下文(Context)是什么鬼？"></a>上下文(Context)是什么鬼？</h3><p>首先我们要理解 docker build 的工作原理。Docker 在运行时分为 Docker 引擎（也就是服务端守护进程）和客户端工具。Docker 的引擎提供了一组 REST API，被称为 Docker Remote API，而如 docker 命令这样的客户端工具，则是通过这组 API 与 Docker 引擎交互，从而完成各种功能。因此，虽然表面上我们好像是在本机执行各种 docker 功能，但实际上，一切都是使用的远程调用形式在服务端（Docker 引擎）完成。也因为这种 C/S 设计，让我们操作远程服务器的 Docker 引擎变得轻而易举。当我们进行镜像构建的时候，并非所有定制都会通过 RUN 指令完成，经常会需要将一些本地文件复制进镜像，比如通过 COPY 指令、ADD 指令等。而 docker build 命令构建镜像，其实并非在本地构建，而是在服务端，也就是 Docker 引擎中构建的。那么在这种客户端/服务端的架构中，如何才能让服务端获得本地文件呢？<br>这就引入了上下文的概念。当构建的时候，用户会指定构建镜像上下文的路径，docker build 命令得知这个路径后，会将路径下的所有内容打包，然后上传给 Docker 引擎。这样 Docker 引擎收到这个上下文包后，展开就会获得构建镜像所需的一切文件。<br>如果在 Dockerfile 中这么写：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">... dockerfile</span><br><span class="line">COPY ./package.json /app/</span><br></pre></td></tr></table></figure>

<p>这并不是要复制执行 docker build 命令所在的目录下的 package.json，也不是复制 Dockerfile 所在目录下的 package.json，而是复制 上下文（context） 目录下的 package.json。因此，COPY 这类指令中的源文件的路径都是相对路径。这也是初学者经常会问的为什么 COPY ../package.json /app 或者 COPY /opt/xxxx /app 无法工作的原因，因为这些路径已经超出了上下文的范围，Docker 引擎无法获得这些位置的文件。如果真的需要那些文件，应该将它们复制到上下文目录中去。</p>
<p>如果观察 docker build 输出，我们其实可以看到了这个发送上下文的过程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t myimage .</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sending build context to Docker daemon 2.048 kB</span><br></pre></td></tr></table></figure>

<p>理解构建上下文对于镜像构建是很重要的，避免犯一些不应该的错误。比如有些初学者在发现 COPY /opt/xxxx /app 不工作后，于是干脆将 Dockerfile 放到了硬盘根目录去构建，结果发现 docker build 执行后，在发送一个几十 GB 的东西，极为缓慢而且很容易构建失败。那是因为这种做法是在让 docker build 打包整个硬盘，这显然是使用错误。</p>
<p>一般来说，应该会将 Dockerfile 置于一个空目录下，或者项目根目录下。如果该目录下没有所需文件，那么应该把所需文件复制一份过来。如果目录下有些东西确实不希望构建时传给 Docker 引擎，那么可以用 .gitignore 一样的语法写一个 .dockerignore，该文件是用于剔除不需要作为上下文传递给 Docker 引擎的。</p>
<p>那么为什么会有人误以为 . 是指定 Dockerfile 所在目录呢？这是因为在默认情况下，如果不额外指定 Dockerfile 的话，会将上下文目录下的名为 Dockerfile 的文件作为 Dockerfile。</p>
<p>这只是默认行为，实际上 Dockerfile 的文件名并不要求必须为 Dockerfile，而且并不要求必须位于上下文目录中，比如可以用 -f ../Dockerfile.php 参数指定某个文件作为 Dockerfile。</p>
<p>当然，一般大家习惯性的会使用默认的文件名 Dockerfile，以及会将其置于镜像构建上下文目录中。</p>
<h3 id="构建缓存"><a href="#构建缓存" class="headerlink" title="构建缓存"></a>构建缓存</h3><p>由于每一步的构建过程都会将结果提交为镜像，docker会将之前的镜像看做缓存，如果我们再次运行下之前已经运行过的dockerfile的build命令，我们会发现，我们不会再次经历像第一次执行那样的长时间的等待，并且这一次运行的每一步都有Using cache的字样。这样就使我们的构建变得非常高效。但有时我们并不想使用缓存，如构建命令中包含apt-get update命令时，我们希望每次apt-get包都能刷新，这样就可以得到最新的版本。如果要跳过构建缓存，可以使用docker build –no-cache….即docker build命令中的—no-cache选项。</p>
<h3 id="查看镜像构建过程"><a href="#查看镜像构建过程" class="headerlink" title="查看镜像构建过程"></a>查看镜像构建过程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">history</span> [image]</span><br></pre></td></tr></table></figure>

<p>对于一个给定的镜像，我们可以通过上面的命令来查看其构建过程</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://andrewpqc.github.io/2017/09/20/Network-management-of-Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Andrew's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/20/Network-management-of-Docker/" itemprop="url">Docker网络管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-20T12:33:41+08:00">
                2017-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在实践中，经常需要多个服务组件容器之间共同协作，这往往需要多个容器之间能够相互访问到对方的服务。同时，为了容器的安全有时我们也要避免容器之间的访问。</p>
<h1 id="容器与用户的连接"><a href="#容器与用户的连接" class="headerlink" title="容器与用户的连接"></a>容器与用户的连接</h1><h2 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h2><p>要想外部用户访问到服务器主机中容器中的服务，那么就要把提供服务的容器的端口映射到服务器主机的端口上。这样用户访问服务器主机的对应端口就可以访问到容器中的服务了。这是通过run命令的两个选项实现的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run [-p]|[-P]………</span><br><span class="line">-P –publish-all=ture|<span class="literal">false</span> 默认为<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>用大写的P将会对容器所暴露的所有的端口进行映射,命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run –P -i –t IMAGE [COMMAND] [ARG…]</span><br></pre></td></tr></table></figure>

<p>这会将镜像所暴露的端口随机映射到49000~49900的端口。</p>
<p>用小写的p时我们可以指定映射那些端口，对映射关系进行详细操作，总共有4种指定的方式：</p>
<p>containerPort只指定需要映射的容器的端口，将他随机映射到一个宿主机的端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run –p 80 –i –t Ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>hostport:containerport两者皆指定，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run –p 8080:80 –i –t Ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>ip:containerport</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run –p 0.0.0.0:80 –I –t Ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>ip:hostport:containerport</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run –p 0.0.0.0:8080:80 –I –t Ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>这样我们就可以通过docker的ps,inspect子命令查看到端口映射的情况了。</p>
<h1 id="容器与容器之间的互联"><a href="#容器与容器之间的互联" class="headerlink" title="容器与容器之间的互联"></a>容器与容器之间的互联</h1><p>首先，无论是同一台主机上的容器之间，还是跨主机的容器之间都可以通过访问对方容器所在的主机的映射的端口访问到对方容器的服务。</p>
<h2 id="同一台主机上的容器的互联"><a href="#同一台主机上的容器的互联" class="headerlink" title="同一台主机上的容器的互联"></a>同一台主机上的容器的互联</h2><h3 id="通过ip-端口互联"><a href="#通过ip-端口互联" class="headerlink" title="通过ip+端口互联"></a>通过ip+端口互联</h3><p>容器有自己的网络和ip地址，使用docker inspect＋容器ID就可以查看到相关信息。默认情况之下，在同一台物理主机中的容器之间可以通过对方容器的ip和端口访问到对方的服务。但是这样有一个弊端：随着容器的停止与启动，容器的ip可能会发生变化。这就意味着每一次你重启了集群中的一个容器，你就必须要查看这个启动的容器新的ip，然后更改访问这个容器中服务的容器的配置。这显然太麻烦了。好在docker为我们提供了更加稳定可靠的方式来维护容器的连通。那就是：docker run的–link选项，</p>
<h3 id="容器名便捷互访"><a href="#容器名便捷互访" class="headerlink" title="容器名便捷互访"></a>容器名便捷互访</h3><h4 id="自定义容器名"><a href="#自定义容器名" class="headerlink" title="自定义容器名"></a>自定义容器名</h4><p>虽然镜像启动后，容器会自动获得一个随机的容器名，但是为了方便和易记，我们往往会为容器自定义一个名字：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -itd --name myname ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>如上，通过–name参数来指定容器的名称为myname.</p>
<h4 id="容器互联"><a href="#容器互联" class="headerlink" title="容器互联"></a>容器互联</h4><p>使用–link参数能够让容器之间安全的进行交互。比如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name db mysql</span><br></pre></td></tr></table></figure>

<p>上面我们以mysql镜像创建了名为db的容器，下面我们就让我们的应用程序容器与它链接起来：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -itd -P --name myweb --link db:mydb ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>如上，我们以ubuntu镜像创建了一个名为myweb的容器，它通过–link参数与上面的db容器建立了容器名互访连接的关系，他在myweb容器中将被称之为mydb.<br>注意–link参数的格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">... --link &lt;CONTAINER_NAME&gt;:&lt;ALIAS&gt; ...</span><br></pre></td></tr></table></figure>

<p>CONTAINER_NAME是所要链接的容器名，ALIAS是在容器中使用的所要链接容器的别名.<br>下面我们就可以在myweb容器中执行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ping mydb</span><br></pre></td></tr></table></figure>

<p>可以发现可以顺利ping通。假如db容器的80端口还提供了静态网站服务，那么在myweb容器中可以通过如下命令访问到这一服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl mydb:80</span><br></pre></td></tr></table></figure>

<p>注意：ping和curl这两个命令可能在容器中并没有安装，所以要先安装后才可以使用。<br>之后无论你怎样重启容器，只要对方容器还在运行，你就可以通过这种方式在源容器中访问到目标容器。</p>
<h1 id="高级网络管理"><a href="#高级网络管理" class="headerlink" title="高级网络管理"></a>高级网络管理</h1><h2 id="docker自带的网络"><a href="#docker自带的网络" class="headerlink" title="docker自带的网络"></a>docker自带的网络</h2><p>当我们安装docker的时候，会自动创建三个网络，我们可以使用下面的命令来查看主机中当前存在的网络：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">5a0d02e77f3c        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">8349004e42e8        host                host                <span class="built_in">local</span></span><br><span class="line">92e7ec631cff        none                null                <span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<p>NETWORK ID列是对应网络的唯一ID。NAME列是对应网络的名字。DRIVER是对应网络所使用的驱动。SCOPE是当前网络的作用域，这里的local说明当前网络作用域为本地。<br>上面的bridge,host,none就是docker安装时自动创建的三个网络。</p>
<h3 id="bridge"><a href="#bridge" class="headerlink" title="bridge"></a>bridge</h3><p>bridge网络是docker容器默认使用的网络，除非在容器启动时显式的指定使用其他网络，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -itd --name ct1 ubuntu</span><br><span class="line">$ docker run -itd --name ct2 --network host ubuntu</span><br></pre></td></tr></table></figure>

<p>上面的两条命令用ubuntu镜像分别启动了两个容器ct1,ct2.其中ct1在默认的bridge网络中，ct2在我们指定的host网络中。可以通过docker inspect ct1和docker inspect ct2来查看当前容器所属的网络：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect ct1</span><br></pre></td></tr></table></figure>

<p>部分输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Networks"</span>: &#123;   </span><br><span class="line">                <span class="string">"bridge"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: null,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: null,</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"5a0d02e77f3c89ec59b9432be752a35f6cc28c260022398751495ee563809570"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"a60ca83c9da616064ca9fa112f80a05549bc2ff408483381979b6921bdba46ef"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.2"</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:02"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>对ct2执行同样的命令，同一部分的输出为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Networks"</span>: &#123;</span><br><span class="line">                <span class="string">"host"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: null,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: null,</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"8349004e42e8dda028d04b62a19df90ecf9655409ad0f1e8847a70f5b49fdd1f"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"f3f957ca950edc0c12ab94e57d72d0799c8287ee638179ba63349cc87f27731e"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">""</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>由上可见，确实ct1,ct2两个容器分属于不同的网络。<br>bridge网络的底层就是docker0这一虚拟网络设备，当容器运行在bridge网络中时，docker的守护进程就是通过docker0来链接到这些容器的，并且这些容器支持通过ip来访问对方。其实在你安装docker以后，docker0这一网络设备就已经成为你的主机的网络栈的一部分。你可以通过如下命令查看到docker0:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ip addr show</span><br></pre></td></tr></table></figure>

<h3 id="host"><a href="#host" class="headerlink" title="host"></a>host</h3><p>运行在host网络中的容器，在网络方面与宿主机之间没有隔离，不用做端口映射，外界通过访问主机ip加对应端口访问到容器中的服务。直接使用 Docker host 的网络最大的好处就是性能，如果容器对网络传输效率有较高要求，则可以选择 host 网络。当然不便之处就是牺牲一些灵活性，比如要考虑端口冲突问题，Docker host 上已经使用的端口就不能再用了。Docker host 的另一个用途是让容器可以直接配置 host 网路。比如某些跨 host 的网络解决方案，其本身也是以容器方式运行的，这些方案需要对网络进行配置，比如管理 iptables。</p>
<h3 id="none"><a href="#none" class="headerlink" title="none"></a>none</h3><p>故名思议，none 网络就是什么都没有的网络。挂在这个网络下的容器除了 lo，没有其他任何网卡。封闭意味着隔离，一些对安全性要求高并且不需要联网的应用可以使用 none 网络。比如某个容器的唯一用途是生成随机密码，就可以放到 none 网络中避免密码被窃取。</p>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><h3 id="定义网络"><a href="#定义网络" class="headerlink" title="定义网络"></a>定义网络</h3><p>在实践中使用最多的网络是默认的bridge网络，其实我们还可以自定义网络：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create --driver bridge mynetwork</span><br></pre></td></tr></table></figure>

<p>如上我以bridge为驱动创建了一个自定义网络mynetwork,我们可以通过下面的命令查看当前主机中的网络：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br></pre></td></tr></table></figure>

<p>这时我们就可以发现除了docker自带的bridge,none,host三种网络之外，我们的自定义网络mynetwork也出现在输出中。</p>
<h3 id="使用自定义网络运行容器"><a href="#使用自定义网络运行容器" class="headerlink" title="使用自定义网络运行容器"></a>使用自定义网络运行容器</h3><p>下面我们使用默认的bridge运行ct1,ct2,使用我们的自定义网络再运行起来一个ct3容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name ct1 ubuntu</span><br><span class="line">$ docker run -d --name ct2 ubuntu</span><br><span class="line">$ docker run -d --name ct3 --network mynetwork ubuntu</span><br></pre></td></tr></table></figure>

<p>这样我们就得到了两个运行在bridge网络中的容器ct1,ct2，和一个运行在我自定义的网络mynetwork中的ct3.（可以使用docker inspect命令在Networks一项中查看到容器所属于的网络）</p>
<h3 id="不同网络中容器的互访"><a href="#不同网络中容器的互访" class="headerlink" title="不同网络中容器的互访"></a>不同网络中容器的互访</h3><p>我们可以在ct1,ct2,ct3中相互的ping对方，可以发现位于默认bridge网络中的ct1,ct2可以相互的ping通，但是，ct1,ct2和位于mynetwork中的ct3确无法ping通。这就说明在相同网络中的容器可以通过ip相互访问，但是跨网络则不行。那如果需要不同网络中的容器能够相互访问怎么办呢？可以使用下面的命令实现将某一个容器加入某一个网络中，那么这个容器就可以访问都该网络中的容器了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network connect mynetwork ct2</span><br></pre></td></tr></table></figure>

<p>如上，我们通过上述命令将ct2加入到了mynetwork网络中，这时我们可以查看一下ct2所属于的网络：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect ct2</span><br></pre></td></tr></table></figure>

<p>部分输出如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Networks"</span>: &#123;</span><br><span class="line">                <span class="string">"bridge"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: null,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: null,</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"5a0d02e77f3c89ec59b9432be752a35f6cc28c260022398751495ee563809570"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"b138dd2a40e7e194fd3c055c78dc4db6778b80c767fbe32a68096507ac039fa5"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.3"</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:03"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"mynetwork"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: &#123;&#125;,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: [</span><br><span class="line">                        <span class="string">"455c3ec1534d"</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"69d07788867935f590056da4d1c60591ca5459029715029e30c54f440b59b968"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"afda2df82f371f3022e367e9b806c479d6ba06f5b6888b90c4bdcf2d48fffc8d"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.18.0.1"</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">"172.18.0.3"</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:12:00:03"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>可见，ct2现在既属于bridge网络，又属于mynetwork网络。并且在bridge网络和在mynetwork网络中的ip不相同。在ct3中要访问ct2那么就需要使用ct2在mynetwork中的ip，同理要在ct1中访问ct2则要使用ct2在bridge网络中的ip.</p>
<h3 id="查看某一网络中的容器"><a href="#查看某一网络中的容器" class="headerlink" title="查看某一网络中的容器"></a>查看某一网络中的容器</h3><p>我们可以通过命令来查看某一网络中的所有的容器，如下我们查看bridge网络中的所有容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network inspect bridge</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"5a0d02e77f3c89ec59b9432be752a35f6cc28c260022398751495ee563809570"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2017-09-19T20:50:37.834660229+08:00"</span>,</span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"EnableIPv6"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"IPAM"</span>: &#123;</span><br><span class="line">            <span class="string">"Driver"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"Options"</span>: null,</span><br><span class="line">            <span class="string">"Config"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"Subnet"</span>: <span class="string">"172.17.0.0/16"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Internal"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Attachable"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Ingress"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Containers"</span>: &#123;</span><br><span class="line">            <span class="string">"455c3ec1534dde68712fbb441e8fa97ed830430595d92a15ec7cbee801d22e39"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"ct2"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"b138dd2a40e7e194fd3c055c78dc4db6778b80c767fbe32a68096507ac039fa5"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:03"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"172.17.0.3/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"7b7063b9630d7945415063cf2dd0275414cb32cf5622c77ac27b96a10903ae57"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"ct1"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"111c9a1c47272f854457530fb8ee077947728144b3191b80c15e6223e865a9e5"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:02"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"172.17.0.2/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Options"</span>: &#123;</span><br><span class="line">            <span class="string">"com.docker.network.bridge.default_bridge"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.enable_icc"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.enable_ip_masquerade"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.host_binding_ipv4"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.name"</span>: <span class="string">"docker0"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.driver.mtu"</span>: <span class="string">"1500"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>从Containers一项中我们可以发现目前在bridge网络中的容器为ct1和ct2,这和目前的实际状况是一致的。</p>
<h3 id="容器退出某一网络"><a href="#容器退出某一网络" class="headerlink" title="容器退出某一网络"></a>容器退出某一网络</h3><p>我们也可以使一个容器退出某一网络，比如现在使ct2退出bridge:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network disconnect bridge ct2</span><br></pre></td></tr></table></figure>

<p>这时我们再次查看ct2的所属的网络就只有mynetwork了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect ct2</span><br></pre></td></tr></table></figure>

<p>部分输出;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Networks"</span>: &#123;</span><br><span class="line">                <span class="string">"mynetwork"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: &#123;&#125;,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: [</span><br><span class="line">                        <span class="string">"455c3ec1534d"</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"69d07788867935f590056da4d1c60591ca5459029715029e30c54f440b59b968"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"afda2df82f371f3022e367e9b806c479d6ba06f5b6888b90c4bdcf2d48fffc8d"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.18.0.1"</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">"172.18.0.3"</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:12:00:03"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Andrew</p>
              <p class="site-description motion-element" itemprop="description">All In</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">50</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">67</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Andrew</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
